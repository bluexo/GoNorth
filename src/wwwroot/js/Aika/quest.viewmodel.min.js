(function(n){"use strict";(function(n){var t=15;n.ViewModel=function(){this.showDialog=new ko.observable(!1);this.dialogTitle=new ko.observable("");this.showNewButtonInDialog=new ko.observable(!1);this.dialogSearchCallback=null;this.dialogCreateNewCallback=null;this.dialogSearchPattern=new ko.observable("");this.dialogIsLoading=new ko.observable(!1);this.dialogEntries=new ko.observableArray;this.dialogHasMore=new ko.observable(!1);this.dialogCurrentPage=new ko.observable(0);this.errorOccured=new ko.observable(!1);this.idObservable=null;this.choosingDeferred=null};n.ViewModel.prototype={openNpcSearch:function(n,t){return this.openDialog(n,this.searchNpcs,t,null)},openItemSearch:function(n,t){return this.openDialog(n,this.searchItems,t,null)},openSkillSearch:function(n,t){return this.openDialog(n,this.searchSkills,t,null)},openKirjaPageSearch:function(n,t,i){return this.openDialog(n,this.searchPages,t,i)},openQuestSearch:function(n,t){return this.openDialog(n,this.searchQuest,t,null)},openChapterDetailSearch:function(n,t,i){return this.openDialog(n,this.searchChapterDetails,t,i)},openDialog:function(n,t,i,r){return this.choosingDeferred&&(this.choosingDeferred.reject(),this.choosingDeferred=null),this.showDialog(!0),this.dialogTitle(n),this.dialogCreateNewCallback=typeof i=="function"?i:null,this.showNewButtonInDialog(this.dialogCreateNewCallback?!0:!1),this.dialogSearchCallback=t,this.dialogSearchPattern(""),this.dialogIsLoading(!1),this.dialogEntries([]),this.dialogHasMore(!1),this.dialogCurrentPage(0),this.idObservable=r,this.choosingDeferred=new jQuery.Deferred,this.choosingDeferred.promise()},selectObject:function(n){this.choosingDeferred&&(this.choosingDeferred.resolve(n),this.choosingDeferred=null);this.closeDialog()},cancelDialog:function(){this.choosingDeferred&&(this.choosingDeferred.reject(),this.choosingDeferred=null);this.closeDialog()},closeDialog:function(){this.showDialog(!1)},startNewDialogSearch:function(){this.dialogCurrentPage(0);this.dialogHasMore(!1);this.runDialogSearch()},prevDialogPage:function(){this.dialogCurrentPage(this.dialogCurrentPage()-1);this.runDialogSearch()},nextDialogPage:function(){this.dialogCurrentPage(this.dialogCurrentPage()+1);this.runDialogSearch()},runDialogSearch:function(){this.dialogIsLoading(!0);this.errorOccured(!1);var n=this;this.dialogSearchCallback(this.dialogSearchPattern()).done(function(t){n.dialogHasMore(t.hasMore);n.dialogEntries(t.entries);n.dialogIsLoading(!1)}).fail(function(){n.errorOccured(!0);n.dialogIsLoading(!1)})},createDialogObject:function(n,t,i){return{id:n,name:t,openLink:i}},searchPages:function(n){var i=new jQuery.Deferred,r="/api/KirjaApi/SearchPages?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,u;return this.idObservable&&(r+="&excludeId="+this.idObservable()),u=this,jQuery.ajax({url:r,type:"GET"}).done(function(n){for(var r={hasMore:n.hasMore,entries:[]},t=0;t<n.pages.length;++t)r.entries.push(u.createDialogObject(n.pages[t].id,n.pages[t].name,"/Kirja?id="+n.pages[t].id));i.resolve(r)}).fail(function(){i.reject()}),i.promise()},openCreatePage:function(){this.dialogCreateNewCallback()},searchNpcs:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/KortistoApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Kortisto/Npc?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchItems:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/StyrApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Styr/Item?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchSkills:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/EvneApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Evne/Skill?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchQuest:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/AikaApi/GetQuests?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.quests.length;++t)u.entries.push(r.createDialogObject(n.quests[t].id,n.quests[t].name,"/Aika/Quest?id="+n.quests[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchChapterDetails:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/AikaApi/GetChapterDetails?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.details.length;++t)r.idObservable&&r.idObservable()==n.details[t].id||u.entries.push(r.createDialogObject(n.details[t].id,n.details[t].name,"/Aika/Detail?id="+n.details[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()}}})(n.ChooseObjectDialog=n.ChooseObjectDialog||{})})(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){this.isOpen=new ko.observable(!1);var n=this;this.isOpen.subscribe(function(t){!t&&n.markAsImplementedPromise&&n.markAsImplementedPromise.reject()});this.objectName=new ko.observable("");this.isLoading=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.markAsImplementedPromise=null;this.flagAsImplementedMethodUrlPostfix=null;this.doesSnapshotExists=new ko.observable(!1);this.difference=new ko.observableArray};t.ViewModel.prototype={openNpcCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagNpcAsImplemented?npcId="+n,this.loadCompareResult("CompareNpc?npcId="+n)},openItemCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagItemAsImplemented?itemId="+n,this.loadCompareResult("CompareItem?itemId="+n)},openSkillCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagSkillAsImplemented?skillId="+n,this.loadCompareResult("CompareSkill?skillId="+n)},openDialogCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagDialogAsImplemented?dialogId="+n,this.loadCompareResult("CompareDialog?dialogId="+n)},openQuestCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagQuestAsImplemented?questId="+n,this.loadCompareResult("CompareQuest?questId="+n)},openMarkerCompare:function(n,t,i){return this.isOpen(!0),this.objectName(""),this.flagAsImplementedMethodUrlPostfix="FlagMarkerAsImplemented?mapId="+n+"&markerId="+t+"&markerType="+i,this.loadCompareResult("CompareMarker?mapId="+n+"&markerId="+t+"&markerType="+i)},loadCompareResult:function(n){this.isLoading(!0);this.errorOccured(!1);this.difference([]);var t=this;return jQuery.ajax({url:"/api/ImplementationStatusApi/"+n,type:"GET"}).done(function(n){t.isLoading(!1);t.addExpandedObservable(n.compareDifference);t.doesSnapshotExists(n.doesSnapshotExist);n.compareDifference&&t.difference(n.compareDifference)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)}),this.markAsImplementedPromise=new jQuery.Deferred,this.markAsImplementedPromise.promise()},addExpandedObservable:function(n){if(n)for(var t=0;t<n.length;++t)n[t].isExpanded=new ko.observable(!0),this.addExpandedObservable(n[t].subDifferences)},toggleCompareResultExpanded:function(n){n.isExpanded(!n.isExpanded())},markAsImplemented:function(){this.isLoading(!0);this.errorOccured(!1);var t=this;jQuery.ajax({url:"/api/ImplementationStatusApi/"+this.flagAsImplementedMethodUrlPostfix,headers:n.Util.generateAntiForgeryHeader(),type:"POST"}).done(function(){window.refreshImplementationStatusList&&window.refreshImplementationStatusList();t.markAsImplementedPromise.resolve();t.markAsImplementedPromise=null;t.isLoading(!1);t.isOpen(!1)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})},closeDialog:function(){this.isOpen(!1)}}})(t.CompareDialog=t.CompareDialog||{})})(n.ImplementationStatus=n.ImplementationStatus||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){t.getFilteredFieldsForScript=function(t){var r,i,f,u,e;if(!t)return[];for(r=[],i=0;i<t.length;++i)if(t[i].fieldType!=n.FlexFieldDatabase.ObjectForm.FlexFieldTypeMultiLine&&(!t[i].scriptSettings||!t[i].scriptSettings.dontExportToScript)&&(r.push(t[i]),t[i].scriptSettings&&t[i].scriptSettings.additionalScriptNames))for(f=t[i].scriptSettings.additionalScriptNames.split(n.FlexFieldDatabase.ObjectForm.FlexFieldScriptSettingsAdditionalScriptNameSeperator),u=0;u<f.length;++u)e=jQuery.extend({},t[i]),e.name=f[u],r.push(e);return r}})(n.Util=n.Util||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldScriptSettingsAdditionalScriptNameSeperator=",";n.FlexFieldScriptSettings=function(){this.dontExportToScript=!1;this.additionalScriptNames=""};n.FlexFieldScriptSettings.prototype={serialize:function(){return{dontExportToScript:this.dontExportToScript,additionalScriptNames:this.additionalScriptNames}},deserialize:function(n){this.dontExportToScript=n.dontExportToScript;this.additionalScriptNames=n.additionalScriptNames}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldBase=function(){this.id=new ko.observable("");this.createdFromTemplate=new ko.observable(!1);this.name=new ko.observable;this.scriptSettings=new n.FlexFieldScriptSettings};n.FlexFieldBase.prototype={getType:function(){},getTemplateName:function(){},canExportToScript:function(){},serializeValue:function(){},deserializeValue:function(){},getChildFields:function(){return null},hasAdditionalConfiguration:function(){return!1},getAdditionalConfigurationLabel:function(){return""},allowEditingAdditionalConfigForTemplateFields:function(){return!1},setAdditionalConfiguration:function(){},getAdditionalConfiguration:function(){return""},serializeAdditionalConfiguration:function(){return""},deserializeAdditionalConfiguration:function(){},groupFields:function(){}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeSingleLine=0;n.SingleLineFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable("")};n.SingleLineFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.SingleLineFlexField.prototype.getType=function(){return n.FlexFieldTypeSingleLine};n.SingleLineFlexField.prototype.getTemplateName=function(){return"gn-singleLineField"};n.SingleLineFlexField.prototype.canExportToScript=function(){return!0};n.SingleLineFlexField.prototype.serializeValue=function(){return this.value()};n.SingleLineFlexField.prototype.deserializeValue=function(n){this.value(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeMultiLine=1;n.MultiLineFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable("")};n.MultiLineFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.MultiLineFlexField.prototype.getType=function(){return n.FlexFieldTypeMultiLine};n.MultiLineFlexField.prototype.getTemplateName=function(){return"gn-multiLineField"};n.MultiLineFlexField.prototype.canExportToScript=function(){return!1};n.MultiLineFlexField.prototype.serializeValue=function(){return this.value()};n.MultiLineFlexField.prototype.deserializeValue=function(n){this.value(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeNumber=2;n.NumberFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable(0)};n.NumberFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.NumberFlexField.prototype.getType=function(){return n.FlexFieldTypeNumber};n.NumberFlexField.prototype.getTemplateName=function(){return"gn-numberField"};n.NumberFlexField.prototype.canExportToScript=function(){return!0};n.NumberFlexField.prototype.serializeValue=function(){return this.value()?this.value().toString():"0.0"};n.NumberFlexField.prototype.deserializeValue=function(n){var t=parseFloat(n);isNaN(t)?this.value(0):this.value(t)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.FlexFieldTypeOption=3;t.OptionFlexField=function(){t.FlexFieldBase.apply(this);this.value=new ko.observable(null);this.options=new ko.observableArray};t.OptionFlexField.prototype=jQuery.extend(!0,{},t.FlexFieldBase.prototype);t.OptionFlexField.prototype.getType=function(){return t.FlexFieldTypeOption};t.OptionFlexField.prototype.getTemplateName=function(){return"gn-optionField"};t.OptionFlexField.prototype.canExportToScript=function(){return!0};t.OptionFlexField.prototype.serializeValue=function(){return this.value()};t.OptionFlexField.prototype.deserializeValue=function(n){this.value(n)};t.OptionFlexField.prototype.hasAdditionalConfiguration=function(){return!0};t.OptionFlexField.prototype.getAdditionalConfigurationLabel=function(){return n.FlexFieldDatabase.Localization.OptionFieldAdditionalConfigurationLabel};t.OptionFlexField.prototype.allowEditingAdditionalConfigForTemplateFields=function(){return!1};t.OptionFlexField.prototype.setAdditionalConfiguration=function(n){var t=[];n&&(t=n.split("\n"));this.options(t)};t.OptionFlexField.prototype.getAdditionalConfiguration=function(){return this.options().join("\n")};t.OptionFlexField.prototype.serializeAdditionalConfiguration=function(){return JSON.stringify(this.options())};t.OptionFlexField.prototype.deserializeAdditionalConfiguration=function(n){var t=[];n&&(t=JSON.parse(n));this.options(t)}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldGroup=100;n.FieldGroup=function(){n.FlexFieldBase.apply(this);this.fields=new ko.observableArray;this.deserializingFieldIds=null;this.isExpandedByDefault=!0;this.areFieldsExpanded=new ko.observable(!0)};n.FieldGroup.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.FieldGroup.prototype.getType=function(){return n.FlexFieldGroup};n.FieldGroup.prototype.getTemplateName=function(){return"gn-fieldGroup"};n.FieldGroup.prototype.canExportToScript=function(){return!1};n.FieldGroup.prototype.serializeValue=function(n){for(var i=[],r=this.fields(),t=0;t<r.length;++t)r[t].id()?i.push(r[t].id()):i.push((n+t+1).toString());return JSON.stringify(i)};n.FieldGroup.prototype.getChildFields=function(){return this.fields()};n.FieldGroup.prototype.deserializeValue=function(n){this.deserializingFieldIds=[];n&&(this.deserializingFieldIds=JSON.parse(n))};n.FieldGroup.prototype.serializeAdditionalConfiguration=function(){return JSON.stringify({isExpandedByDefault:this.isExpandedByDefault})};n.FieldGroup.prototype.deserializeAdditionalConfiguration=function(n){if(n){var t=JSON.parse(n);this.isExpandedByDefault=t.isExpandedByDefault;this.areFieldsExpanded(this.isExpandedByDefault)}};n.FieldGroup.prototype.groupFields=function(n,t){var i,f,r,u;if(this.deserializingFieldIds){for(i=0;i<this.deserializingFieldIds.length;++i){for(f=!1,r=0;r<n.length;++r)if(n[r].id()==this.deserializingFieldIds[i]){t[r]||(this.fields.push(n[r]),t[r]=!0);f=!0;break}!f&&this.deserializingFieldIds[i]&&this.deserializingFieldIds[i].indexOf("-")<0&&(u=parseInt(this.deserializingFieldIds[i]),!isNaN(u)&&u>=0&&u<n.length&&(this.fields.push(n[u]),t[u]=!0))}this.deserializingFieldIds=null}};n.FieldGroup.prototype.toogleFieldVisibility=function(){this.areFieldsExpanded(!this.areFieldsExpanded())};n.FieldGroup.prototype.deleteField=function(n){this.fields.remove(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldManager=function(){this.fields=new ko.observableArray};n.FlexFieldManager.prototype={addSingleLineField:function(t){return this.addField(n.FlexFieldTypeSingleLine,t)},addMultiLineField:function(t){return this.addField(n.FlexFieldTypeMultiLine,t)},addNumberField:function(t){return this.addField(n.FlexFieldTypeNumber,t)},addOptionField:function(t){return this.addField(n.FlexFieldTypeOption,t)},addFieldGroup:function(t){return this.addField(n.FlexFieldGroup,t)},addField:function(n,t){var i=this.resolveFieldByType(n);if(!i)throw"Unknown field type";return i.name(t),this.fields.push(i),i},resolveFieldByType:function(t){switch(t){case n.FlexFieldTypeSingleLine:return new n.SingleLineFlexField;case n.FlexFieldTypeMultiLine:return new n.MultiLineFlexField;case n.FlexFieldTypeNumber:return new n.NumberFlexField;case n.FlexFieldTypeOption:return new n.OptionFlexField;case n.FlexFieldGroup:return new n.FieldGroup}return null},deleteField:function(n){this.fields.remove(n)},deleteFieldGroup:function(n){var r,i,t;if(n.fields)for(r=this.fields.indexOf(n),i=n.fields(),t=0;t<i.length;++t)r<0?this.fields.push(i[t]):this.fields.splice(r+t,0,i[t]);this.fields.remove(n)},serializeFields:function(){for(var i,r,n=[],u=this.fields(),t=0;t<u.length;++t)if(n.push(this.serializeSingleField(u[t],n)),i=u[t].getChildFields(),i)for(r=0;r<i.length;++r)n.push(this.serializeSingleField(i[r],n));return n},serializeSingleField:function(n,t){return{id:n.id(),createdFromTemplate:n.createdFromTemplate(),fieldType:n.getType(),name:n.name(),value:n.serializeValue(t.length),additionalConfiguration:n.serializeAdditionalConfiguration(),scriptSettings:n.scriptSettings.serialize()}},deserializeFields:function(n){for(var i,u,r=[],t=0;t<n.length;++t)i=this.resolveFieldByType(n[t].fieldType),i.id(n[t].id),i.createdFromTemplate(n[t].createdFromTemplate),i.name(n[t].name),i.deserializeValue(n[t].value),i.deserializeAdditionalConfiguration(n[t].additionalConfiguration),i.scriptSettings.deserialize(n[t].scriptSettings),r.push(i);for(u={},t=0;t<r.length;++t)r[t].groupFields(r,u);for(t=r.length-1;t>=0;--t)u[t]&&r.splice(t,1);this.fields(r)},syncFieldIds:function(n){for(var i,r={},t=0;t<n.fields.length;++t)r[n.fields[t].name]=n.fields[t].id;for(i=this.fields(),t=0;t<i.length;++t)i[t].id(r[i[t].name()])},flagFieldsAsCreatedFromTemplate:function(){for(var t,i,r=this.fields(),n=0;n<r.length;++n)if(r[n].createdFromTemplate(!0),t=r[n].getChildFields(),t)for(i=0;i<t.length;++i)t[i].createdFromTemplate(!0)},isFieldNameInUse:function(n,t){var r,i,u,f;for(n=n.toLowerCase(),r=this.fields(),i=0;i<r.length;++i){if(r[i]!=t&&r[i].name()&&r[i].name().toLowerCase()==n)return!0;if(u=r[i].getChildFields(),u)for(f=0;f<u.length;++f)if(u[f]!=t&&u[f].name()&&u[f].name().toLowerCase()==n)return!0}}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.FlexFieldHandlingViewModel=function(){this.fieldManager=new n.FlexFieldDatabase.ObjectForm.FlexFieldManager;this.showFieldCreateEditDialog=new ko.observable(!1);this.isEditingField=new ko.observable(!1);this.fieldToEdit=null;this.createEditFieldName=new ko.observable("");this.createEditFieldAdditionalConfigurationDisabled=new ko.observable(!1);this.createEditFieldHasAdditionalConfiguration=new ko.observable(!1);this.createEditFieldAdditionalConfiguration=new ko.observable("");this.createEditFieldAdditionalConfigurationLabel=new ko.observable("");this.createEditFieldDeferred=null;this.showConfirmFieldDeleteDialog=new ko.observable(!1);this.fieldToDelete=null;this.fieldToDeleteParent=null;this.showFieldScriptSettingsDialog=new ko.observable(!1);this.dontExportFieldToScript=new ko.observable;this.additionalFieldScriptNames=new ko.observable;this.scriptSettingsField=null;this.showFieldGroupCreateEditDialog=new ko.observable(!1);this.fieldGroupToEdit=null;this.isEditingFieldGroup=new ko.observable(!1);this.createEditFieldGroupName=new ko.observable("");this.createEditFieldGroupExpandedByDefault=new ko.observable(!1);this.showDuplicateFieldNameError=new ko.observable(!1);var t=this;this.createEditFieldName.subscribe(function(){t.showDuplicateFieldNameError(!1)});this.createEditFieldGroupName.subscribe(function(){t.showDuplicateFieldNameError(!1)});this.showConfirmFieldGroupDeleteDialog=new ko.observable(!1);this.fieldGroupToDelete=null};t.FlexFieldHandlingViewModel.prototype={onFieldAdded:function(){},addSingleLineField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addSingleLineField(t);n.onFieldAdded()})},addMultiLineField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addMultiLineField(t);n.onFieldAdded()})},addNumberField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addNumberField(t);n.onFieldAdded()})},addOptionField:function(){var t=this;this.openCreateEditFieldDialog(!1,"",!0,"",n.FlexFieldDatabase.Localization.OptionFieldAdditionalConfigurationLabel,!1).done(function(n,i){var r=t.fieldManager.addOptionField(n);r.setAdditionalConfiguration(i);t.onFieldAdded()})},editField:function(n){var t=!n.allowEditingAdditionalConfigForTemplateFields()&&n.createdFromTemplate();this.openCreateEditFieldDialog(!0,n,n.hasAdditionalConfiguration(),n.getAdditionalConfiguration(),n.getAdditionalConfigurationLabel(),t).done(function(t,i){n.name(t);n.hasAdditionalConfiguration()&&n.setAdditionalConfiguration(i)})},openCreateEditFieldDialog:function(t,i,r,u,f,e){return this.createEditFieldDeferred=new jQuery.Deferred,this.isEditingField(t),i?(this.createEditFieldName(i.name()),this.fieldToEdit=i):(this.createEditFieldName(""),this.fieldToEdit=null),this.createEditFieldHasAdditionalConfiguration(r?!0:!1),r&&(this.createEditFieldAdditionalConfigurationDisabled(e),this.createEditFieldAdditionalConfigurationLabel(f),this.createEditFieldAdditionalConfiguration(u?u:"")),n.Util.setupValidation("#gn-fieldCreateEditForm"),this.showFieldCreateEditDialog(!0),this.createEditFieldDeferred.promise()},saveField:function(){if(jQuery("#gn-fieldCreateEditForm").valid()){if(this.fieldManager.isFieldNameInUse(this.createEditFieldName(),this.fieldToEdit)){this.showDuplicateFieldNameError(!0);return}if(this.createEditFieldDeferred){var n=null;this.createEditFieldHasAdditionalConfiguration()&&(n=this.createEditFieldAdditionalConfiguration());this.createEditFieldDeferred.resolve(this.createEditFieldName(),n)}this.createEditFieldDeferred=null;this.showFieldCreateEditDialog(!1)}},cancelFieldDialog:function(){this.createEditFieldDeferred&&this.createEditFieldDeferred.reject();this.createEditFieldDeferred=null;this.fieldToEdit=null;this.showFieldCreateEditDialog(!1)},openCreateNewFieldGroupDialog:function(){n.Util.setupValidation("#gn-fieldGroupCreateEditForm");this.showFieldGroupCreateEditDialog(!0);this.fieldGroupToEdit=null;this.isEditingFieldGroup(!1);this.createEditFieldGroupName("");this.createEditFieldGroupExpandedByDefault(!0)},openEditFieldGroupDialog:function(t){n.Util.setupValidation("#gn-fieldGroupCreateEditForm");this.showFieldGroupCreateEditDialog(!0);this.fieldGroupToEdit=t;this.isEditingFieldGroup(!0);this.createEditFieldGroupName(t.name());this.createEditFieldGroupExpandedByDefault(t.isExpandedByDefault)},saveFieldGroup:function(){if(jQuery("#gn-fieldGroupCreateEditForm").valid()){if(this.fieldManager.isFieldNameInUse(this.createEditFieldGroupName(),this.fieldGroupToEdit)){this.showDuplicateFieldNameError(!0);return}if(this.fieldGroupToEdit==null){var n=this.fieldManager.addFieldGroup(this.createEditFieldGroupName());n.isExpandedByDefault=this.createEditFieldGroupExpandedByDefault();n.areFieldsExpanded(n.isExpandedByDefault)}else this.fieldGroupToEdit.name(this.createEditFieldGroupName()),this.fieldGroupToEdit.isExpandedByDefault=this.createEditFieldGroupExpandedByDefault(),this.fieldGroupToEdit.areFieldsExpanded(this.fieldGroupToEdit.isExpandedByDefault);this.closeFieldGroupDialog()}},closeFieldGroupDialog:function(){this.fieldGroupToEdit=null;this.showFieldGroupCreateEditDialog(!1)},openConfirmDeleteFieldGroupDialog:function(n){this.showConfirmFieldGroupDeleteDialog(!0);this.fieldGroupToDelete=n},closeConfirmFieldGroupDeleteDialog:function(){this.showConfirmFieldGroupDeleteDialog(!1);this.fieldGroupToDelete=null},deleteFieldGroup:function(){this.fieldManager.deleteFieldGroup(this.fieldGroupToDelete);this.closeConfirmFieldGroupDeleteDialog()},checkFieldDropAllowed:function(n){n.item.getType()==t.FlexFieldGroup&&n.targetParent!=this.fieldManager.fields&&(n.cancelDrop=!0)},openConfirmDeleteFieldDialog:function(n,t){this.showConfirmFieldDeleteDialog(!0);this.fieldToDelete=n;this.fieldToDeleteParent=t},closeConfirmFieldDeleteDialog:function(){this.showConfirmFieldDeleteDialog(!1);this.fieldToDelete=null;this.fieldToDeleteParent=null},deleteField:function(){this.fieldToDeleteParent!=null&&typeof this.fieldToDeleteParent.getType=="function"&&this.fieldToDeleteParent.getType()==t.FlexFieldGroup?this.fieldToDeleteParent.deleteField(this.fieldToDelete):this.fieldManager.deleteField(this.fieldToDelete);this.closeConfirmFieldDeleteDialog()},openScriptSettings:function(n){this.showFieldScriptSettingsDialog(!0);this.dontExportFieldToScript(n.scriptSettings.dontExportToScript);this.additionalFieldScriptNames(n.scriptSettings.additionalScriptNames);this.scriptSettingsField=n},saveFieldScriptSettings:function(){this.scriptSettingsField.scriptSettings.dontExportToScript=this.dontExportFieldToScript();this.scriptSettingsField.scriptSettings.additionalScriptNames=this.additionalFieldScriptNames();this.closeFieldScriptSettingsDialog()},closeFieldScriptSettingsDialog:function(){this.showFieldScriptSettingsDialog(!1);this.scriptSettingsField=null}}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){function r(n){return{questState:n,label:i[n]}}var u=0,f=1,e=2,o=3,i={};i[u]=n.Localization.QuestStates.NotStarted;i[f]=n.Localization.QuestStates.InProgress;i[e]=n.Localization.QuestStates.Success;i[o]=n.Localization.QuestStates.Failed;t.getQuestStateLabel=function(n){return i[n]};t.getQuestStates=function(){return[r(u),r(f),r(e),r(o)]}})(n.Shapes=n.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.ObjectResourceNpc=0;n.ObjectResourceItem=1;n.ObjectResourceQuest=2;n.ObjectResourceDialogs=3;n.ObjectResourceMapMarker=4;n.ObjectResourceSkill=5;var t={},i={};n.resetSharedObjectLoading=function(n,r){t[n]&&t[n][r]&&(t[n][r]=null);i[n]&&i[n][r]&&(i[n][r]=null)};n.SharedObjectLoading=function(){};n.SharedObjectLoading.prototype={getObjectId:function(){},getObjectResource:function(){},clearLoadedSharedObject:function(n){var r=this.getObjectId(n);t[this.getObjectResource()]&&(t[this.getObjectResource()][r]=null);i[this.getObjectResource()]&&(i[this.getObjectResource()][r]=null)},loadObjectShared:function(n){var r=this.getObjectId(n),e,o,s,u,f;return t[this.getObjectResource()]&&(e=t[this.getObjectResource()][r],e)?(o=new jQuery.Deferred,o.resolve(e),o.promise()):i[this.getObjectResource()]&&(s=i[this.getObjectResource()][r],s)?s:(u=this.loadObject(r),i[this.getObjectResource()]||(i[this.getObjectResource()]={}),i[this.getObjectResource()][r]=u,f=this,u.then(function(n){t[f.getObjectResource()]||(t[f.getObjectResource()]={});t[f.getObjectResource()][r]=n}),u)},loadObject:function(){}}})(n.Shapes=n.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){t.BaseViewModel=function(){this.nodeGraph=new ko.observable;this.nodePaper=new ko.observable;this.showConfirmNodeDeleteDialog=new ko.observable(!1);this.deleteLoading=new ko.observable(!1);this.deleteErrorOccured=new ko.observable(!1);this.deleteErrorAdditionalInformation=new ko.observable("");this.deleteNodeTarget=null;this.deleteDeferred=null;this.errorOccured=new ko.observable(!1)};t.BaseViewModel.prototype={addNewNode:function(n,t,i){if(this.nodeGraph()&&this.nodePaper()){var r=this.calcNodeInitOptionsPosition(t,i);this.addNodeByType(n.data("nodetype"),r)}},calcNodeInitOptionsPosition:function(n,t){var i=this.nodePaper().scale(),r=this.nodePaper().translate();return{position:{x:(n-r.tx)/i.sx,y:(t-r.ty)/i.sy}}},addNodeByType:function(t,i){var r=n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().createNewNode(t,i);if(r==null){this.errorOccured(!0);return}this.nodeGraph().addCells(r);this.setupNewNode(r)},setupNewNode:function(n){n.attr(".inPorts circle/magnet","passive");var t=this;n.onDelete=function(n){return t.onDelete(n)}},reloadFieldsForNodes:function(t,i){var e,f,r,u;if(n.DefaultNodeShapes.Shapes.resetSharedObjectLoading(t,i),this.nodeGraph())for(e=this.nodePaper(),f=this.nodeGraph().getElements(),r=0;r<f.length;++r)u=e.findViewByModel(f[r]),u&&u.reloadSharedLoadedData&&u.reloadSharedLoadedData(t,i)},onDelete:function(n){return this.deleteLoading(!1),this.deleteErrorOccured(!1),this.deleteErrorAdditionalInformation(""),this.showConfirmNodeDeleteDialog(!0),this.deleteNodeTarget=n,this.deleteDeferred=new jQuery.Deferred,this.deleteDeferred.promise()},deleteNode:function(){var t,n;this.deleteNodeTarget&&this.deleteNodeTarget.validateDelete?(t=this.deleteNodeTarget.validateDelete(),t?(n=this,this.deleteLoading(!0),this.deleteErrorOccured(!1),this.deleteErrorAdditionalInformation(""),t.done(function(){n.deleteLoading(!1);n.resolveDeleteDeferred()}).fail(function(t){n.deleteLoading(!1);n.deleteErrorOccured(!0);n.deleteErrorAdditionalInformation(t)})):this.resolveDeleteDeferred()):this.resolveDeleteDeferred()},resolveDeleteDeferred:function(){this.deleteDeferred&&(this.deleteDeferred.resolve(),this.deleteDeferred=null);this.closeConfirmNodeDeleteDialog()},closeConfirmNodeDeleteDialog:function(){this.deleteDeferred&&(this.deleteDeferred.reject(),this.deleteDeferred=null);this.showConfirmNodeDeleteDialog(!1);this.deleteLoading(!1);this.deleteErrorOccured(!1);this.deleteErrorAdditionalInformation("");this.deleteNodeTarget=null},setGraphToReadonly:function(){jQuery(".gn-nodeGraphContainer").find("input,textarea,select").prop("disabled",!0);jQuery(".gn-nodeGraphContainer").find(".joint-cell").css("pointer-events","none");jQuery(".gn-nodeGraphContainer").find(".gn-nodeDeleteOnReadonly").remove();jQuery(".gn-nodeGraphContainer").find(".gn-nodeNonClickableOnReadonly").css("pointer-events","none")}}})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){var t=function(){this.availableConditionTypes=[]},i;t.prototype={addConditionType:function(n){this.availableConditionTypes.push(n)},getConditionTypes:function(){return this.availableConditionTypes},getSelectableConditionTypes:function(){for(var t=[],n=0;n<this.availableConditionTypes.length;++n)this.availableConditionTypes[n].canBeSelected()&&t.push(this.availableConditionTypes[n]);return t},getConditionTemplate:function(n){var t=this.getConditionType(n);return t?t.getTemplateName():"gn-nodeConditionEmpty"},isConditionTypeSelectable:function(n){var t=this.getConditionType(n);return t?t.canBeSelected():!0},buildConditionData:function(n,t,i){i.errorOccured(!1);var r=this.getConditionType(n);return r?r.buildConditionData(t,i):null},serializeCondition:function(t){return{id:t.id,dependsOnObjects:n.getConditionManager().getConditionElementsDependsOnObject(t.conditionElements),conditionElements:JSON.stringify(t.conditionElements)}},deserializeCondition:function(n){return{id:n.id,conditionElements:JSON.parse(n.conditionElements)}},serializeConditionElement:function(n){var t=this.getConditionType(n.conditionType());return t?{conditionType:n.conditionType(),conditionData:t.serializeConditionData(n.conditionData())}:null},getConditionElementsDependsOnObject:function(t){for(var r,i,f,e={},o=[],u=0;u<t.length;++u)for(r=n.getConditionManager().getConditionElementDependsOnObject(t[u].conditionType,t[u].conditionData),i=0;i<r.length;++i)f=r[i].objectType+"|"+r[i].objectId,e[f]||(o.push(r[i]),e[f]=!0);return o},getConditionElementDependsOnObject:function(n,t){var i=this.getConditionType(n);return i?i.getConditionDependsOnObject(t):[]},getConditionType:function(n){for(var t=0;t<this.availableConditionTypes.length;++t)if(this.availableConditionTypes[t].getType()==n)return this.availableConditionTypes[t];return null},convertElements:function(n){for(var r,i=[],t=0;t<n.length;++t)r=this.convertElement(n[t]),i.push(r);return i},convertElement:function(n){var t={isSelected:new ko.observable(!1),conditionType:new ko.observable(n.conditionType),conditionData:new ko.observable(null),conditionTemplate:new ko.observable("gn-nodeConditionEmpty"),parent:null,errorOccured:new ko.observable(!1)};return t.conditionData(this.buildConditionData(n.conditionType,n.conditionData,t)),t.conditionTemplate(this.getConditionTemplate(n.conditionType)),this.addSharedFunctions(t),t},createEmptyElement:function(){var n={isSelected:new ko.observable(!1),conditionType:new ko.observable(""),conditionData:new ko.observable(null),conditionTemplate:new ko.observable("gn-nodeConditionEmpty"),parent:null,errorOccured:new ko.observable(!1)};return this.addSharedFunctions(n),n},addSharedFunctions:function(n){var t=this;n.conditionType.subscribe(function(){n.conditionTemplate("gn-nodeConditionEmpty");n.conditionData(t.buildConditionData(n.conditionType(),null,n));n.conditionTemplate(t.getConditionTemplate(n.conditionType()))})},getConditionString:function(n,t,i){for(var e,r=new jQuery.Deferred,f=[],u=0;u<n.length;++u)e=this.getConditionType(n[u].conditionType),f.push(e.getConditionString(n[u].conditionData));return jQuery.when.apply(jQuery,f).then(function(){var f,n,u;if(arguments.length==0){r.resolve("");return}for(f=[],n=0;n<arguments.length;++n)f.push(arguments[n]);u=f.join(" "+t+" ");i&&(u="("+u+")");r.resolve(u)},function(n){r.reject(n)}),r.promise()}};i=new t;n.getConditionManager=function(){return i}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.RelatedToObjectNpc="Npc";n.RelatedToObjectItem="Item";n.RelatedToObjectQuest="Quest";n.RelatedToObjectSkill="Skill";n.BaseCondition=function(){this.nodeModel=null};n.BaseCondition.prototype={getType:function(){return-1},getLabel:function(){},canBeSelected:function(){},getTemplateName:function(){},buildConditionData:function(){},serializeConditionData:function(){},getConditionDependsOnObject:function(){},getConditionString:function(){}}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){t.GroupConditionType=1;t.GroupConditionOperatorAnd=0;t.GroupConditionOperatorOr=1;t.GroupCondition=function(){t.BaseCondition.apply(this)};t.GroupCondition.prototype=jQuery.extend({},t.BaseCondition.prototype);t.GroupCondition.prototype.getType=function(){return t.GroupConditionType};t.GroupCondition.prototype.getLabel=function(){return""};t.GroupCondition.prototype.canBeSelected=function(){return!1};t.GroupCondition.prototype.getTemplateName=function(){return"gn-nodeConditionGroup"};t.GroupCondition.prototype.buildConditionData=function(i,r){var u={operator:new ko.observable(i.operator),conditionElements:new ko.observableArray},f,e;if(i.fromDialog)u.conditionElements(i.conditionElements);else{for(f=t.getConditionManager().convertElements(i.conditionElements),e=0;e<f.length;++e)f[e].parent=r;u.conditionElements(f)}return u.operatorText=new ko.computed(function(){return u.operator()==t.GroupConditionOperatorAnd?n.Localization.Conditions.AndOperator:n.Localization.Conditions.OrOperator}),u.toggleOperator=function(){u.operator()==t.GroupConditionOperatorAnd?u.operator(t.GroupConditionOperatorOr):u.operator(t.GroupConditionOperatorAnd)},u};t.GroupCondition.prototype.serializeConditionData=function(n){for(var f,r={operator:n.operator(),conditionElements:[]},u=n.conditionElements(),i=0;i<u.length;++i)f=t.getConditionManager().serializeConditionElement(u[i]),r.conditionElements.push(f);return r};t.GroupCondition.prototype.getConditionDependsOnObject=function(n){return t.getConditionManager().getConditionElementsDependsOnObject(n.conditionElements)};t.GroupCondition.prototype.getConditionString=function(i){return t.getConditionManager().getConditionString(i.conditionElements,i.operator==t.GroupConditionOperatorAnd?n.Localization.Conditions.AndOperatorShort:n.Localization.Conditions.OrOperatorShort,!0)};t.getConditionManager().addConditionType(new t.GroupCondition)})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.CheckValueCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this);this.fieldObjectId=""};i.CheckValueCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckValueCondition.prototype=jQuery.extend(i.CheckValueCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckValueCondition.prototype.getTemplateName=function(){return"gn-nodeConditionValueCheck"};i.CheckValueCondition.prototype.canBeSelected=function(){return!0};i.CheckValueCondition.prototype.processAditionalLoadedObjectConditionData=function(){};i.CheckValueCondition.prototype.getSelectedField=function(n,t){for(var r=null,i=0;i<t.length;++i)if(t[i].id==n.fieldId&&(r=t[i],t[i].name==n.fieldName))break;return r};i.CheckValueCondition.prototype.buildConditionDataNoLoad=function(t){var i={selectedField:new ko.observable,operator:new ko.observable,compareValue:new ko.observable,availableFields:new ko.observable};return t&&i.compareValue(t.compareValue?t.compareValue:null),i.validateInput=function(t,r){if(i.selectedField().fieldType!=n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber)return!0;return n.Util.validateNumberKeyPress(r.target,r)},i.availableOperators=new ko.computed(function(){if(!this.selectedField())return[];var t=["=","!=","contains","startsWith","endsWith"];return this.selectedField().fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber&&(t=["=","!=","<=","<",">=",">"]),t},i),i.selectedField.subscribe(function(){if(i.selectedField().fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber){var t=parseFloat(i.compareValue());isNaN(t)&&i.compareValue("0")}}),i};i.CheckValueCondition.prototype.buildConditionData=function(n,t){var i=this.buildConditionDataNoLoad(n,t);return this.canLoadFieldObject(n)&&this.loadAndParseFields(i,n,t),i};i.CheckValueCondition.prototype.canLoadFieldObject=function(){return!0};i.CheckValueCondition.prototype.loadAndParseFields=function(i,r,u){var f=this;this.loadObjectShared(r).then(function(u){var e,o,s,h;if(u){for(f.fieldObjectId=u.id,e=n.Util.getFilteredFieldsForScript(u.fields),o=0;o<e.length;++o)s=e[o].name+" (",s+=e[o].fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber?t.Localization.Conditions.NumberField:t.Localization.Conditions.TextField,s+=")",e[o].displayName=s;i.availableFields(e);r&&(h=f.getSelectedField(r,e),h&&i.selectedField(h),i.operator(r.operator?r.operator:null));f.processAditionalLoadedObjectConditionData(i,u)}},function(){u.errorOccured(!0)})};i.CheckValueCondition.prototype.serializeConditionData=function(n){return{fieldId:n.selectedField()?n.selectedField().id:null,fieldName:n.selectedField()?n.selectedField().name:null,operator:n.operator(),compareValue:n.compareValue()?n.compareValue():null}};i.CheckValueCondition.prototype.getDependsOnObjectId=function(){return this.fieldObjectId};i.CheckValueCondition.prototype.getConditionDependsOnObject=function(n){var t=this.getDependsOnObjectId(n);return[{objectType:this.getObjectTypeName(),objectId:t}]};i.CheckValueCondition.prototype.getObjectTypeName=function(){};i.CheckValueCondition.prototype.getObjectTitle=function(){};i.CheckValueCondition.prototype.getConditionString=function(i){var r=new jQuery.Deferred,u;return!this.canLoadFieldObject(i)||i.fieldId==null?(r.resolve(t.Localization.Conditions.MissingInformations),r.promise()):(u=this,this.loadObjectShared(i).then(function(f){var s,e;if(u.fieldObjectId=f.id,s=n.Util.getFilteredFieldsForScript(f.fields),e=u.getSelectedField(i,s),!e){r.reject(t.Localization.Conditions.FieldWasDeleted);return}var o=u.getObjectTitle(f)+'("'+e.name+'") '+i.operator+" ",h=e.fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber,c="0";h||(o+='"',c="");o+=i.compareValue?i.compareValue:c;h||(o+='"');r.resolve(o)},function(){r.reject()}),r.promise())}})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){t.CheckChooseObjectValueCondition=function(){n.Conditions.CheckValueCondition.apply(this)};t.CheckChooseObjectValueCondition.prototype=jQuery.extend({},n.Conditions.CheckValueCondition.prototype);t.CheckChooseObjectValueCondition.prototype.openObjectSearchDialog=function(){};t.CheckChooseObjectValueCondition.prototype.getChooseObjectLabel=function(){};t.CheckChooseObjectValueCondition.prototype.getTemplateName=function(){return"gn-nodeConditionChooseObjectValueCheck"};t.CheckChooseObjectValueCondition.prototype.canLoadFieldObject=function(n){return n&&n.selectedObjectId};t.CheckChooseObjectValueCondition.prototype.processAditionalLoadedObjectConditionData=function(n,t){n.selectedObjectName(t.name)};t.CheckChooseObjectValueCondition.prototype.getDependsOnObjectId=function(n){return this.getObjectId(n)};t.CheckChooseObjectValueCondition.prototype.getObjectId=function(n){return n.selectedObjectId};t.CheckChooseObjectValueCondition.prototype.buildConditionData=function(n,i){var r=t.CheckValueCondition.prototype.buildConditionDataNoLoad.apply(this,[n,i]),u;return r.selectedObjectId=new ko.observable(""),r.selectedObjectName=new ko.observable(this.getChooseObjectLabel()),n&&r.selectedObjectId(n.selectedObjectId),u=this,r.chooseObject=function(){u.openObjectSearchDialog().then(function(n){r.selectedObjectId(n.id);r.selectedObjectName(n.name);var t=u.serializeConditionData(r);u.loadAndParseFields(r,t,i)})},this.canLoadFieldObject(n)&&this.loadAndParseFields(r,n,i),r};t.CheckChooseObjectValueCondition.prototype.serializeConditionData=function(n){var i=t.CheckValueCondition.prototype.serializeConditionData.apply(this,[n]);return i.selectedObjectId=n.selectedObjectId(),i}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=6;i.CheckCurrentQuestValueCondition=function(){n.DefaultNodeShapes.Conditions.CheckValueCondition.apply(this)};i.CheckCurrentQuestValueCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.CheckValueCondition.prototype);i.CheckCurrentQuestValueCondition.prototype.getType=function(){return r};i.CheckCurrentQuestValueCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckCurrentQuestValueLabel};i.CheckCurrentQuestValueCondition.prototype.getObjectTitle=function(){return t.Localization.Conditions.CurrentQuestLabel};i.CheckCurrentQuestValueCondition.prototype.getObjectTypeName=function(){return"Quest"};i.CheckCurrentQuestValueCondition.prototype.getObjectId=function(){return t.getCurrentQuestId()};i.CheckCurrentQuestValueCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.CheckCurrentQuestValueCondition.prototype.loadObject=function(){var n=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+t.getCurrentQuestId(),type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckCurrentQuestValueCondition)})(t.Conditions=t.Conditions||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=7;i.CheckChooseQuestValueCondition=function(){t.Conditions.CheckChooseObjectValueCondition.apply(this)};i.CheckChooseQuestValueCondition.prototype=jQuery.extend({},t.Conditions.CheckChooseObjectValueCondition.prototype);i.CheckChooseQuestValueCondition.prototype.getType=function(){return r};i.CheckChooseQuestValueCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckChooseQuestValueLabel};i.CheckChooseQuestValueCondition.prototype.getObjectTitle=function(n){return n.name};i.CheckChooseQuestValueCondition.prototype.openObjectSearchDialog=function(){return n.DefaultNodeShapes.openQuestSearchDialog()};i.CheckChooseQuestValueCondition.prototype.getChooseObjectLabel=function(){return t.Localization.Conditions.ChooseQuestLabel};i.CheckChooseQuestValueCondition.prototype.getObjectTypeName=function(){return i.RelatedToObjectQuest};i.CheckChooseQuestValueCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.CheckChooseQuestValueCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise()};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckChooseQuestValueCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=8;i.CheckQuestStateCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.CheckQuestStateCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckQuestStateCondition.prototype=jQuery.extend(i.CheckQuestStateCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckQuestStateCondition.prototype.getTemplateName=function(){return"gn-nodeQuestStateCheck"};i.CheckQuestStateCondition.prototype.canBeSelected=function(){return!0};i.CheckQuestStateCondition.prototype.getType=function(){return r};i.CheckQuestStateCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckQuestStateLabel};i.CheckQuestStateCondition.prototype.getConditionDependsOnObject=function(n){return n.questId?[{objectType:i.RelatedToObjectQuest,objectId:n.questId}]:[]};i.CheckQuestStateCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.CheckQuestStateCondition.prototype.getObjectId=function(n){return n.questId};i.CheckQuestStateCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t};i.CheckQuestStateCondition.prototype.buildConditionData=function(i,r){var u={selectedQuestId:new ko.observable,selectedQuestName:new ko.observable(t.Localization.Conditions.ChooseQuestLabel),selectedQuestState:new ko.observable,questStates:t.Shapes.getQuestStates()};return u.chooseQuest=function(){n.DefaultNodeShapes.openQuestSearchDialog().then(function(n){u.selectedQuestId(n.id);u.selectedQuestName(n.name)})},i&&(u.selectedQuestId(i.questId),u.selectedQuestState(i.state),i.questId&&this.loadObjectShared(i).then(function(n){u.selectedQuestName(n.name)},function(){r.errorOccured(!0)})),u};i.CheckQuestStateCondition.prototype.serializeConditionData=function(n){return{questId:n.selectedQuestId(),state:n.selectedQuestState()}};i.CheckQuestStateCondition.prototype.getConditionString=function(n){var i=new jQuery.Deferred,r;return n.questId?(r=this,this.loadObjectShared(n).then(function(r){var u=t.Localization.Conditions.StateLabel+"("+r.name+") = "+t.Shapes.getQuestStateLabel(n.state);i.resolve(u)},function(){i.reject()}),i.promise()):(i.resolve(t.Localization.Conditions.MissingInformations),i.promise())};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckQuestStateCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var e=9,u=0,f=1,r={};r[u]=t.Localization.Conditions.NpcAliveStateAlive;r[f]=t.Localization.Conditions.NpcAliveStateDead;i.CheckNpcAliveStateCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.CheckNpcAliveStateCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckNpcAliveStateCondition.prototype=jQuery.extend(i.CheckNpcAliveStateCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckNpcAliveStateCondition.prototype.getTemplateName=function(){return"gn-nodeNpcAliveStateCheck"};i.CheckNpcAliveStateCondition.prototype.canBeSelected=function(){return!0};i.CheckNpcAliveStateCondition.prototype.getType=function(){return e};i.CheckNpcAliveStateCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckNpcAliveStateLabel};i.CheckNpcAliveStateCondition.prototype.getConditionDependsOnObject=function(n){return n.npcId?[{objectType:i.RelatedToObjectNpc,objectId:n.npcId}]:[]};i.CheckNpcAliveStateCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceNpc};i.CheckNpcAliveStateCondition.prototype.getObjectId=function(n){return n.npcId};i.CheckNpcAliveStateCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/KortistoApi/FlexFieldObject?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t};i.CheckNpcAliveStateCondition.prototype.createState=function(n){return{npcState:n,label:r[n]}};i.CheckNpcAliveStateCondition.prototype.buildConditionData=function(i,r){var e={selectedNpcId:new ko.observable,selectedNpcName:new ko.observable(t.Localization.Conditions.ChooseNpcLabel),selectedNpcState:new ko.observable,npcStates:[this.createState(u),this.createState(f)]};return e.chooseNpc=function(){n.DefaultNodeShapes.openNpcSearchDialog().then(function(n){e.selectedNpcId(n.id);e.selectedNpcName(n.name)})},i&&(e.selectedNpcId(i.npcId),e.selectedNpcState(i.state),i.npcId&&this.loadObjectShared(i).then(function(n){e.selectedNpcName(n.name)},function(){r.errorOccured(!0)})),e};i.CheckNpcAliveStateCondition.prototype.serializeConditionData=function(n){return{npcId:n.selectedNpcId(),state:n.selectedNpcState()}};i.CheckNpcAliveStateCondition.prototype.getConditionString=function(n){var i=new jQuery.Deferred,u;return n.npcId?(u=this,this.loadObjectShared(n).then(function(u){var f=t.Localization.Conditions.StateLabel+"("+u.name+") = "+r[n.state];i.resolve(f)},function(){i.reject()}),i.promise()):(i.resolve(t.Localization.Conditions.MissingInformations),i.promise())};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckNpcAliveStateCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var e=12,u=0,f=1,r={};r[u]=t.Localization.Conditions.GameTimeOperatorBefore;r[f]=t.Localization.Conditions.GameTimeOperatorAfter;i.CheckGameTimeCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this)};i.CheckGameTimeCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckGameTimeCondition.prototype.getTemplateName=function(){return"gn-nodeGameTimeCheck"};i.CheckGameTimeCondition.prototype.canBeSelected=function(){return!0};i.CheckGameTimeCondition.prototype.getType=function(){return e};i.CheckGameTimeCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckGameTimeLabel};i.CheckGameTimeCondition.prototype.getConditionDependsOnObject=function(){return[]};i.CheckGameTimeCondition.prototype.createTimeOperator=function(n){return{operator:n,label:r[n]}};i.CheckGameTimeCondition.prototype.buildConditionData=function(n){for(var i,r,t,o=[],e=0;e<24;++e)o.push(e);for(i=[],r=0;r<60;r+=5)i.push(r);return i.push(59),t={selectedGameTimeOperator:new ko.observable,selectedGameTimeHour:new ko.observable,selectedGameTimeMinutes:new ko.observable,gameTimeOperators:[this.createTimeOperator(u),this.createTimeOperator(f)],gameTimeHours:o,gameTimeMinutes:i},n&&(t.selectedGameTimeOperator(n.operator),t.selectedGameTimeHour(n.hour),t.selectedGameTimeMinutes(n.minutes)),t};i.CheckGameTimeCondition.prototype.serializeConditionData=function(n){return{operator:n.selectedGameTimeOperator(),hour:n.selectedGameTimeHour(),minutes:n.selectedGameTimeMinutes()}};i.CheckGameTimeCondition.prototype.getConditionString=function(n){var u=new jQuery.Deferred,i=t.Localization.Conditions.GameTime;return i+=" "+r[n.operator],i+=" "+this.formatTwoDigits(n.hour)+":"+this.formatTwoDigits(n.minutes),u.resolve(i),u.promise()};i.CheckGameTimeCondition.prototype.formatTwoDigits=function(n){if(!n)return"00";var t=n.toString();return t.length<2&&(t="0"+t),t};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckGameTimeCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=10;i.CheckQuestMarkerCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.CheckQuestMarkerCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckQuestMarkerCondition.prototype=jQuery.extend(i.CheckQuestMarkerCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckQuestMarkerCondition.prototype.getType=function(){return r};i.CheckQuestMarkerCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckQuestMarkerDistanceLabel};i.CheckQuestMarkerCondition.prototype.getTemplateName=function(){return"gn-nodeConditionQuestMarkerCheck"};i.CheckQuestMarkerCondition.prototype.canBeSelected=function(){return!0};i.CheckQuestMarkerCondition.prototype.buildOperatorObject=function(n,t){return{value:n,label:t}};i.CheckQuestMarkerCondition.prototype.buildConditionData=function(n){var i={availableMarkers:new ko.observableArray,selectedMarker:new ko.observable,availableOperators:[this.buildOperatorObject("<",t.Localization.Conditions.MarkerDistanceCloserThan),this.buildOperatorObject(">",t.Localization.Conditions.MarkerDistanceMoreFarThan)],operator:new ko.observable,distanceCompare:new ko.observable(0)};return n&&(i.distanceCompare(n.distanceCompare?n.distanceCompare:0),i.operator(n.operator)),this.loadObjectShared().then(function(t){if(i.availableMarkers(t),n)for(var r=0;r<t.length;++r)t[r].id==n.selectedMarkerId&&i.selectedMarker(t[r])}),i};i.CheckQuestMarkerCondition.prototype.serializeConditionData=function(n){var t=parseFloat(n.distanceCompare());return isNaN(t)&&(t=0),{selectedMarkerId:n.selectedMarker()?n.selectedMarker().id:null,operator:n.operator(),distanceCompare:t}};i.CheckQuestMarkerCondition.prototype.getConditionDependsOnObject=function(){return[{objectType:n.DefaultNodeShapes.Shapes.RelatedToObjectQuest,objectId:t.getCurrentQuestId()}]};i.CheckQuestMarkerCondition.prototype.getConditionString=function(i){var r=new jQuery.Deferred,u=this;return this.loadObjectShared().then(function(u){var e,f,o;if(!i.selectedMarkerId){r.resolve(n.DefaultNodeShapes.Localization.Conditions.MissingInformations);return}for(e=null,f=0;f<u.length;++f)u[f].id==i.selectedMarkerId&&(e=u[f].name+"("+u[f].mapName+")");if(e==null){r.reject(t.Localization.Conditions.MarkerWasDeleted);return}o=t.Localization.Conditions.MarkerDistance;o+=' ("'+e+'") '+i.operator+" ";o+=i.distanceCompare;r.resolve(o)},function(){r.reject()}),r.promise()};i.CheckQuestMarkerCondition.prototype.getObjectId=function(){return t.getCurrentQuestId()};i.CheckQuestMarkerCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceMapMarker};i.CheckQuestMarkerCondition.prototype.loadObject=function(){var n=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/KartaApi/GetAllQuestMarkers?questId="+t.getCurrentQuestId(),type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckQuestMarkerCondition)})(t.Conditions=t.Conditions||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.CheckChooseSkillValueCondition=function(){t.Conditions.CheckChooseObjectValueCondition.apply(this)};i.CheckChooseSkillValueCondition.prototype=jQuery.extend({},t.Conditions.CheckChooseObjectValueCondition.prototype);i.CheckChooseSkillValueCondition.prototype.getSkillPrefix=function(){return""};i.CheckChooseSkillValueCondition.prototype.getObjectTitle=function(n){return this.getSkillPrefix()+n.name};i.CheckChooseSkillValueCondition.prototype.openObjectSearchDialog=function(){return n.DefaultNodeShapes.openSkillSearchDialog()};i.CheckChooseSkillValueCondition.prototype.getChooseObjectLabel=function(){return t.Localization.Conditions.ChooseSkillLabel};i.CheckChooseSkillValueCondition.prototype.getObjectTypeName=function(){return i.RelatedToObjectSkill};i.CheckChooseSkillValueCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceSkill};i.CheckChooseSkillValueCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/EvneApi/FlexFieldObject?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise()}})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=13;i.CheckChoosePlayerSkillValueCondition=function(){t.Conditions.CheckChooseSkillValueCondition.apply(this)};i.CheckChoosePlayerSkillValueCondition.prototype=jQuery.extend({},t.Conditions.CheckChooseSkillValueCondition.prototype);i.CheckChoosePlayerSkillValueCondition.prototype.getSkillPrefix=function(){return t.Localization.Conditions.PlayerSkillPrefix};i.CheckChoosePlayerSkillValueCondition.prototype.getType=function(){return r};i.CheckChoosePlayerSkillValueCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckChoosePlayerSkillValueLabel};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckChoosePlayerSkillValueCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.CheckLearnedSkillCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.CheckLearnedSkillCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckLearnedSkillCondition.prototype=jQuery.extend(i.CheckLearnedSkillCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckLearnedSkillCondition.prototype.getTemplateName=function(){return"gn-nodeConditionChooseSkillCheck"};i.CheckLearnedSkillCondition.prototype.canBeSelected=function(){return!0};i.CheckLearnedSkillCondition.prototype.getDependsOnObjectId=function(n){return this.getObjectId(n)};i.CheckLearnedSkillCondition.prototype.getObjectId=function(n){return n.selectedSkillId};i.CheckLearnedSkillCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceSkill};i.CheckLearnedSkillCondition.prototype.buildConditionData=function(i,r){var u={selectedSkillId:new ko.observable(""),selectedSkillName:new ko.observable(t.Localization.Conditions.ChooseSkillLabel)},f;return i&&u.selectedSkillId(i.selectedSkillId),f=this,u.chooseSkill=function(){n.DefaultNodeShapes.openSkillSearchDialog().then(function(n){u.selectedSkillId(n.id);u.selectedSkillName(n.name)})},i&&i.selectedSkillId&&this.loadObjectShared(i).then(function(n){u.selectedSkillName(n.name)}).fail(function(){r.errorOccured(!0)}),u};i.CheckLearnedSkillCondition.prototype.serializeConditionData=function(n){return{selectedSkillId:n.selectedSkillId()}};i.CheckLearnedSkillCondition.prototype.getConditionDependsOnObject=function(n){return!n||!n.selectedSkillId?[]:[{objectType:i.RelatedToObjectSkill,objectId:n.selectedSkillId}]};i.CheckLearnedSkillCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/EvneApi/FlexFieldObject?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise()};i.CheckLearnedSkillCondition.prototype.getConditionStringPrefix=function(){return""};i.CheckLearnedSkillCondition.prototype.getConditionString=function(n){var i=new jQuery.Deferred,r;return!n||!n.selectedSkillId?(i.resolve(t.Localization.Conditions.MissingInformations),i.promise()):(r=this,this.loadObjectShared(n).then(function(n){var t=r.getConditionStringPrefix()+n.name;i.resolve(t)},function(){i.reject()}),i.promise())}})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=15;i.CheckPlayerLearnedSkillCondition=function(){t.Conditions.CheckLearnedSkillCondition.apply(this)};i.CheckPlayerLearnedSkillCondition.prototype=jQuery.extend({},t.Conditions.CheckLearnedSkillCondition.prototype);i.CheckPlayerLearnedSkillCondition.prototype.getType=function(){return r};i.CheckPlayerLearnedSkillCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckPlayerLearnedSkillLabel};i.CheckPlayerLearnedSkillCondition.prototype.getConditionStringPrefix=function(){return t.Localization.Conditions.CheckPlayerLearnedSkillPrefixLabel};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckPlayerLearnedSkillCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=16;i.CheckPlayerNotLearnedSkillCondition=function(){t.Conditions.CheckLearnedSkillCondition.apply(this)};i.CheckPlayerNotLearnedSkillCondition.prototype=jQuery.extend({},t.Conditions.CheckLearnedSkillCondition.prototype);i.CheckPlayerNotLearnedSkillCondition.prototype.getType=function(){return r};i.CheckPlayerNotLearnedSkillCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckPlayerNotLearnedSkillLabel};i.CheckPlayerNotLearnedSkillCondition.prototype.getConditionStringPrefix=function(){return t.Localization.Conditions.CheckPlayerNotLearnedSkillPrefixLabel};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckPlayerNotLearnedSkillCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){function c(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:r,icon:"glyphicon-question-sign",size:{width:u,height:f},inPorts:["input"],outPorts:[],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"},".outPorts circle":{magnet:"true"}},conditions:[],currentConditionId:0},joint.shapes.default.Base.prototype.defaults)})}function l(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<span class="gn-nodeLoading" style="display: none"><i class="glyphicon glyphicon-refresh spinning"><\/i><\/span>','<span class="gn-nodeError text-danger" style="display: none" title="'+n.DefaultNodeShapes.Localization.ErrorOccured+'"><i class="glyphicon glyphicon-warning-sign"><\/i><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<button class="gn-nodeAddCondition gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.Conditions.AddCondition+'">+<\/button>',"<\/div>",].join(""),additionalCallbackButtons:{"gn-nodeAddCondition":function(){this.addCondition()}},initialize:function(){_.bindAll(this,"addCondition");joint.shapes.default.BaseView.prototype.initialize.apply(this,arguments);this.model.on("change:conditions",this.syncConditions,this);this.model.get("conditions").length==0?this.addCondition():this.syncConditions()},addCondition:function(n){var t=n,i;t||(t={id:this.model.get("currentConditionId"),conditionElements:[]},this.model.set("currentConditionId",this.model.get("currentConditionId")+1));i=(this.model.get("conditions")||{}).slice();i.push(t);this.model.set("conditions",i)},moveCondition:function(n,t){for(var u,f,i=(this.model.get("conditions")||{}).slice(),r=0;r<i.length;++r)if(i[r].id==n){u=r+t;u>=0&&u<i.length&&(f=i[r],i[r]=i[u],i[u]=f,this.model.set("conditions",i));return}},deleteCondition:function(n){for(var t=(this.model.get("conditions")||{}).slice(),i=0;i<t.length;++i)if(t[i].id==n){t.splice(i,1);this.model.set("conditions",t);return}},openConditionDialog:function(n){for(var u,r=(this.model.get("conditions")||{}).slice(),i=0;i<r.length;++i)if(r[i].id==n){u=this;t.openConditionDialog(r[i]).then(function(){u.syncConditions()});return}},syncConditions:function(){for(var s,i,n,o=[],c=this.model.get("conditions"),r=0;r<c.length;++r)o.push("condition"+c[r].id);for(o.push("else"),this.model.set("outPorts",o),s=[],i=this,this.model.set("size",{width:u,height:f+o.length*e}),n="<table class='gn-nodeConditionTable'>",jQuery.each(c,function(r,u){var f=i.buildConditionString(u,s);f=jQuery("<div><\/div>").text(f).html();n+="<tr>";n+="<td class='gn-nodeConditionTableConditionCell'><a class='gn-clickable gn-nodeNonClickableOnReadonly' data-conditionid='"+u.id+"'>"+f+"<\/a><\/td>";n+="<td class='gn-nodeDeleteOnReadonly'><i class='glyphicon glyphicon-arrow-up gn-nodeMoveConditionUp gn-nodeConditionIcon' data-conditionid='"+u.id+"' title='"+t.Localization.Conditions.MoveConditionUp+"'><\/i><\/td>";n+="<td class='gn-nodeDeleteOnReadonly'><i class='glyphicon glyphicon-arrow-down gn-nodeMoveConditionDown gn-nodeConditionIcon' data-conditionid='"+u.id+"' title='"+t.Localization.Conditions.MoveConditionDown+"'><\/i><\/td>";n+="<td class='gn-nodeDeleteOnReadonly'><i class='glyphicon glyphicon-trash gn-nodeDeleteCondition gn-nodeConditionIcon' data-conditionid='"+u.id+"' title='"+t.Localization.Conditions.DeleteCondition+"'><\/i><\/td>";n+="<\/tr>"}),n+="<tr>",n+="<td class='gn-nodeConditionTableConditionCell'>"+t.Localization.Conditions.Else+"<\/td>",n+="<\/tr>",n+="<\/table>",this.$box.find(".gn-nodeConditionTable").length>0?this.$box.find(".gn-nodeConditionTable").replaceWith(n):this.$box.append(n),this.hideError(),s.length>0&&(this.showLoading(),jQuery.when.apply(jQuery,s).then(function(){i.hideLoading()},function(){i.hideLoading();i.showError()})),r=0;r<o.length;++r)this.model.attr(".outPorts>.port"+r,{"ref-y":h+e*r+"px",ref:".body"});this.$box.find(".gn-nodeMoveConditionUp").on("click",function(){i.moveCondition(jQuery(this).data("conditionid"),-1)});this.$box.find(".gn-nodeMoveConditionDown").on("click",function(){i.moveCondition(jQuery(this).data("conditionid"),1)});this.$box.find(".gn-nodeDeleteCondition").on("click",function(){i.deleteCondition(jQuery(this).data("conditionid"))});this.$box.find(".gn-nodeConditionTableConditionCell a").on("click",function(){i.openConditionDialog(jQuery(this).data("conditionid"))})},buildConditionString:function(i,r){var u="",e=this,f,o;return i.conditionElements&&i.conditionElements.length>0?(u=t.Localization.Conditions.LoadingConditionText,f=".gn-nodeConditionTableConditionCell>a[data-conditionid='"+i.id+"']",o=n.DefaultNodeShapes.Conditions.getConditionManager().getConditionString(i.conditionElements,n.DefaultNodeShapes.Localization.Conditions.AndOperatorShort,!1),o.then(function(n){n?e.$box.find(f).attr("title",n):n=t.Localization.Conditions.EditCondition;e.$box.find(f).text(n);u=n},function(n){var i=t.Localization.Conditions.ErrorLoadingConditionText;n&&(i+=": "+n);e.$box.find(f).text(i);e.$box.find(f).attr("title",i);u=i}),r.push(o)):u=t.Localization.Conditions.EditCondition,u},reloadSharedLoadedData:function(t,i){for(var s,u,f,e=this.model.get("conditions"),o=[],r=0;r<e.length;++r)for(s=n.DefaultNodeShapes.Conditions.getConditionManager().getConditionElementsDependsOnObject(e[r].conditionElements),u=0;u<s.length;++u)s[u].objectId==i&&this.buildConditionString(e[r],o);this.hideError();o.length>0&&(this.showLoading(),f=this,jQuery.when.apply(jQuery,o).then(function(){f.hideLoading()},function(){f.hideLoading();f.showError()}))},showLoading:function(){this.$box.find(".gn-nodeLoading").show()},hideLoading:function(){this.$box.find(".gn-nodeLoading").hide()},showError:function(){this.$box.find(".gn-nodeError").show()},hideError:function(){this.$box.find(".gn-nodeError").hide()}})}var o;t.openConditionDialog||(t.openConditionDialog=function(){var n=new jQuery.Deferred;return n.reject("Not implemented"),n.promise()});var r="default.Condition",s="condition",u=350,f=50,e=66,h=76;joint.shapes.default=joint.shapes.default||{};joint.shapes.default.Condition=c();joint.shapes.default.ConditionView=l();i.ConditionSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.default.Condition,r,s])};i.ConditionSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);i.ConditionSerializer.prototype.serialize=function(t){for(var u,r=[],i=0;i<t.conditions.length;++i)u=n.DefaultNodeShapes.Conditions.getConditionManager().serializeCondition(t.conditions[i]),r.push(u);return{id:t.id,x:t.position.x,y:t.position.y,conditions:r,currentConditionId:t.currentConditionId}};i.ConditionSerializer.prototype.deserialize=function(t){for(var u,f,t,r=[],i=0;i<t.conditions.length;++i)u=n.DefaultNodeShapes.Conditions.getConditionManager().deserializeCondition(t.conditions[i]),r.push(u);return f={id:t.id,position:{x:t.x,y:t.y},conditions:r,currentConditionId:t.currentConditionId},t=new this.classType(f),t};o=new i.ConditionSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(o)})(t.Shapes=t.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.ConditionDialog=function(){this.isOpen=new ko.observable(!1);this.condition=null;this.closingDeferred=null;this.conditionElements=new ko.observableArray;this.showGroupWarning=new ko.observable(!1);this.showDragParentToChildWarning=new ko.observable(!1);this.warningHideTimeout=null;this.selectableConditionTypes=n.getConditionManager().getSelectableConditionTypes()};n.ConditionDialog.prototype={openDialog:function(t,i){this.condition=t;this.closingDeferred=i;this.conditionElements(n.getConditionManager().convertElements(t.conditionElements));this.conditionElements().length==0&&this.addNewConditionElement();this.isOpen(!0)},addNewConditionElement:function(){var t=n.getConditionManager().createEmptyElement();this.conditionElements.push(t)},andGroupElements:function(){this.groupElements(n.GroupConditionOperatorAnd)},orGroupElements:function(){this.groupElements(n.GroupConditionOperatorOr)},groupElements:function(t){var i,o,f,u,e,r;if(this.showGroupWarning(!1),i=[],this.collectSelectedElements(i,this.conditionElements()),!(i.length<2)){for(r=1;r<i.length;++r)if(i[0].parent!=i[r].parent){this.displayWarning(this.showGroupWarning);return}for(o={conditionType:n.GroupConditionType,conditionData:{fromDialog:!0,operator:t,conditionElements:i}},f=n.getConditionManager().convertElement(o),f.parent=i[0].parent,u=this.conditionElements,i[0].parent&&(u=i[0].parent.conditionData().conditionElements),e=u.indexOf(i[0]),u.removeAll(i),e<u().length?u.splice(e,0,f):u.push(f),r=0;r<i.length;++r)i[r].parent=f,i[r].isSelected(!1)}},collectSelectedElements:function(n,t){for(var i=0;i<t.length;++i)t[i].isSelected()&&n.push(t[i]),t[i].conditionData().conditionElements&&this.collectSelectedElements(n,t[i].conditionData().conditionElements())},moveConditionElementUp:function(n){this.moveSingleConditionElement(n,-1)},moveConditionElementDown:function(n){this.moveSingleConditionElement(n,1)},moveSingleConditionElement:function(n,t){var r=null,e;r=n.parent?n.parent.conditionData().conditionElements:this.conditionElements;var f=r.indexOf(n),u=f+t,i=r();u>=0&&u<i.length&&(e=i[f],i[f]=i[u],i[u]=e,r.valueHasMutated())},dropConditionToGroup:function(n,t){if(t.parent!=n){for(var i=n?n.parent:null;i!=null;){if(i==t){this.displayWarning(this.showDragParentToChildWarning);return}i=i.parent}t.parent?(t.parent.conditionData().conditionElements.remove(t),t.parent.conditionData().conditionElements().length<2&&this.deleteConditionElement(t.parent)):this.conditionElements.remove(t);n?n.conditionData().conditionElements.push(t):this.conditionElements.push(t);t.parent=n}},displayWarning:function(n){this.warningHideTimeout&&(clearTimeout(this.warningHideTimeout),this.showGroupWarning(!1),this.showDragParentToChildWarning(!1));n(!0);this.warningHideTimeout=setTimeout(function(){n(!1)},5e3)},deleteConditionElement:function(n){if(n.conditionData().conditionElements){var t=n.conditionData().conditionElements();n.parent&&n.parent.conditionData().conditionElements?this.moveConditionElements(t,n.parent.conditionData().conditionElements,n.parent,n):this.moveConditionElements(t,this.conditionElements,null,n)}n.parent&&n.parent.conditionData().conditionElements?(n.parent.conditionData().conditionElements.remove(n),n.parent.conditionData().conditionElements().length<2&&this.deleteConditionElement(n.parent)):this.conditionElements.remove(n)},moveConditionElements:function(n,t,i,r){for(var f=t.indexOf(r),u=0;u<n.length;++u)n[u].parent=i,f<t().length?t.splice(f+u,0,n[u]):t.push(n[u])},getConditionTemplate:function(t){return t?n.getConditionManager().getConditionTemplate(t.conditionType()):"gn-nodeConditionEmpty"},isConditionTypeSelectable:function(t){return t?n.getConditionManager().isConditionTypeSelectable(t.conditionType()):!0},saveCondition:function(){for(var i=[],r=this.conditionElements(),t=0;t<r.length;++t)i.push(n.getConditionManager().serializeConditionElement(r[t]));this.condition.conditionElements=i;this.closingDeferred&&this.closingDeferred.resolve();this.closeDialog()},closeDialog:function(){this.condition=null;this.closingDeferred=null;this.isOpen(!1)}}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){function e(n){var t=new jQuery.Deferred;return jQuery.ajax("/api/TaleApi/GetNodeConfigByKey?configKey="+encodeURIComponent(n)).done(function(i){var u,f,r;if(!i){t.resolve();return}try{for(u=JSON.parse(i),f=jQuery("<datalist id='gn-"+n+"'><\/datalist>"),r=0;r<u.length;++r)f.append(jQuery("<option><\/option>").text(u[r]));jQuery("body").append(f);t.resolve()}catch(e){self.errorOccured(!0);t.reject()}}).fail(function(){t.reject()}),t.promise()}function o(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:r,icon:"glyphicon-cog",size:{width:250,height:200},inPorts:["input"],outPorts:["output"],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"},".outPorts circle":{magnet:"true"}},actionType:null,actionRelatedToObjectType:null,actionRelatedToObjectId:null,actionData:null},joint.shapes.default.Base.prototype.defaults)})}function s(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<span class="gn-nodeLoading" style="display: none"><i class="glyphicon glyphicon-refresh spinning"><\/i><\/span>','<span class="gn-nodeError text-danger" style="display: none" title="'+n.DefaultNodeShapes.Localization.ErrorOccured+'"><i class="glyphicon glyphicon-warning-sign"><\/i><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<select class="gn-actionNodeSelectActionType"><\/select>','<div class="gn-actionNodeActionContent"><\/div>',"<\/div>",].join(""),initialize:function(){var t,r;joint.shapes.default.BaseView.prototype.initialize.apply(this,arguments);t=this.$box.find(".gn-actionNodeSelectActionType");n.Util.fillSelectFromArray(t,i,function(n){return n.getType()},function(n){return n.getLabel()});r=this;t.on("change",function(){r.resetActionData();r.syncActionData()});t.find("option[value='"+this.model.get("actionType")+"']").prop("selected",!0);this.syncActionData()},getCurrentAction:function(){for(var t=this.$box.find(".gn-actionNodeSelectActionType").val(),n=0;n<i.length;++n)if(i[n].getType()==t)return i[n];return null},resetActionData:function(){this.model.set("actionRelatedToObjectType",null);this.model.set("actionRelatedToObjectId",null);this.model.set("actionData",null)},syncActionData:function(){var i=this.getCurrentAction(),n,t;if(i){n=i.buildAction();n.setNodeModel(this.model);this.model.set("actionType",n.getType());t=this.$box.find(".gn-actionNodeActionContent");t.html(n.getContent());n.onInitialized(t,this)}},reloadSharedLoadedData:function(n,t){this.model.get("actionRelatedToObjectId")==t&&this.syncActionData()},showLoading:function(){this.$box.find(".gn-nodeLoading").show()},hideLoading:function(){this.$box.find(".gn-nodeLoading").hide()},showError:function(){this.$box.find(".gn-nodeError").show()},hideError:function(){this.$box.find(".gn-nodeError").hide()}})}var r="default.Action",f="action",i=[],u;t.addAvailableAction=function(n){i.push(n)};t.loadConfigLists=function(){for(var n,r={},u=[],t=0;t<i.length;++t)n=i[t].getConfigKey(),n&&!r[n]&&(r[n]=!0,u.push(e(n)));return jQuery.when.apply(jQuery,u)};joint.shapes.default=joint.shapes.default||{};joint.shapes.default.Action=o();joint.shapes.default.ActionView=s();t.ActionSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.default.Action,r,f])};t.ActionSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);t.ActionSerializer.prototype.serialize=function(n){return{id:n.id,x:n.position.x,y:n.position.y,actionType:n.actionType,actionRelatedToObjectType:n.actionRelatedToObjectType,actionRelatedToObjectId:n.actionRelatedToObjectId,actionData:n.actionData}};t.ActionSerializer.prototype.deserialize=function(n){var t={id:n.id,position:{x:n.x,y:n.y},actionType:n.actionType,actionRelatedToObjectType:n.actionRelatedToObjectType,actionRelatedToObjectId:n.actionRelatedToObjectId,actionData:n.actionData},n=new this.classType(t);return n};u=new t.ActionSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(u)})(t.Shapes=t.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.RelatedToObjectNpc="Npc";n.RelatedToObjectQuest="Quest";n.RelatedToObjectSkill="Skill";n.RelatedToObjectItem="Item";n.BaseAction=function(){this.nodeModel=null};n.BaseAction.prototype={buildAction:function(){},setNodeModel:function(n){this.nodeModel=n},getType:function(){return-1},getLabel:function(){},getContent:function(){},getConfigKey:function(){return null},onInitialized:function(){},serialize:function(){},deserialize:function(){}}})(n.Actions=n.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.ChangeValueAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this);this.contentElement=null;this.filteredFields=[];this.isNumberValueSelected=!1};i.ChangeValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.ChangeValueAction.prototype=jQuery.extend(i.ChangeValueAction.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.ChangeValueAction.prototype.getObjectTypeName=function(){};i.ChangeValueAction.prototype.getContent=function(){return"<select class='gn-actionNodeAttributeSelect'><\/select><select class='gn-actionNodeAttributeOperator'><\/select><input type='text' class='gn-actionNodeAttributeChange'/>"};i.ChangeValueAction.prototype.isUsingIndividualObjectId=function(){return!1};i.ChangeValueAction.prototype.getObjectId=function(){return null};i.ChangeValueAction.prototype.canLoadObject=function(){return!0};i.ChangeValueAction.prototype.onInitializeAdditional=function(){};i.ChangeValueAction.prototype.onInitialized=function(t,i){var r,u;this.contentElement=t;this.deserializePreLoadData();this.canLoadObject()&&this.loadFields(t,i);r=this;t.find(".gn-actionNodeAttributeSelect").on("change",function(){r.syncOperators();r.saveData()});t.find(".gn-actionNodeAttributeOperator").on("change",function(){r.saveData()});u=t.find(".gn-actionNodeAttributeChange");u.keydown(function(t){r.isNumberValueSelected&&n.Util.validateNumberKeyPress(u,t)});u.change(function(){r.isNumberValueSelected&&r.ensureNumberValue();r.saveData()});this.onInitializeAdditional(t,i)};i.ChangeValueAction.prototype.parseAdditionalData=function(){};i.ChangeValueAction.prototype.loadFields=function(i,r){r.showLoading();r.hideError();var u=this;this.loadObjectShared().then(function(f){var e,o;if(!f){r.hideLoading();return}u.nodeModel.set("actionRelatedToObjectType",u.getObjectTypeName());u.nodeModel.set("actionRelatedToObjectId",f.id);e=i.find(".gn-actionNodeAttributeSelect");u.filteredFields=n.Util.getFilteredFieldsForScript(f.fields);n.Util.fillSelectFromArray(e,u.filteredFields,function(n,t){return t},function(i){var r=i.name+" (";return r+=i.fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber?t.Localization.Actions.NumberField:t.Localization.Actions.TextField,r+")"});u.parseAdditionalData(i,r,f);o=u.deserializeData();o||(u.syncOperators(),u.saveData());r.hideLoading()},function(){r.hideLoading();r.showError()})};i.ChangeValueAction.prototype.syncOperators=function(){var u=this.contentElement.find(".gn-actionNodeAttributeSelect").val(),i=this.contentElement.find(".gn-actionNodeAttributeOperator"),r=this.filteredFields[u],t;if(!r){n.Util.fillSelectFromArray(i,[],function(n){return n},function(n){return n});return}t=[];r.fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber?(t=["=","+=","-=","*=","/="],this.isNumberValueSelected=!0,this.ensureNumberValue()):(t=["="],this.isNumberValueSelected=!1);n.Util.fillSelectFromArray(i,t,function(n){return n},function(n){return n})};i.ChangeValueAction.prototype.ensureNumberValue=function(){var n=parseFloat(this.contentElement.find(".gn-actionNodeAttributeChange").val());isNaN(n)&&this.contentElement.find(".gn-actionNodeAttributeChange").val("0")};i.ChangeValueAction.prototype.deserializePreLoadData=function(){};i.ChangeValueAction.prototype.deserializeData=function(){var r=this.nodeModel.get("actionData"),t,i,n;if(!r)return!1;for(t=JSON.parse(r),i=0,n=0;n<this.filteredFields.length;++n)if(this.filteredFields[n].id==t.fieldId&&(i=n,this.filteredFields[n].name==t.fieldName))break;return this.contentElement.find(".gn-actionNodeAttributeSelect").find("option[value='"+i+"']").prop("selected",!0),this.syncOperators(),this.contentElement.find(".gn-actionNodeAttributeOperator").find("option[value='"+t.operator+"']").prop("selected",!0),this.contentElement.find(".gn-actionNodeAttributeChange").val(t.valueChange),!0};i.ChangeValueAction.prototype.serializeAdditionalData=function(){};i.ChangeValueAction.prototype.saveData=function(){var i=this.contentElement.find(".gn-actionNodeAttributeSelect").val(),n=this.filteredFields[i],r=this.contentElement.find(".gn-actionNodeAttributeOperator").val(),u=this.contentElement.find(".gn-actionNodeAttributeChange").val(),t={fieldId:n?n.id:null,fieldName:n?n.name:null,operator:r,valueChange:u};this.serializeAdditionalData(t);this.nodeModel.set("actionData",JSON.stringify(t))}})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ChangeValueChooseObjectAction=function(){n.DefaultNodeShapes.Actions.ChangeValueAction.apply(this)};t.ChangeValueChooseObjectAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeValueAction.prototype);t.ChangeValueChooseObjectAction.prototype.getContent=function(){return"<div class='gn-actionNodeObjectSelectContainer'><a class='gn-actionNodeObjectSelect gn-clickable'>"+this.getChooseLabel()+"<\/a><\/div><select class='gn-actionNodeAttributeSelect'><\/select><select class='gn-actionNodeAttributeOperator'><\/select><input type='text' class='gn-actionNodeAttributeChange'/>"};t.ChangeValueChooseObjectAction.prototype.getChooseLabel=function(){return"NOT IMPLEMENTED"};t.ChangeValueChooseObjectAction.prototype.isUsingIndividualObjectId=function(){return!0};t.ChangeValueChooseObjectAction.prototype.getObjectId=function(){return this.nodeModel.get("objectId")};t.ChangeValueChooseObjectAction.prototype.canLoadObject=function(){return!!this.nodeModel.get("objectId")};t.ChangeValueChooseObjectAction.prototype.openSearchDialog=function(){};t.ChangeValueChooseObjectAction.prototype.parseAdditionalData=function(n,t,i){n.find(".gn-actionNodeObjectSelect").text(i.name)};t.ChangeValueChooseObjectAction.prototype.onInitializeAdditional=function(n,t){var i=this;n.find(".gn-actionNodeObjectSelect").on("click",function(){i.openSearchDialog().then(function(r){i.nodeModel.set("objectId",r.id);i.loadFields(n,t);n.find(".gn-actionNodeObjectSelect").text(r.name)})})};t.ChangeValueChooseObjectAction.prototype.serializeAdditionalData=function(n){n.objectId=this.nodeModel.get("objectId")?this.nodeModel.get("objectId"):null};t.ChangeValueChooseObjectAction.prototype.deserializePreLoadData=function(){var n=this.nodeModel.get("actionData"),t;n&&(t=JSON.parse(n),this.nodeModel.set("objectId",t.objectId))}})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=7;i.ChangeCurrentQuestValueAction=function(){n.DefaultNodeShapes.Actions.ChangeValueAction.apply(this)};i.ChangeCurrentQuestValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeValueAction.prototype);i.ChangeCurrentQuestValueAction.prototype.buildAction=function(){return new i.ChangeCurrentQuestValueAction};i.ChangeCurrentQuestValueAction.prototype.getType=function(){return r};i.ChangeCurrentQuestValueAction.prototype.getLabel=function(){return t.Localization.Actions.ChangeCurrentQuestValueLabel};i.ChangeCurrentQuestValueAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectQuest};i.ChangeCurrentQuestValueAction.prototype.getObjectId=function(){return t.getCurrentQuestId()};i.ChangeCurrentQuestValueAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.ChangeCurrentQuestValueAction.prototype.loadObject=function(){var n=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+t.getCurrentQuestId(),type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.ChangeCurrentQuestValueAction)})(t.Actions=t.Actions||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=8;i.ChangeQuestValueAction=function(){n.DefaultNodeShapes.Actions.ChangeValueChooseObjectAction.apply(this)};i.ChangeQuestValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeValueChooseObjectAction.prototype);i.ChangeQuestValueAction.prototype.buildAction=function(){return new i.ChangeQuestValueAction};i.ChangeQuestValueAction.prototype.getType=function(){return r};i.ChangeQuestValueAction.prototype.getLabel=function(){return t.Localization.Actions.ChangeQuestValueLabel};i.ChangeQuestValueAction.prototype.getChooseLabel=function(){return t.Localization.Actions.ChooseQuestLabel};i.ChangeQuestValueAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectQuest};i.ChangeQuestValueAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.ChangeQuestValueAction.prototype.openSearchDialog=function(){return n.DefaultNodeShapes.openQuestSearchDialog()};i.ChangeQuestValueAction.prototype.loadObject=function(){var n=new jQuery.Deferred,t=this;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+this.nodeModel.get("objectId"),type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.ChangeQuestValueAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.actionTypeChangeQuestState=9;i.SetQuestStateAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.SetQuestStateAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.SetQuestStateAction.prototype=jQuery.extend(i.SetQuestStateAction.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.SetQuestStateAction.prototype.getContent=function(){return"<div class='gn-actionNodeObjectSelectContainer'><a class='gn-clickable gn-nodeActionSelectQuest gn-nodeNonClickableOnReadonly'><\/a>&nbsp;<a class='gn-clickable gn-nodeActionOpenQuest' title='"+t.Localization.Actions.OpenQuestTooltip+"' style='display: none'><i class='glyphicon glyphicon-eye-open'><\/i><\/a><\/div><div class='gn-nodeActionText'>"+t.Localization.Actions.QuestState+"<\/div><select class='gn-nodeActionQuestState'><\/select>"};i.SetQuestStateAction.prototype.onInitialized=function(i,r){var f,e,o,u,s;this.contentElement=i;this.contentElement.find(".gn-nodeActionSelectQuest").html(t.Localization.Actions.ChooseQuestLabel);n.Util.fillSelectFromArray(this.contentElement.find(".gn-nodeActionQuestState"),t.Shapes.getQuestStates(),function(n){return n.questState},function(n){return n.label});f=i.find(".gn-nodeActionOpenQuest");e=this.deserializeData();e&&(f.show(),r.showLoading(),r.hideError(),this.loadObjectShared(e).then(function(n){i.find(".gn-nodeActionSelectQuest").text(n.name);r.hideLoading()}).fail(function(){r.hideLoading();r.showError()}));o=this;u=i.find(".gn-nodeActionSelectQuest");i.find(".gn-nodeActionSelectQuest").on("click",function(){t.openQuestSearchDialog().then(function(n){u.data("questid",n.id);u.text(n.name);o.saveData();f.show()})});s=i.find(".gn-nodeActionQuestState");s.change(function(){o.saveData()});f.on("click",function(){u.data("questid")&&window.open("/Aika/Quest?id="+u.data("questid"))})};i.SetQuestStateAction.prototype.deserializeData=function(){var i=this.nodeModel.get("actionData"),n,t;return i?(n=JSON.parse(i),t="",n.questId?(this.contentElement.find(".gn-nodeActionSelectQuest").data("questid",n.questId),t=n.questId):this.contentElement.find(".gn-nodeActionSelectQuest").data("questid",""),this.contentElement.find(".gn-nodeActionQuestState").find("option[value='"+n.questState+"']").prop("selected",!0),t):""};i.SetQuestStateAction.prototype.saveData=function(){var n=this.getObjectId(),t=this.contentElement.find(".gn-nodeActionQuestState").val(),i={questId:n,questState:t};this.nodeModel.set("actionData",JSON.stringify(i));this.nodeModel.set("actionRelatedToObjectType",this.getObjectTypeName());this.nodeModel.set("actionRelatedToObjectId",n)};i.SetQuestStateAction.prototype.buildAction=function(){return new i.SetQuestStateAction};i.SetQuestStateAction.prototype.getType=function(){return i.actionTypeChangeQuestState};i.SetQuestStateAction.prototype.getLabel=function(){return t.Localization.Actions.SetQuestStateLabel};i.SetQuestStateAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectQuest};i.SetQuestStateAction.prototype.getObjectId=function(){return this.contentElement.find(".gn-nodeActionSelectQuest").data("questid")};i.SetQuestStateAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.SetQuestStateAction.prototype.loadObject=function(n){var t=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise()};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.SetQuestStateAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.actionTypeAddQuestToText=10;i.AddQuestTextAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.AddQuestTextAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.AddQuestTextAction.prototype=jQuery.extend(i.AddQuestTextAction.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.AddQuestTextAction.prototype.getContent=function(){return"<div class='gn-actionNodeObjectSelectContainer'><a class='gn-clickable gn-nodeActionSelectQuest gn-nodeNonClickableOnReadonly'><\/a>&nbsp;<a class='gn-clickable gn-nodeActionOpenQuest' title='"+t.Localization.Actions.OpenQuestTooltip+"' style='display: none'><i class='glyphicon glyphicon-eye-open'><\/i><\/a><\/div><div class='gn-nodeActionText'>"+t.Localization.Actions.QuestText+"<\/div><textarea class='gn-nodeActionQuestText'><\/textarea>"};i.AddQuestTextAction.prototype.onInitialized=function(n,i){var u,f,e,r,o;this.contentElement=n;this.contentElement.find(".gn-nodeActionSelectQuest").html(t.Localization.Actions.ChooseQuestLabel);u=n.find(".gn-nodeActionOpenQuest");f=this.deserializeData();f&&(u.show(),i.showLoading(),i.hideError(),this.loadObjectShared(f).then(function(t){n.find(".gn-nodeActionSelectQuest").text(t.name);i.hideLoading()}).fail(function(){i.hideLoading();i.showError()}));e=this;r=n.find(".gn-nodeActionSelectQuest");n.find(".gn-nodeActionSelectQuest").on("click",function(){t.openQuestSearchDialog().then(function(n){r.data("questid",n.id);r.text(n.name);e.saveData();u.show()})});o=n.find(".gn-nodeActionQuestText");o.change(function(){e.saveData()});u.on("click",function(){r.data("questid")&&window.open("/Aika/Quest?id="+r.data("questid"))})};i.AddQuestTextAction.prototype.deserializeData=function(){var i=this.nodeModel.get("actionData"),n,t;return i?(n=JSON.parse(i),t="",n.questId?(this.contentElement.find(".gn-nodeActionSelectQuest").data("questid",n.questId),t=n.questId):this.contentElement.find(".gn-nodeActionSelectQuest").data("questid",""),this.contentElement.find(".gn-nodeActionQuestText").val(n.questText),t):""};i.AddQuestTextAction.prototype.saveData=function(){var n=this.getObjectId(),t=this.contentElement.find(".gn-nodeActionQuestText").val(),i={questId:n,questText:t};this.nodeModel.set("actionData",JSON.stringify(i))};i.AddQuestTextAction.prototype.buildAction=function(){return new i.AddQuestTextAction};i.AddQuestTextAction.prototype.getType=function(){return i.actionTypeAddQuestToText};i.AddQuestTextAction.prototype.getLabel=function(){return t.Localization.Actions.AddQuestTextLabel};i.AddQuestTextAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectQuest};i.AddQuestTextAction.prototype.getObjectId=function(){return this.contentElement.find(".gn-nodeActionSelectQuest").data("questid")};i.AddQuestTextAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.AddQuestTextAction.prototype.loadObject=function(n){var t=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise()};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.AddQuestTextAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.ChangeQuestInNpcDialogBaseAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.ChangeQuestInNpcDialogBaseAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.ChangeQuestInNpcDialogBaseAction.prototype=jQuery.extend(i.ChangeQuestInNpcDialogBaseAction.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.ChangeQuestInNpcDialogBaseAction.prototype.getContent=function(){return"<div class='gn-actionNodeObjectSelectContainer'><a class='gn-clickable gn-nodeActionSelectNpc gn-nodeNonClickableOnReadonly'><\/a>&nbsp;<a class='gn-clickable gn-nodeActionOpenDialog' title='"+t.Localization.Actions.OpenDialogTooltip+"' style='display: none'><i class='glyphicon glyphicon-eye-open'><\/i><\/a><\/div>"+this.getAdditionalContent()+"<div class='gn-aikaActionChangeQuestDialogValidationResult text-danger' style='display: none'>"+this.getValidationFailedText()+"<\/div><div class='gn-aikaActionChangeQuestDialogMissingPermissions text-danger' style='display: none'>"+t.Localization.Actions.NpcDialogCheckMissingPermissions+"<\/div>"};i.ChangeQuestInNpcDialogBaseAction.prototype.getAdditionalContent=function(){return""};i.ChangeQuestInNpcDialogBaseAction.prototype.onInitialized=function(i,r){var e,o,s,h,u,f;this.contentElement=i;this.contentElement.find(".gn-nodeActionSelectNpc").text(t.Localization.Actions.ChooseNpcLabel);e=i.find(".gn-nodeActionOpenDialog");this.initializeAdditional(i,r);o=this.deserializeData();o&&(e.show(),r.showLoading(),r.hideError(),s=this.loadNpcName(o),s.then(function(n){i.find(".gn-nodeActionSelectNpc").text(n)}),h=this.validateDialogNodeExists(),jQuery.when(s,h).then(function(){r.hideLoading()},function(){r.hideLoading();r.showError()}));u=this;f=i.find(".gn-nodeActionSelectNpc");i.find(".gn-nodeActionSelectNpc").on("click",function(){n.DefaultNodeShapes.openNpcSearchDialog().then(function(n){f.data("npcid",n.id);f.text(n.name);u.saveData();e.show();u.validateDialogNodeExistsWithLoadingIndicator(r)})});i.find(".gn-nodeActionOpenDialog").on("click",function(){if(f.data("npcid")){var n=window.open("/Tale?npcId="+f.data("npcid"));n.taleDialogSaved=function(){u.clearLoadedSharedObject();u.validateDialogNodeExistsWithLoadingIndicator(r)}}})};i.ChangeQuestInNpcDialogBaseAction.prototype.initializeAdditional=function(){};i.ChangeQuestInNpcDialogBaseAction.prototype.getValidationFailedText=function(){return""};i.ChangeQuestInNpcDialogBaseAction.prototype.validateDialogNodeExistsWithLoadingIndicator=function(n){n.showLoading();n.hideError();this.validateDialogNodeExists().then(function(){n.hideLoading()},function(){n.hideLoading();n.showError()})};i.ChangeQuestInNpcDialogBaseAction.prototype.validateDialogNodeExists=function(){var t=this.loadObjectShared(),n=this;return t.done(function(t){var r,i;for(t&&t.action||n.contentElement.find(".gn-aikaActionChangeQuestDialogValidationResult").show(),r=!1,i=0;i<t.action.length;++i)if(n.isActionNodeValid(t.action[i])){r=!0;break}r?n.contentElement.find(".gn-aikaActionChangeQuestDialogValidationResult").hide():n.contentElement.find(".gn-aikaActionChangeQuestDialogValidationResult").show()}),t};i.ChangeQuestInNpcDialogBaseAction.prototype.isActionNodeValid=function(){return!1};i.ChangeQuestInNpcDialogBaseAction.prototype.deserializeData=function(){var i=this.nodeModel.get("actionData"),n,t;return i?(n=JSON.parse(i),t="",n.npcId?(this.contentElement.find(".gn-nodeActionSelectNpc").data("npcid",n.npcId),t=n.npcId):this.contentElement.find(".gn-nodeActionSelectNpc").data("npcid",""),this.deserializeAdditionalData(n),t):""};i.ChangeQuestInNpcDialogBaseAction.prototype.deserializeAdditionalData=function(){};i.ChangeQuestInNpcDialogBaseAction.prototype.saveData=function(){var t=this.getObjectId(),n={npcId:t};this.saveAdditionalData(n);this.nodeModel.set("actionData",JSON.stringify(n))};i.ChangeQuestInNpcDialogBaseAction.prototype.saveAdditionalData=function(){};i.ChangeQuestInNpcDialogBaseAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectNpc};i.ChangeQuestInNpcDialogBaseAction.prototype.getObjectId=function(){return this.contentElement.find(".gn-nodeActionSelectNpc").data("npcid")};i.ChangeQuestInNpcDialogBaseAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceDialogs};i.ChangeQuestInNpcDialogBaseAction.prototype.loadObject=function(t){var i=new jQuery.Deferred,r;if(!n.Aika.Quest.hasTaleRights){this.contentElement.find(".gn-aikaActionChangeQuestDialogMissingPermissions").show();i.reject();return}return r=this,jQuery.ajax({url:"/api/TaleApi/GetDialogByRelatedObjectId?relatedObjectId="+t,type:"GET"}).done(function(n){i.resolve(n)}).fail(function(){i.reject()}),i.promise()};i.ChangeQuestInNpcDialogBaseAction.prototype.loadNpcName=function(t){var i=new jQuery.Deferred;if(!n.Aika.Quest.hasKortistoRights){this.contentElement.find(".gn-aikaActionChangeQuestDialogMissingPermissions").show();i.reject();return}return jQuery.ajax({url:"/api/KortistoApi/ResolveFlexFieldObjectNames",headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify([t]),type:"POST",contentType:"application/json"}).done(function(n){if(n.length==0){i.reject();return}i.resolve(n[0].name)}).fail(function(){i.reject()}),i.promise()}})(t.Actions=t.Actions||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=11;i.ChangeQuestStateInNpcDialogAction=function(){i.ChangeQuestInNpcDialogBaseAction.apply(this)};i.ChangeQuestStateInNpcDialogAction.prototype=jQuery.extend({},i.ChangeQuestInNpcDialogBaseAction.prototype);i.ChangeQuestStateInNpcDialogAction.prototype.getAdditionalContent=function(){return"<div class='gn-nodeActionText'>"+n.DefaultNodeShapes.Localization.Actions.QuestState+"<\/div><select class='gn-nodeActionQuestState'><\/select>"};i.ChangeQuestStateInNpcDialogAction.prototype.initializeAdditional=function(t,i){var u=t.find(".gn-nodeActionQuestState"),r;n.Util.fillSelectFromArray(u,n.DefaultNodeShapes.Shapes.getQuestStates(),function(n){return n.questState},function(n){return n.label});r=this;u.change(function(){r.saveData();r.validateDialogNodeExistsWithLoadingIndicator(i)})};i.ChangeQuestStateInNpcDialogAction.prototype.deserializeAdditionalData=function(n){this.contentElement.find(".gn-nodeActionQuestState").find("option[value='"+n.questState+"']").prop("selected",!0)};i.ChangeQuestStateInNpcDialogAction.prototype.saveAdditionalData=function(n){n.questState=this.contentElement.find(".gn-nodeActionQuestState").val()};i.ChangeQuestStateInNpcDialogAction.prototype.isActionNodeValid=function(i){if(i.actionType!=n.DefaultNodeShapes.Actions.actionTypeChangeQuestState||!i.actionData)return!1;var u=this.contentElement.find(".gn-nodeActionQuestState").val(),r=JSON.parse(i.actionData);return r.questState==u&&r.questId==t.getCurrentQuestId()?!0:!1};i.ChangeQuestStateInNpcDialogAction.prototype.buildAction=function(){return new i.ChangeQuestStateInNpcDialogAction};i.ChangeQuestStateInNpcDialogAction.prototype.getType=function(){return r};i.ChangeQuestStateInNpcDialogAction.prototype.getLabel=function(){return t.Localization.Actions.ChangeQuestStateInNpcDialogActionLabel};i.ChangeQuestStateInNpcDialogAction.prototype.getValidationFailedText=function(){return t.Localization.Actions.ChangeQuestStateDialogValidationFailed};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.ChangeQuestStateInNpcDialogAction)})(t.Actions=t.Actions||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=12;i.ChangeQuestTextInNpcDialogAction=function(){i.ChangeQuestInNpcDialogBaseAction.apply(this)};i.ChangeQuestTextInNpcDialogAction.prototype=jQuery.extend({},i.ChangeQuestInNpcDialogBaseAction.prototype);i.ChangeQuestTextInNpcDialogAction.prototype.isActionNodeValid=function(i){if(i.actionType!=n.DefaultNodeShapes.Actions.actionTypeAddQuestToText||!i.actionData)return!1;var r=JSON.parse(i.actionData);return r.questId==t.getCurrentQuestId()?!0:!1};i.ChangeQuestTextInNpcDialogAction.prototype.buildAction=function(){return new i.ChangeQuestTextInNpcDialogAction};i.ChangeQuestTextInNpcDialogAction.prototype.getType=function(){return r};i.ChangeQuestTextInNpcDialogAction.prototype.getLabel=function(){return t.Localization.Actions.ChangeQuestTextInNpcDialogActionLabel};i.ChangeQuestTextInNpcDialogAction.prototype.getValidationFailedText=function(){return t.Localization.Actions.ChangeQuestTextDialogValidationFailed};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.ChangeQuestTextInNpcDialogAction)})(t.Actions=t.Actions||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var f=14,e=0,r=1,o=0,s=1,u=2,h=3,c=4;i.WaitAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this)};i.WaitAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.WaitAction.prototype.getContent=function(){return"<input type='text' class='gn-actionNodeWaitAmount'/><select class='gn-actionNodeWaitType'><\/select><select class='gn-actionNodeWaitUnit'><\/select>"};i.WaitAction.prototype.onInitialized=function(i){var s,o,u,f;this.contentElement=i;this.contentElement.find(".gn-actionNodeWaitAmount").val("0");s=[{label:t.Localization.Actions.WaitTypeRealTime,value:e},{label:t.Localization.Actions.WaitTypeGameTime,value:r}];o=i.find(".gn-actionNodeWaitType");n.Util.fillSelectFromArray(o,s,function(n){return n.value},function(n){return n.label});u=this;o.on("change",function(){u.syncTimeUnits();u.serialize()});this.syncTimeUnits();i.find(".gn-actionNodeWaitUnit").on("change",function(){u.serialize()});f=i.find(".gn-actionNodeWaitAmount");f.keydown(function(t){n.Util.validateNumberKeyPress(f,t)});f.change(function(){u.isNumberValueSelected&&u.ensureNumberValue();u.serialize()});this.deserialize()};i.WaitAction.prototype.syncTimeUnits=function(){var i=[{label:t.Localization.Actions.WaitUnitMilliseconds,value:o},{label:t.Localization.Actions.WaitUnitSeconds,value:s},{label:t.Localization.Actions.WaitUnitMinutes,value:u}];this.contentElement.find(".gn-actionNodeWaitType").val()==r&&(i=[{label:t.Localization.Actions.WaitUnitMinutes,value:u},{label:t.Localization.Actions.WaitUnitHours,value:h},{label:t.Localization.Actions.WaitUnitDays,value:c}]);n.Util.fillSelectFromArray(this.contentElement.find(".gn-actionNodeWaitUnit"),i,function(n){return n.value},function(n){return n.label})};i.WaitAction.prototype.ensureNumberValue=function(){var n=parseFloat(this.contentElement.find(".gn-actionNodeWaitAmount").val());isNaN(n)&&this.contentElement.find(".gn-actionNodeWaitAmount").val("0")};i.WaitAction.prototype.deserialize=function(){var t=this.nodeModel.get("actionData"),n;if(!t)return"";n=JSON.parse(t);this.contentElement.find(".gn-actionNodeWaitAmount").val(n.waitAmount);this.contentElement.find(".gn-actionNodeWaitType").find("option[value='"+n.waitType+"']").prop("selected",!0);this.syncTimeUnits();this.contentElement.find(".gn-actionNodeWaitUnit").find("option[value='"+n.waitUnit+"']").prop("selected",!0)};i.WaitAction.prototype.serialize=function(){var n=parseFloat(this.contentElement.find(".gn-actionNodeWaitAmount").val());isNaN(n)&&(n=0);var t=this.contentElement.find(".gn-actionNodeWaitType").val(),i=this.contentElement.find(".gn-actionNodeWaitUnit").val(),r={waitAmount:n,waitType:t,waitUnit:i};this.nodeModel.set("actionData",JSON.stringify(r))};i.WaitAction.prototype.buildAction=function(){return new i.WaitAction};i.WaitAction.prototype.getType=function(){return f};i.WaitAction.prototype.getLabel=function(){return t.Localization.Actions.WaitLabel};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.WaitAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.LearnForgetSkillAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.LearnForgetSkillAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.LearnForgetSkillAction.prototype=jQuery.extend(i.LearnForgetSkillAction.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.LearnForgetSkillAction.prototype.getContent=function(){return"<div class='gn-actionNodeObjectSelectContainer'><a class='gn-clickable gn-nodeActionSelectSkill gn-nodeNonClickableOnReadonly'><\/a>&nbsp;<a class='gn-clickable gn-nodeActionOpenSkill' title='"+t.Localization.Actions.OpenSkillTooltip+"' style='display: none'><i class='glyphicon glyphicon-eye-open'><\/i><\/a><\/div>"};i.LearnForgetSkillAction.prototype.onInitialized=function(n,i){var u,f,e,r;this.contentElement=n;this.contentElement.find(".gn-nodeActionSelectSkill").html(t.Localization.Actions.ChooseSkillLabel);u=n.find(".gn-nodeActionOpenSkill");f=this.deserializeData();f&&(u.show(),i.showLoading(),i.hideError(),this.loadObjectShared(f).then(function(t){n.find(".gn-nodeActionSelectSkill").text(t.name);i.hideLoading()}).fail(function(){i.hideLoading();i.showError()}));e=this;r=n.find(".gn-nodeActionSelectSkill");n.find(".gn-nodeActionSelectSkill").on("click",function(){t.openSkillSearchDialog().then(function(n){r.data("skillid",n.id);r.text(n.name);e.saveData();u.show()})});u.on("click",function(){r.data("skillid")&&window.open("/Evne/Skill?id="+r.data("skillid"))})};i.LearnForgetSkillAction.prototype.deserializeData=function(){var i=this.nodeModel.get("actionData"),n,t;return i?(n=JSON.parse(i),t="",n.skillId?(this.contentElement.find(".gn-nodeActionSelectSkill").data("skillid",n.skillId),t=n.skillId):this.contentElement.find(".gn-nodeActionSelectSkill").data("skillid",""),t):""};i.LearnForgetSkillAction.prototype.saveData=function(){var n=this.getObjectId(),t={skillId:n};this.nodeModel.set("actionData",JSON.stringify(t));this.nodeModel.set("actionRelatedToObjectType",this.getObjectTypeName());this.nodeModel.set("actionRelatedToObjectId",n)};i.LearnForgetSkillAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectSkill};i.LearnForgetSkillAction.prototype.getObjectId=function(){return this.contentElement.find(".gn-nodeActionSelectSkill").data("skillid")};i.LearnForgetSkillAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceSkill};i.LearnForgetSkillAction.prototype.loadObject=function(n){var t=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/EvneApi/FlexFieldObject?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise()}})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=18;i.PlayerLearnSkillAction=function(){n.DefaultNodeShapes.Actions.LearnForgetSkillAction.apply(this)};i.PlayerLearnSkillAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.LearnForgetSkillAction.prototype);i.PlayerLearnSkillAction.prototype.buildAction=function(){return new i.PlayerLearnSkillAction};i.PlayerLearnSkillAction.prototype.getType=function(){return r};i.PlayerLearnSkillAction.prototype.getLabel=function(){return t.Localization.Actions.PlayerLearnSkillLabel};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.PlayerLearnSkillAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=19;i.PlayerForgetSkillAction=function(){n.DefaultNodeShapes.Actions.LearnForgetSkillAction.apply(this)};i.PlayerForgetSkillAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.LearnForgetSkillAction.prototype);i.PlayerForgetSkillAction.prototype.buildAction=function(){return new i.PlayerForgetSkillAction};i.PlayerForgetSkillAction.prototype.getType=function(){return r};i.PlayerForgetSkillAction.prototype.getLabel=function(){return t.Localization.Actions.PlayerForgetSkillLabel};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.PlayerForgetSkillAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.ChangeSkillValueAction=function(){n.DefaultNodeShapes.Actions.ChangeValueChooseObjectAction.apply(this)};i.ChangeSkillValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeValueChooseObjectAction.prototype);i.ChangeSkillValueAction.prototype.getChooseLabel=function(){return t.Localization.Actions.ChooseSkillLabel};i.ChangeSkillValueAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectSkill};i.ChangeSkillValueAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceSkill};i.ChangeSkillValueAction.prototype.openSearchDialog=function(){return n.DefaultNodeShapes.openSkillSearchDialog()};i.ChangeSkillValueAction.prototype.loadObject=function(){var n=new jQuery.Deferred,t=this;return jQuery.ajax({url:"/api/EvneApi/FlexFieldObject?id="+this.nodeModel.get("objectId"),type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()}})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=22;i.ChangePlayerSkillValueAction=function(){n.DefaultNodeShapes.Actions.ChangeSkillValueAction.apply(this)};i.ChangePlayerSkillValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeSkillValueAction.prototype);i.ChangePlayerSkillValueAction.prototype.buildAction=function(){return new i.ChangePlayerSkillValueAction};i.ChangePlayerSkillValueAction.prototype.getType=function(){return r};i.ChangePlayerSkillValueAction.prototype.getLabel=function(){return t.Localization.Actions.ChangePlayerSkillValueLabel};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.ChangePlayerSkillValueAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){function o(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:u,icon:"glyphicon-flag",size:{width:250,height:150},inPorts:["input"],outPorts:[],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"}},detailViewId:"",finishName:"",finishColor:r[0].color},joint.shapes.default.Base.prototype.defaults)})}function s(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<input type="text" class="gn-aikaFinishName" placeholder="'+t.Localization.Finish.FinishName+'"/>','<select class="gn-aikaFinishColor"/>',"<\/div>",].join(""),initialize:function(){var f,u,n,i;joint.shapes.default.BaseView.prototype.initialize.apply(this,arguments);f=this;u=this.$box.find(".gn-aikaFinishName");u.on("change",function(){f.model.set("finishName",u.val())});for(u.val(this.model.get("finishName")),n=this.$box.find(".gn-aikaFinishColor"),i=0;i<r.length;++i)n.append(jQuery("<option>",{value:r[i].color,text:t.Localization.Finish.Colors[r[i].name]}));n.on("change",function(){f.model.set("finishColor",n.val())});n.find("option[value='"+this.model.get("finishColor")+"']").prop("selected",!0)}})}var u="aika.Finish",e="finish",r=[{name:"White",color:"#FFFFFF"},{name:"Red",color:"#CC0000"},{name:"Green",color:"#008800"},{name:"Blue",color:"#0000CC"},{name:"Yellow",color:"#FDFF00"},{name:"Purple",color:"#66008e"}],f;joint.shapes.aika=joint.shapes.aika||{};joint.shapes.aika.Finish=o();joint.shapes.aika.FinishView=s();i.FinishSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.aika.Finish,u,e])};i.FinishSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);i.FinishSerializer.prototype.serialize=function(n){return{id:n.id,x:n.position.x,y:n.position.y,detailViewId:n.detailViewId,name:n.finishName,color:n.finishColor}};i.FinishSerializer.prototype.deserialize=function(n){var t={id:n.id,position:{x:n.x,y:n.y},detailViewId:n.detailViewId,finishName:n.name,finishColor:n.color},n=new this.classType(t);return n};f=new i.FinishSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(f)})(t.Shared=t.Shared||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){function u(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:t.startType,icon:"glyphicon-play",size:{width:100,height:50},inPorts:[],outPorts:["output"],attrs:{".outPorts circle":{magnet:"true"}}},joint.shapes.default.Base.prototype.defaults)})}function f(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>',"<\/div>",].join("")})}var i,r;t.startType="aika.Start";i="start";joint.shapes.aika=joint.shapes.aika||{};joint.shapes.aika.Start=u();joint.shapes.aika.StartView=f();t.StartSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.aika.Start,t.startType,i])};t.StartSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);t.StartSerializer.prototype.serialize=function(n){return{id:n.id,x:n.position.x,y:n.position.y}};t.StartSerializer.prototype.deserialize=function(n){var t={id:n.id,position:{x:n.x,y:n.y}},n=new this.classType(t);return n};r=new t.StartSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(r)})(t.Shared=t.Shared||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){function f(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:i,icon:"glyphicon-resize-small",size:{width:175,height:50},inPorts:["input"],outPorts:["output"],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"},".outPorts circle":{magnet:"true"}}},joint.shapes.default.Base.prototype.defaults)})}function e(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>',"<\/div>",].join("")})}var i="aika.AllDone",u="allDone",r;joint.shapes.aika=joint.shapes.aika||{};joint.shapes.aika.AllDone=f();joint.shapes.aika.AllDoneView=e();t.AllDoneSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.aika.AllDone,i,u])};t.AllDoneSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);t.AllDoneSerializer.prototype.serialize=function(n){return{id:n.id,x:n.position.x,y:n.position.y}};t.AllDoneSerializer.prototype.deserialize=function(n){var t={id:n.id,position:{x:n.x,y:n.y}},n=new this.classType(t);return n};r=new t.AllDoneSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(r)})(t.Shared=t.Shared||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){function e(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:r,icon:"glyphicon-text-background",size:{width:250,height:150},inPorts:["input"],outPorts:["output"],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"},".outPorts circle":{magnet:"true"}},text:""},joint.shapes.default.Base.prototype.defaults)})}function o(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<textarea class="nodeText" placeholder="'+t.Localization.TextNode.Text+'" />',"<\/div>",].join("")})}var r="aika.Text",f="text",u;joint.shapes.aika=joint.shapes.aika||{};joint.shapes.aika.Text=e();joint.shapes.aika.TextView=o();i.TextSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.aika.Text,r,f])};i.TextSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);i.TextSerializer.prototype.serialize=function(n){return{id:n.id,x:n.position.x,y:n.position.y,text:n.nodeText}};i.TextSerializer.prototype.deserialize=function(n){var t={id:n.id,position:{x:n.x,y:n.y},nodeText:n.text},n=new this.classType(t);return n};u=new i.TextSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(u)})(t.Quest=t.Quest||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=20,u=350;i.ViewModel=function(){var r,u,i;n.DefaultNodeShapes.BaseViewModel.apply(this);n.FlexFieldDatabase.ObjectForm.FlexFieldHandlingViewModel.apply(this);this.id=new ko.observable("");r=n.Util.getParameterFromUrl("id");r&&this.id(r);this.name=new ko.observable("");this.description=new ko.observable("");this.isMainQuest=new ko.observable(!1);this.isHeaderExpanded=new ko.observable(!1);this.areFieldsExpanded=new ko.observable(!1);this.areConnectionsExpanded=new ko.observable(!1);this.mentionedInAikaDetails=new ko.observableArray;this.loadingMentionedInAikaDetails=new ko.observable(!1);this.errorLoadingMentionedInAikaDetails=new ko.observable(!1);this.usedInAikaQuests=new ko.observableArray;this.loadingUsedInAikaQuests=new ko.observable(!1);this.errorLoadingUsedInAikaQuests=new ko.observable(!1);this.mentionedInKirjaPages=new ko.observableArray;this.loadingMentionedInKirjaPages=new ko.observable(!1);this.errorLoadingMentionedInKirjaPages=new ko.observable(!1);this.referencedInTaleDialogs=new ko.observableArray;this.loadingReferencedInTaleDialogs=new ko.observable(!1);this.errorLoadingReferencedInTaleDialogs=new ko.observable(!1);this.hasMarkersInKartaMaps=new ko.observableArray;this.loadingHasMarkersInKartaMaps=new ko.observable(!1);this.errorLoadingHasMarkersInKartaMaps=new ko.observable(!1);this.showDeleteDialog=new ko.observable(!1);this.isLoading=new ko.observable(!1);this.isReadonly=new ko.observable(!1);this.lockedByUser=new ko.observable("");this.conditionDialog=new n.DefaultNodeShapes.Conditions.ConditionDialog;this.chooseObjectDialog=new n.ChooseObjectDialog.ViewModel;this.isImplemented=new ko.observable(!1);this.compareDialog=new n.ImplementationStatus.CompareDialog.ViewModel;this.additionalErrorDetails=new ko.observable("");this.questNotFound=new ko.observable(!1);this.id()?(this.load(),this.loadAikaDetails(),this.loadAikaQuests(),n.Aika.Quest.hasKirjaRights&&this.loadKirjaPages(),n.Aika.Quest.hasTaleRights&&this.loadTaleDialogs(),n.Aika.Quest.hasKartaRights&&this.loadKartaMaps(),this.acquireLock()):(this.isHeaderExpanded(!0),i=this,u=this.nodePaper.subscribe(function(n){n&&(u.dispose(),i.addStartNode())}));n.Util.setupValidation("#gn-questHeader");i=this;t.getCurrentQuestId=function(){return i.id()};n.DefaultNodeShapes.openConditionDialog=function(n){var t,r;return i.isReadonly()?(t=new jQuery.Deferred,t.reject(),t.promise()):(r=new jQuery.Deferred,i.conditionDialog.openDialog(n,r),r)};n.DefaultNodeShapes.openQuestSearchDialog=function(){if(i.isReadonly()){var n=new jQuery.Deferred;return n.reject(),n.promise()}return i.chooseObjectDialog.openQuestSearch(t.Localization.QuestViewModel.ChooseQuest)};n.DefaultNodeShapes.openNpcSearchDialog=function(){if(i.isReadonly()){var n=new jQuery.Deferred;return n.reject(),n.promise()}return i.chooseObjectDialog.openNpcSearch(t.Localization.QuestViewModel.ChooseNpc)};n.DefaultNodeShapes.openSkillSearchDialog=function(){if(i.isReadonly()){var n=new jQuery.Deferred;return n.reject(),n.promise()}return i.chooseObjectDialog.openSkillSearch(t.Localization.QuestViewModel.ChooseSkill)};n.DefaultNodeShapes.Shapes.loadConfigLists().fail(function(){i.errorOccured(!0)})};i.ViewModel.prototype=jQuery.extend({},n.DefaultNodeShapes.BaseViewModel.prototype);i.ViewModel.prototype=jQuery.extend(i.ViewModel.prototype,n.FlexFieldDatabase.ObjectForm.FlexFieldHandlingViewModel.prototype);i.ViewModel.prototype.addStartNode=function(){var n=this.calcNodeInitOptionsPosition(r,u);this.addNodeByType(t.Shared.startType,n)};i.ViewModel.prototype.toogleHeaderVisibility=function(){this.isHeaderExpanded(!this.isHeaderExpanded())};i.ViewModel.prototype.toogleFieldVisibility=function(){this.areFieldsExpanded(!this.areFieldsExpanded())};i.ViewModel.prototype.onFieldAdded=function(){this.areFieldsExpanded(!0)};i.ViewModel.prototype.toogleConnectionsVisibility=function(){this.areConnectionsExpanded(!this.areConnectionsExpanded())};i.ViewModel.prototype.loadAikaDetails=function(){this.loadingMentionedInAikaDetails(!0);this.errorLoadingMentionedInAikaDetails(!1);var n=this;jQuery.ajax({url:"/api/AikaApi/GetChapterDetailsByQuest?questId="+this.id(),type:"GET"}).done(function(t){n.mentionedInAikaDetails(t);n.loadingMentionedInAikaDetails(!1)}).fail(function(){n.errorLoadingMentionedInAikaDetails(!0);n.loadingMentionedInAikaDetails(!1)})};i.ViewModel.prototype.buildAikaDetailUrl=function(n){return"/Aika/Detail?id="+n.id};i.ViewModel.prototype.loadAikaQuests=function(){this.loadingUsedInAikaQuests(!0);this.errorLoadingUsedInAikaQuests(!1);var n=this;jQuery.ajax({url:"/api/AikaApi/GetQuestsObjectIsReferenced?objectId="+this.id(),type:"GET"}).done(function(t){for(var r=[],i=0;i<t.length;++i)t[i].id!=n.id()&&r.push(t[i]);n.usedInAikaQuests(r);n.loadingUsedInAikaQuests(!1)}).fail(function(){n.errorLoadingUsedInAikaQuests(!0);n.loadingUsedInAikaQuests(!1)})};i.ViewModel.prototype.buildAikaQuestUrl=function(n){return"/Aika/Quest?id="+n.id};i.ViewModel.prototype.loadKirjaPages=function(){this.loadingMentionedInKirjaPages(!0);this.errorLoadingMentionedInKirjaPages(!1);var n=this;jQuery.ajax({url:"/api/KirjaApi/GetPagesByQuest?questId="+this.id(),type:"GET"}).done(function(t){n.mentionedInKirjaPages(t);n.loadingMentionedInKirjaPages(!1)}).fail(function(){n.errorLoadingMentionedInKirjaPages(!0);n.loadingMentionedInKirjaPages(!1)})};i.ViewModel.prototype.buildKirjaPageUrl=function(n){return"/Kirja?id="+n.id};i.ViewModel.prototype.loadTaleDialogs=function(){this.loadingReferencedInTaleDialogs(!0);this.errorLoadingReferencedInTaleDialogs(!1);var t=this;jQuery.ajax({url:"/api/TaleApi/GetDialogsObjectIsReferenced?objectId="+this.id(),type:"GET"}).done(function(i){for(var r=[],u=0;u<i.length;++u)r.push(i[u].relatedObjectId);if(r.length==0){t.referencedInTaleDialogs([]);t.loadingReferencedInTaleDialogs(!1);return}jQuery.ajax({url:"/api/KortistoApi/ResolveFlexFieldObjectNames",headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(r),type:"POST",contentType:"application/json"}).done(function(n){t.referencedInTaleDialogs(n);t.loadingReferencedInTaleDialogs(!1)}).fail(function(){t.errorLoadingReferencedInTaleDialogs(!0);t.loadingReferencedInTaleDialogs(!1)})}).fail(function(){t.errorLoadingReferencedInTaleDialogs(!0);t.loadingReferencedInTaleDialogs(!1)})};i.ViewModel.prototype.buildTaleDialogUrl=function(n){return"/Tale?npcId="+n.id};i.ViewModel.prototype.loadKartaMaps=function(){this.loadingHasMarkersInKartaMaps(!0);this.errorLoadingHasMarkersInKartaMaps(!1);var n=this;jQuery.ajax({url:"/api/KartaApi/GetMapsByQuestId?questId="+this.id(),type:"GET"}).done(function(t){n.hasMarkersInKartaMaps(t);n.loadingHasMarkersInKartaMaps(!1)}).fail(function(){n.errorLoadingHasMarkersInKartaMaps(!0);n.loadingHasMarkersInKartaMaps(!1)})};i.ViewModel.prototype.buildKartaMapUrl=function(n){return"/Karta?id="+n.id+"&preSelectType=Quest&preSelectId="+this.id()};i.ViewModel.prototype.save=function(){var i,r,t;this.nodeGraph()&&jQuery("#gn-questHeader").valid()&&(i=n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().serializeGraph(this.nodeGraph()),i.name=this.name(),i.description=this.description(),i.isMainQuest=this.isMainQuest(),i.fields=this.fieldManager.serializeFields(),r="",r=this.id()?"/api/AikaApi/UpdateQuest?id="+this.id():"/api/AikaApi/CreateQuest",this.isLoading(!0),this.errorOccured(!1),t=this,jQuery.ajax({url:r,headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(i),type:"POST",contentType:"application/json"}).done(function(i){t.id()||(t.id(i.id),t.acquireLock(),n.Util.replaceUrlParameters("id="+i.id),n.BindingHandlers.nodeGraphRefreshPositionZoomUrl());t.isImplemented(i.isImplemented);t.fieldManager.syncFieldIds(i);t.reloadFieldsForNodes(n.DefaultNodeShapes.Shapes.ObjectResourceQuest,t.id());t.callOnQuestSaved();t.isLoading(!1)}).fail(function(n){t.isLoading(!1);t.errorOccured(!0);n.status==400&&n.responseText&&t.additionalErrorDetails(n.responseText)}))};i.ViewModel.prototype.load=function(){this.isLoading(!0);this.errorOccured(!1);var t=this;jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+this.id(),type:"GET"}).done(function(i){if(t.isLoading(!1),!i){t.errorOccured(!0);t.questNotFound(!0);return}t.name(i.name);t.description(i.description);t.isMainQuest(i.isMainQuest);t.isImplemented(i.isImplemented);i.fields||(i.fields=[]);t.fieldManager.deserializeFields(i.fields);n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().deserializeGraph(t.nodeGraph(),i,function(n){t.setupNewNode(n)});t.isReadonly()&&t.setGraphToReadonly()}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})};i.ViewModel.prototype.acquireLock=function(){this.lockedByUser("");this.isReadonly(!1);var t=this;n.LockService.acquireLock("Quest",this.id()).done(function(n,i){n&&(t.isReadonly(!0),t.lockedByUser(i),t.setGraphToReadonly())}).fail(function(){t.errorOccured(!0)})};i.ViewModel.prototype.openDeleteQuestDialog=function(){this.showDeleteDialog(!0)};i.ViewModel.prototype.deleteQuest=function(){if(this.id()){this.isLoading(!0);this.errorOccured(!1);this.additionalErrorDetails("");var t=this;jQuery.ajax({url:"/api/AikaApi/DeleteQuest?id="+this.id(),headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.callOnQuestSaved();window.opener!=null?window.close():window.location="/Aika/QuestList"}).fail(function(n){t.isLoading(!1);t.errorOccured(!0);t.closeDeleteQuestDialog();n.status==400&&n.responseText&&t.additionalErrorDetails(n.responseText)})}};i.ViewModel.prototype.closeDeleteQuestDialog=function(){this.showDeleteDialog(!1)};i.ViewModel.prototype.openCompareDialog=function(){var n=this;this.compareDialog.openQuestCompare(this.id(),this.name()).done(function(){n.isImplemented(!0)})};i.ViewModel.prototype.callOnQuestSaved=function(){if(window.onQuestSaved)window.onQuestSaved(this.id())};i.ViewModel.prototype.openQuestList=function(){window.location="/Aika/QuestList"}})(t.Quest=t.Quest||{})})(n.Aika=n.Aika||{})}(window.GoNorth=window.GoNorth||{});