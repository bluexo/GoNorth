(function(n){"use strict";(function(n){var t=15;n.ViewModel=function(){this.showDialog=new ko.observable(!1);this.dialogTitle=new ko.observable("");this.showNewButtonInDialog=new ko.observable(!1);this.dialogSearchCallback=null;this.dialogCreateNewCallback=null;this.dialogSearchPattern=new ko.observable("");this.dialogIsLoading=new ko.observable(!1);this.dialogEntries=new ko.observableArray;this.dialogHasMore=new ko.observable(!1);this.dialogCurrentPage=new ko.observable(0);this.errorOccured=new ko.observable(!1);this.idObservable=null;this.choosingDeferred=null};n.ViewModel.prototype={openNpcSearch:function(n,t){return this.openDialog(n,this.searchNpcs,t,null)},openItemSearch:function(n,t){return this.openDialog(n,this.searchItems,t,null)},openSkillSearch:function(n,t){return this.openDialog(n,this.searchSkills,t,null)},openKirjaPageSearch:function(n,t,i){return this.openDialog(n,this.searchPages,t,i)},openQuestSearch:function(n,t){return this.openDialog(n,this.searchQuest,t,null)},openChapterDetailSearch:function(n,t,i){return this.openDialog(n,this.searchChapterDetails,t,i)},openDialog:function(n,t,i,r){return this.choosingDeferred&&(this.choosingDeferred.reject(),this.choosingDeferred=null),this.showDialog(!0),this.dialogTitle(n),this.dialogCreateNewCallback=typeof i=="function"?i:null,this.showNewButtonInDialog(this.dialogCreateNewCallback?!0:!1),this.dialogSearchCallback=t,this.dialogSearchPattern(""),this.dialogIsLoading(!1),this.dialogEntries([]),this.dialogHasMore(!1),this.dialogCurrentPage(0),this.idObservable=r,this.choosingDeferred=new jQuery.Deferred,this.choosingDeferred.promise()},selectObject:function(n){this.choosingDeferred&&(this.choosingDeferred.resolve(n),this.choosingDeferred=null);this.closeDialog()},cancelDialog:function(){this.choosingDeferred&&(this.choosingDeferred.reject(),this.choosingDeferred=null);this.closeDialog()},closeDialog:function(){this.showDialog(!1)},startNewDialogSearch:function(){this.dialogCurrentPage(0);this.dialogHasMore(!1);this.runDialogSearch()},prevDialogPage:function(){this.dialogCurrentPage(this.dialogCurrentPage()-1);this.runDialogSearch()},nextDialogPage:function(){this.dialogCurrentPage(this.dialogCurrentPage()+1);this.runDialogSearch()},runDialogSearch:function(){this.dialogIsLoading(!0);this.errorOccured(!1);var n=this;this.dialogSearchCallback(this.dialogSearchPattern()).done(function(t){n.dialogHasMore(t.hasMore);n.dialogEntries(t.entries);n.dialogIsLoading(!1)}).fail(function(){n.errorOccured(!0);n.dialogIsLoading(!1)})},createDialogObject:function(n,t,i){return{id:n,name:t,openLink:i}},searchPages:function(n){var i=new jQuery.Deferred,r="/api/KirjaApi/SearchPages?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,u;return this.idObservable&&(r+="&excludeId="+this.idObservable()),u=this,jQuery.ajax({url:r,type:"GET"}).done(function(n){for(var r={hasMore:n.hasMore,entries:[]},t=0;t<n.pages.length;++t)r.entries.push(u.createDialogObject(n.pages[t].id,n.pages[t].name,"/Kirja?id="+n.pages[t].id));i.resolve(r)}).fail(function(){i.reject()}),i.promise()},openCreatePage:function(){this.dialogCreateNewCallback()},searchNpcs:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/KortistoApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Kortisto/Npc?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchItems:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/StyrApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Styr/Item?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchSkills:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/EvneApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Evne/Skill?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchQuest:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/AikaApi/GetQuests?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.quests.length;++t)u.entries.push(r.createDialogObject(n.quests[t].id,n.quests[t].name,"/Aika/Quest?id="+n.quests[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchChapterDetails:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/AikaApi/GetChapterDetails?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.details.length;++t)r.idObservable&&r.idObservable()==n.details[t].id||u.entries.push(r.createDialogObject(n.details[t].id,n.details[t].name,"/Aika/Detail?id="+n.details[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()}}})(n.ChooseObjectDialog=n.ChooseObjectDialog||{})})(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){this.isOpen=new ko.observable(!1);var n=this;this.isOpen.subscribe(function(t){!t&&n.markAsImplementedPromise&&n.markAsImplementedPromise.reject()});this.objectName=new ko.observable("");this.isLoading=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.markAsImplementedPromise=null;this.flagAsImplementedMethodUrlPostfix=null;this.doesSnapshotExists=new ko.observable(!1);this.difference=new ko.observableArray};t.ViewModel.prototype={openNpcCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagNpcAsImplemented?npcId="+n,this.loadCompareResult("CompareNpc?npcId="+n)},openItemCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagItemAsImplemented?itemId="+n,this.loadCompareResult("CompareItem?itemId="+n)},openSkillCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagSkillAsImplemented?skillId="+n,this.loadCompareResult("CompareSkill?skillId="+n)},openDialogCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagDialogAsImplemented?dialogId="+n,this.loadCompareResult("CompareDialog?dialogId="+n)},openQuestCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagQuestAsImplemented?questId="+n,this.loadCompareResult("CompareQuest?questId="+n)},openMarkerCompare:function(n,t,i){return this.isOpen(!0),this.objectName(""),this.flagAsImplementedMethodUrlPostfix="FlagMarkerAsImplemented?mapId="+n+"&markerId="+t+"&markerType="+i,this.loadCompareResult("CompareMarker?mapId="+n+"&markerId="+t+"&markerType="+i)},loadCompareResult:function(n){this.isLoading(!0);this.errorOccured(!1);this.difference([]);var t=this;return jQuery.ajax({url:"/api/ImplementationStatusApi/"+n,type:"GET"}).done(function(n){t.isLoading(!1);t.addExpandedObservable(n.compareDifference);t.doesSnapshotExists(n.doesSnapshotExist);n.compareDifference&&t.difference(n.compareDifference)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)}),this.markAsImplementedPromise=new jQuery.Deferred,this.markAsImplementedPromise.promise()},addExpandedObservable:function(n){if(n)for(var t=0;t<n.length;++t)n[t].isExpanded=new ko.observable(!0),this.addExpandedObservable(n[t].subDifferences)},toggleCompareResultExpanded:function(n){n.isExpanded(!n.isExpanded())},markAsImplemented:function(){this.isLoading(!0);this.errorOccured(!1);var t=this;jQuery.ajax({url:"/api/ImplementationStatusApi/"+this.flagAsImplementedMethodUrlPostfix,headers:n.Util.generateAntiForgeryHeader(),type:"POST"}).done(function(){window.refreshImplementationStatusList&&window.refreshImplementationStatusList();t.markAsImplementedPromise.resolve();t.markAsImplementedPromise=null;t.isLoading(!1);t.isOpen(!1)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})},closeDialog:function(){this.isOpen(!1)}}})(t.CompareDialog=t.CompareDialog||{})})(n.ImplementationStatus=n.ImplementationStatus||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldScriptSettingsAdditionalScriptNameSeperator=",";n.FlexFieldScriptSettings=function(){this.dontExportToScript=!1;this.additionalScriptNames=""};n.FlexFieldScriptSettings.prototype={serialize:function(){return{dontExportToScript:this.dontExportToScript,additionalScriptNames:this.additionalScriptNames}},deserialize:function(n){this.dontExportToScript=n.dontExportToScript;this.additionalScriptNames=n.additionalScriptNames}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldBase=function(){this.id=new ko.observable("");this.createdFromTemplate=new ko.observable(!1);this.name=new ko.observable;this.scriptSettings=new n.FlexFieldScriptSettings};n.FlexFieldBase.prototype={getType:function(){},getTemplateName:function(){},canExportToScript:function(){},serializeValue:function(){},deserializeValue:function(){},getChildFields:function(){return null},hasAdditionalConfiguration:function(){return!1},getAdditionalConfigurationLabel:function(){return""},allowEditingAdditionalConfigForTemplateFields:function(){return!1},setAdditionalConfiguration:function(){},getAdditionalConfiguration:function(){return""},serializeAdditionalConfiguration:function(){return""},deserializeAdditionalConfiguration:function(){},groupFields:function(){}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeSingleLine=0;n.SingleLineFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable("")};n.SingleLineFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.SingleLineFlexField.prototype.getType=function(){return n.FlexFieldTypeSingleLine};n.SingleLineFlexField.prototype.getTemplateName=function(){return"gn-singleLineField"};n.SingleLineFlexField.prototype.canExportToScript=function(){return!0};n.SingleLineFlexField.prototype.serializeValue=function(){return this.value()};n.SingleLineFlexField.prototype.deserializeValue=function(n){this.value(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeMultiLine=1;n.MultiLineFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable("")};n.MultiLineFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.MultiLineFlexField.prototype.getType=function(){return n.FlexFieldTypeMultiLine};n.MultiLineFlexField.prototype.getTemplateName=function(){return"gn-multiLineField"};n.MultiLineFlexField.prototype.canExportToScript=function(){return!1};n.MultiLineFlexField.prototype.serializeValue=function(){return this.value()};n.MultiLineFlexField.prototype.deserializeValue=function(n){this.value(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeNumber=2;n.NumberFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable(0)};n.NumberFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.NumberFlexField.prototype.getType=function(){return n.FlexFieldTypeNumber};n.NumberFlexField.prototype.getTemplateName=function(){return"gn-numberField"};n.NumberFlexField.prototype.canExportToScript=function(){return!0};n.NumberFlexField.prototype.serializeValue=function(){return this.value()?this.value().toString():"0.0"};n.NumberFlexField.prototype.deserializeValue=function(n){var t=parseFloat(n);isNaN(t)?this.value(0):this.value(t)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.FlexFieldTypeOption=3;t.OptionFlexField=function(){t.FlexFieldBase.apply(this);this.value=new ko.observable(null);this.options=new ko.observableArray};t.OptionFlexField.prototype=jQuery.extend(!0,{},t.FlexFieldBase.prototype);t.OptionFlexField.prototype.getType=function(){return t.FlexFieldTypeOption};t.OptionFlexField.prototype.getTemplateName=function(){return"gn-optionField"};t.OptionFlexField.prototype.canExportToScript=function(){return!0};t.OptionFlexField.prototype.serializeValue=function(){return this.value()};t.OptionFlexField.prototype.deserializeValue=function(n){this.value(n)};t.OptionFlexField.prototype.hasAdditionalConfiguration=function(){return!0};t.OptionFlexField.prototype.getAdditionalConfigurationLabel=function(){return n.FlexFieldDatabase.Localization.OptionFieldAdditionalConfigurationLabel};t.OptionFlexField.prototype.allowEditingAdditionalConfigForTemplateFields=function(){return!1};t.OptionFlexField.prototype.setAdditionalConfiguration=function(n){var t=[];n&&(t=n.split("\n"));this.options(t)};t.OptionFlexField.prototype.getAdditionalConfiguration=function(){return this.options().join("\n")};t.OptionFlexField.prototype.serializeAdditionalConfiguration=function(){return JSON.stringify(this.options())};t.OptionFlexField.prototype.deserializeAdditionalConfiguration=function(n){var t=[];n&&(t=JSON.parse(n));this.options(t)}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldGroup=100;n.FieldGroup=function(){n.FlexFieldBase.apply(this);this.fields=new ko.observableArray;this.deserializingFieldIds=null;this.isExpandedByDefault=!0;this.areFieldsExpanded=new ko.observable(!0)};n.FieldGroup.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.FieldGroup.prototype.getType=function(){return n.FlexFieldGroup};n.FieldGroup.prototype.getTemplateName=function(){return"gn-fieldGroup"};n.FieldGroup.prototype.canExportToScript=function(){return!1};n.FieldGroup.prototype.serializeValue=function(n){for(var i=[],r=this.fields(),t=0;t<r.length;++t)r[t].id()?i.push(r[t].id()):i.push((n+t+1).toString());return JSON.stringify(i)};n.FieldGroup.prototype.getChildFields=function(){return this.fields()};n.FieldGroup.prototype.deserializeValue=function(n){this.deserializingFieldIds=[];n&&(this.deserializingFieldIds=JSON.parse(n))};n.FieldGroup.prototype.serializeAdditionalConfiguration=function(){return JSON.stringify({isExpandedByDefault:this.isExpandedByDefault})};n.FieldGroup.prototype.deserializeAdditionalConfiguration=function(n){if(n){var t=JSON.parse(n);this.isExpandedByDefault=t.isExpandedByDefault;this.areFieldsExpanded(this.isExpandedByDefault)}};n.FieldGroup.prototype.groupFields=function(n,t){var i,f,r,u;if(this.deserializingFieldIds){for(i=0;i<this.deserializingFieldIds.length;++i){for(f=!1,r=0;r<n.length;++r)if(n[r].id()==this.deserializingFieldIds[i]){t[r]||(this.fields.push(n[r]),t[r]=!0);f=!0;break}!f&&this.deserializingFieldIds[i]&&this.deserializingFieldIds[i].indexOf("-")<0&&(u=parseInt(this.deserializingFieldIds[i]),!isNaN(u)&&u>=0&&u<n.length&&(this.fields.push(n[u]),t[u]=!0))}this.deserializingFieldIds=null}};n.FieldGroup.prototype.toogleFieldVisibility=function(){this.areFieldsExpanded(!this.areFieldsExpanded())};n.FieldGroup.prototype.deleteField=function(n){this.fields.remove(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldManager=function(){this.fields=new ko.observableArray};n.FlexFieldManager.prototype={addSingleLineField:function(t){return this.addField(n.FlexFieldTypeSingleLine,t)},addMultiLineField:function(t){return this.addField(n.FlexFieldTypeMultiLine,t)},addNumberField:function(t){return this.addField(n.FlexFieldTypeNumber,t)},addOptionField:function(t){return this.addField(n.FlexFieldTypeOption,t)},addFieldGroup:function(t){return this.addField(n.FlexFieldGroup,t)},addField:function(n,t){var i=this.resolveFieldByType(n);if(!i)throw"Unknown field type";return i.name(t),this.fields.push(i),i},resolveFieldByType:function(t){switch(t){case n.FlexFieldTypeSingleLine:return new n.SingleLineFlexField;case n.FlexFieldTypeMultiLine:return new n.MultiLineFlexField;case n.FlexFieldTypeNumber:return new n.NumberFlexField;case n.FlexFieldTypeOption:return new n.OptionFlexField;case n.FlexFieldGroup:return new n.FieldGroup}return null},deleteField:function(n){this.fields.remove(n)},deleteFieldGroup:function(n){var r,i,t;if(n.fields)for(r=this.fields.indexOf(n),i=n.fields(),t=0;t<i.length;++t)r<0?this.fields.push(i[t]):this.fields.splice(r+t,0,i[t]);this.fields.remove(n)},serializeFields:function(){for(var i,r,n=[],u=this.fields(),t=0;t<u.length;++t)if(n.push(this.serializeSingleField(u[t],n)),i=u[t].getChildFields(),i)for(r=0;r<i.length;++r)n.push(this.serializeSingleField(i[r],n));return n},serializeSingleField:function(n,t){return{id:n.id(),createdFromTemplate:n.createdFromTemplate(),fieldType:n.getType(),name:n.name(),value:n.serializeValue(t.length),additionalConfiguration:n.serializeAdditionalConfiguration(),scriptSettings:n.scriptSettings.serialize()}},deserializeFields:function(n){for(var i,u,r=[],t=0;t<n.length;++t)i=this.resolveFieldByType(n[t].fieldType),i.id(n[t].id),i.createdFromTemplate(n[t].createdFromTemplate),i.name(n[t].name),i.deserializeValue(n[t].value),i.deserializeAdditionalConfiguration(n[t].additionalConfiguration),i.scriptSettings.deserialize(n[t].scriptSettings),r.push(i);for(u={},t=0;t<r.length;++t)r[t].groupFields(r,u);for(t=r.length-1;t>=0;--t)u[t]&&r.splice(t,1);this.fields(r)},syncFieldIds:function(n){for(var i,r={},t=0;t<n.fields.length;++t)r[n.fields[t].name]=n.fields[t].id;for(i=this.fields(),t=0;t<i.length;++t)i[t].id(r[i[t].name()])},flagFieldsAsCreatedFromTemplate:function(){for(var t,i,r=this.fields(),n=0;n<r.length;++n)if(r[n].createdFromTemplate(!0),t=r[n].getChildFields(),t)for(i=0;i<t.length;++i)t[i].createdFromTemplate(!0)},isFieldNameInUse:function(n,t){var r,i,u,f;for(n=n.toLowerCase(),r=this.fields(),i=0;i<r.length;++i){if(r[i]!=t&&r[i].name()&&r[i].name().toLowerCase()==n)return!0;if(u=r[i].getChildFields(),u)for(f=0;f<u.length;++f)if(u[f]!=t&&u[f].name()&&u[f].name().toLowerCase()==n)return!0}}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.FlexFieldHandlingViewModel=function(){this.fieldManager=new n.FlexFieldDatabase.ObjectForm.FlexFieldManager;this.showFieldCreateEditDialog=new ko.observable(!1);this.isEditingField=new ko.observable(!1);this.fieldToEdit=null;this.createEditFieldName=new ko.observable("");this.createEditFieldAdditionalConfigurationDisabled=new ko.observable(!1);this.createEditFieldHasAdditionalConfiguration=new ko.observable(!1);this.createEditFieldAdditionalConfiguration=new ko.observable("");this.createEditFieldAdditionalConfigurationLabel=new ko.observable("");this.createEditFieldDeferred=null;this.showConfirmFieldDeleteDialog=new ko.observable(!1);this.fieldToDelete=null;this.fieldToDeleteParent=null;this.showFieldScriptSettingsDialog=new ko.observable(!1);this.dontExportFieldToScript=new ko.observable;this.additionalFieldScriptNames=new ko.observable;this.scriptSettingsField=null;this.showFieldGroupCreateEditDialog=new ko.observable(!1);this.fieldGroupToEdit=null;this.isEditingFieldGroup=new ko.observable(!1);this.createEditFieldGroupName=new ko.observable("");this.createEditFieldGroupExpandedByDefault=new ko.observable(!1);this.showDuplicateFieldNameError=new ko.observable(!1);var t=this;this.createEditFieldName.subscribe(function(){t.showDuplicateFieldNameError(!1)});this.createEditFieldGroupName.subscribe(function(){t.showDuplicateFieldNameError(!1)});this.showConfirmFieldGroupDeleteDialog=new ko.observable(!1);this.fieldGroupToDelete=null};t.FlexFieldHandlingViewModel.prototype={onFieldAdded:function(){},addSingleLineField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addSingleLineField(t);n.onFieldAdded()})},addMultiLineField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addMultiLineField(t);n.onFieldAdded()})},addNumberField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addNumberField(t);n.onFieldAdded()})},addOptionField:function(){var t=this;this.openCreateEditFieldDialog(!1,"",!0,"",n.FlexFieldDatabase.Localization.OptionFieldAdditionalConfigurationLabel,!1).done(function(n,i){var r=t.fieldManager.addOptionField(n);r.setAdditionalConfiguration(i);t.onFieldAdded()})},editField:function(n){var t=!n.allowEditingAdditionalConfigForTemplateFields()&&n.createdFromTemplate();this.openCreateEditFieldDialog(!0,n,n.hasAdditionalConfiguration(),n.getAdditionalConfiguration(),n.getAdditionalConfigurationLabel(),t).done(function(t,i){n.name(t);n.hasAdditionalConfiguration()&&n.setAdditionalConfiguration(i)})},openCreateEditFieldDialog:function(t,i,r,u,f,e){return this.createEditFieldDeferred=new jQuery.Deferred,this.isEditingField(t),i?(this.createEditFieldName(i.name()),this.fieldToEdit=i):(this.createEditFieldName(""),this.fieldToEdit=null),this.createEditFieldHasAdditionalConfiguration(r?!0:!1),r&&(this.createEditFieldAdditionalConfigurationDisabled(e),this.createEditFieldAdditionalConfigurationLabel(f),this.createEditFieldAdditionalConfiguration(u?u:"")),n.Util.setupValidation("#gn-fieldCreateEditForm"),this.showFieldCreateEditDialog(!0),this.createEditFieldDeferred.promise()},saveField:function(){if(jQuery("#gn-fieldCreateEditForm").valid()){if(this.fieldManager.isFieldNameInUse(this.createEditFieldName(),this.fieldToEdit)){this.showDuplicateFieldNameError(!0);return}if(this.createEditFieldDeferred){var n=null;this.createEditFieldHasAdditionalConfiguration()&&(n=this.createEditFieldAdditionalConfiguration());this.createEditFieldDeferred.resolve(this.createEditFieldName(),n)}this.createEditFieldDeferred=null;this.showFieldCreateEditDialog(!1)}},cancelFieldDialog:function(){this.createEditFieldDeferred&&this.createEditFieldDeferred.reject();this.createEditFieldDeferred=null;this.fieldToEdit=null;this.showFieldCreateEditDialog(!1)},openCreateNewFieldGroupDialog:function(){n.Util.setupValidation("#gn-fieldGroupCreateEditForm");this.showFieldGroupCreateEditDialog(!0);this.fieldGroupToEdit=null;this.isEditingFieldGroup(!1);this.createEditFieldGroupName("");this.createEditFieldGroupExpandedByDefault(!0)},openEditFieldGroupDialog:function(t){n.Util.setupValidation("#gn-fieldGroupCreateEditForm");this.showFieldGroupCreateEditDialog(!0);this.fieldGroupToEdit=t;this.isEditingFieldGroup(!0);this.createEditFieldGroupName(t.name());this.createEditFieldGroupExpandedByDefault(t.isExpandedByDefault)},saveFieldGroup:function(){if(jQuery("#gn-fieldGroupCreateEditForm").valid()){if(this.fieldManager.isFieldNameInUse(this.createEditFieldGroupName(),this.fieldGroupToEdit)){this.showDuplicateFieldNameError(!0);return}if(this.fieldGroupToEdit==null){var n=this.fieldManager.addFieldGroup(this.createEditFieldGroupName());n.isExpandedByDefault=this.createEditFieldGroupExpandedByDefault();n.areFieldsExpanded(n.isExpandedByDefault)}else this.fieldGroupToEdit.name(this.createEditFieldGroupName()),this.fieldGroupToEdit.isExpandedByDefault=this.createEditFieldGroupExpandedByDefault(),this.fieldGroupToEdit.areFieldsExpanded(this.fieldGroupToEdit.isExpandedByDefault);this.closeFieldGroupDialog()}},closeFieldGroupDialog:function(){this.fieldGroupToEdit=null;this.showFieldGroupCreateEditDialog(!1)},openConfirmDeleteFieldGroupDialog:function(n){this.showConfirmFieldGroupDeleteDialog(!0);this.fieldGroupToDelete=n},closeConfirmFieldGroupDeleteDialog:function(){this.showConfirmFieldGroupDeleteDialog(!1);this.fieldGroupToDelete=null},deleteFieldGroup:function(){this.fieldManager.deleteFieldGroup(this.fieldGroupToDelete);this.closeConfirmFieldGroupDeleteDialog()},checkFieldDropAllowed:function(n){n.item.getType()==t.FlexFieldGroup&&n.targetParent!=this.fieldManager.fields&&(n.cancelDrop=!0)},openConfirmDeleteFieldDialog:function(n,t){this.showConfirmFieldDeleteDialog(!0);this.fieldToDelete=n;this.fieldToDeleteParent=t},closeConfirmFieldDeleteDialog:function(){this.showConfirmFieldDeleteDialog(!1);this.fieldToDelete=null;this.fieldToDeleteParent=null},deleteField:function(){this.fieldToDeleteParent!=null&&typeof this.fieldToDeleteParent.getType=="function"&&this.fieldToDeleteParent.getType()==t.FlexFieldGroup?this.fieldToDeleteParent.deleteField(this.fieldToDelete):this.fieldManager.deleteField(this.fieldToDelete);this.closeConfirmFieldDeleteDialog()},openScriptSettings:function(n){this.showFieldScriptSettingsDialog(!0);this.dontExportFieldToScript(n.scriptSettings.dontExportToScript);this.additionalFieldScriptNames(n.scriptSettings.additionalScriptNames);this.scriptSettingsField=n},saveFieldScriptSettings:function(){this.scriptSettingsField.scriptSettings.dontExportToScript=this.dontExportFieldToScript();this.scriptSettingsField.scriptSettings.additionalScriptNames=this.additionalFieldScriptNames();this.closeFieldScriptSettingsDialog()},closeFieldScriptSettingsDialog:function(){this.showFieldScriptSettingsDialog(!1);this.scriptSettingsField=null}}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.BaseViewModel=function(t,i,r,u,f,e){var o,s;n.FlexFieldDatabase.ObjectForm.FlexFieldHandlingViewModel.apply(this);this.rootPage=t;this.apiControllerName=i;this.lockName=r;this.templateLockName=u;this.kirjaApiMentionedMethod=f;this.kartaApiMarkedMethod=e;this.isTemplateMode=new ko.observable(!1);n.Util.getParameterFromUrl("template")&&this.isTemplateMode(!0);this.id=new ko.observable("");o=n.Util.getParameterFromUrl("id");o&&this.id(o);this.objectImageUploadUrl=new ko.computed(function(){return this.isTemplateMode()?"/api/"+this.apiControllerName+"/FlexFieldTemplateImageUpload?id="+this.id():"/api/"+this.apiControllerName+"/FlexFieldImageUpload?id="+this.id()},this);s=n.Util.getParameterFromUrl("templateId");this.templateId=s;this.parentFolderId=n.Util.getParameterFromUrl("folderId");this.isReadonly=new ko.observable(!1);this.lockedByUser=new ko.observable("");this.isLoading=new ko.observable(!1);this.isImplemented=new ko.observable(!1);this.compareDialog=new n.ImplementationStatus.CompareDialog.ViewModel;this.objectName=new ko.observable("");this.imageFilename=new ko.observable("");this.thumbnailImageFilename=new ko.observable("");this.objectTags=new ko.observableArray;this.existingObjectTags=new ko.observableArray;this.objectNameDisplay=new ko.computed(function(){var n=this.objectName();return n?" - "+n:""},this);this.showConfirmObjectDeleteDialog=new ko.observable(!1);this.showCustomizedExportTemplateWarningOnDelete=new ko.observable(!1);this.showConfirmRegenerateLanguageKeysDialog=new ko.observable(!1);this.showExportResultDialog=new ko.observable(!1);this.exportResultContent=new ko.observable("");this.exportResultErrors=new ko.observableArray;this.exportResultFormat="";this.exportShowSuccessfullyCopiedTooltip=new ko.observable(!1);this.referencedInQuests=new ko.observableArray;this.loadingReferencedInQuests=new ko.observable(!1);this.errorLoadingReferencedInQuests=new ko.observable(!1);this.mentionedInKirjaPages=new ko.observableArray;this.loadingMentionedInKirjaPages=new ko.observable(!1);this.errorLoadingMentionedInKirjaPages=new ko.observable(!1);this.markedInKartaMaps=new ko.observableArray;this.loadingMarkedInKartaMaps=new ko.observable(!1);this.errorLoadingMarkedInKartaMaps=new ko.observable(!1);this.referencedInTaleDialogs=new ko.observableArray;this.loadingReferencedInTaleDialogs=new ko.observable(!1);this.errorLoadingReferencedInTaleDialogs=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.additionalErrorDetails=new ko.observable("");this.objectNotFound=new ko.observable(!1);n.Util.setupValidation("#gn-objectFields");this.id()&&this.isTemplateMode()&&this.checkIfCustomizedExportTemplateExists()};t.BaseViewModel.prototype=jQuery.extend({},n.FlexFieldDatabase.ObjectForm.FlexFieldHandlingViewModel.prototype);t.BaseViewModel.prototype.loadAdditionalDependencies=function(){};t.BaseViewModel.prototype.parseAdditionalData=function(){};t.BaseViewModel.prototype.setAdditionalSaveData=function(n){return n};t.BaseViewModel.prototype.init=function(){this.id()?(this.loadObjectData(this.id(),this.isTemplateMode()),n.FlexFieldDatabase.ObjectForm.hasAikaRights&&!this.isTemplateMode()&&this.loadAikaQuests(),n.FlexFieldDatabase.ObjectForm.hasKirjaRights&&!this.isTemplateMode()&&this.loadKirjaPages(),n.FlexFieldDatabase.ObjectForm.hasKartaRights&&!this.isTemplateMode()&&this.loadKartaMaps(),n.FlexFieldDatabase.ObjectForm.hasTaleRights&&!this.isTemplateMode()&&this.loadTaleDialogs(),this.loadAdditionalDependencies(),this.acquireLock()):this.templateId&&this.loadObjectData(this.templateId,!0);this.loadExistingObjectTags()};t.BaseViewModel.prototype.checkIfCustomizedExportTemplateExists=function(){if(this.id()){var n=this;jQuery.ajax({url:"/api/ExportApi/DoesExportTemplateExistForObjectId?id="+this.id(),type:"GET"}).done(function(t){n.showCustomizedExportTemplateWarningOnDelete(t.doesTemplateExist)}).fail(function(){n.errorOccured(!0)})}};t.BaseViewModel.prototype.resetErrorState=function(){this.errorOccured(!1);this.additionalErrorDetails("");this.objectNotFound(!1)};t.BaseViewModel.prototype.loadExistingObjectTags=function(){var n=this;jQuery.ajax({url:"/api/"+this.apiControllerName+"/FlexFieldObjectTags",type:"GET"}).done(function(t){n.existingObjectTags(t)}).fail(function(){n.errorOccured(!0)})};t.BaseViewModel.prototype.loadObjectData=function(n,t){var r="/api/"+this.apiControllerName+"/FlexFieldObject",i;t&&(r="/api/"+this.apiControllerName+"/FlexFieldTemplate");r+="?id="+n;this.isLoading(!0);this.resetErrorState();i=this;jQuery.ajax({url:r,type:"GET"}).done(function(n){if(i.isLoading(!1),!n){i.errorOccured(!0);i.objectNotFound(!0);return}t||(i.templateId=i.isTemplateMode()?"":n.templateId,i.isImplemented(i.isTemplateMode()?!1:n.isImplemented));!t||i.isTemplateMode()?i.objectName(n.name):i.objectName("");i.parseAdditionalData(n);i.thumbnailImageFilename(n.thumbnailImageFile);i.imageFilename(n.imageFile);i.fieldManager.deserializeFields(n.fields);t&&!i.isTemplateMode()&&i.fieldManager.flagFieldsAsCreatedFromTemplate();i.objectTags(n.tags)}).fail(function(){i.isLoading(!1);i.errorOccured(!0)})};t.BaseViewModel.prototype.save=function(){this.sendSaveRequest(!1)};t.BaseViewModel.prototype.saveAndDistributeFields=function(){this.sendSaveRequest(!0)};t.BaseViewModel.prototype.sendSaveRequest=function(t){var f,r,u,i;jQuery("#gn-objectFields").valid()&&(f=this.fieldManager.serializeFields(),r={templateId:this.isTemplateMode()?"":this.templateId,name:this.objectName(),fields:f,tags:this.objectTags()},r=this.setAdditionalSaveData(r),this.isTemplateMode()||this.id()||(r.parentFolderId=this.parentFolderId,this.imageFilename()&&(r.imageFile=this.imageFilename()),this.thumbnailImageFilename()&&(r.thumbnailImageFile=this.thumbnailImageFilename())),u="",u=this.isTemplateMode()?this.id()?"/api/"+this.apiControllerName+"/UpdateFlexFieldTemplate?id="+this.id():"/api/"+this.apiControllerName+"/CreateFlexFieldTemplate":this.id()?"/api/"+this.apiControllerName+"/UpdateFlexFieldObject?id="+this.id():"/api/"+this.apiControllerName+"/CreateFlexFieldObject",this.isLoading(!0),this.resetErrorState(),i=this,jQuery.ajax({url:u,headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(r),type:"POST",contentType:"application/json"}).done(function(r){if(!i.id()){i.id(r.id);var u="id="+r.id;i.isTemplateMode()?n.Util.replaceUrlParameters("template=1&"+u):n.Util.replaceUrlParameters(u);i.acquireLock()}i.isTemplateMode()||(i.fieldManager.syncFieldIds(r),i.isImplemented(r.isImplemented));t?i.distributeFields():i.isLoading(!1);i.runAfterSave(r);i.callObjectGridRefresh()}).fail(function(){i.isLoading(!1);i.errorOccured(!0)}))};t.BaseViewModel.prototype.runAfterSave=function(){};t.BaseViewModel.prototype.distributeFields=function(){var t=this;jQuery.ajax({url:"/api/"+this.apiControllerName+"/DistributeFlexFieldTemplateFields?id="+this.id(),headers:n.Util.generateAntiForgeryHeader(),type:"POST",contentType:"application/json"}).done(function(){t.isLoading(!1)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})};t.BaseViewModel.prototype.openDeleteObjectDialog=function(){this.showConfirmObjectDeleteDialog(!0)};t.BaseViewModel.prototype.closeConfirmObjectDeleteDialog=function(){this.showConfirmObjectDeleteDialog(!1)};t.BaseViewModel.prototype.deleteObject=function(){var i="/api/"+this.apiControllerName+"/DeleteFlexFieldObject",t;this.isTemplateMode()&&(i="/api/"+this.apiControllerName+"/DeleteFlexFieldTemplate");i+="?id="+this.id();this.isLoading(!0);this.resetErrorState();t=this;jQuery.ajax({url:i,headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.callObjectGridRefresh();t.closeConfirmObjectDeleteDialog();window.location=t.rootPage}).fail(function(n){t.isLoading(!1);t.errorOccured(!0);t.closeConfirmObjectDeleteDialog();n.status==400&&n.responseText&&t.additionalErrorDetails(n.responseText)})};t.BaseViewModel.prototype.imageUploaded=function(n){this.imageFilename(n);this.callObjectGridRefresh()};t.BaseViewModel.prototype.imageUploadError=function(n,t){this.errorOccured(!0);t&&t.responseText?this.additionalErrorDetails(t.responseText):this.additionalErrorDetails(n)};t.BaseViewModel.prototype.openCompareDialogForObject=function(){var n=new jQuery.Deferred;return n.reject("Not implemented"),n.promise()};t.BaseViewModel.prototype.openCompareDialog=function(){var n=this;this.openCompareDialogForObject().done(function(){n.isImplemented(!0)})};t.BaseViewModel.prototype.openExportTemplate=function(n){if(this.id()){var t="/Export/ManageTemplate?templateType="+n+"&customizedObjectId="+this.id();this.isTemplateMode()&&(t+="&objectIsTemplate=1");window.location=t}};t.BaseViewModel.prototype.exportObject=function(n,t){this.exportResultFormat=t;this.isLoading(!0);this.errorOccured(!1);var i=this;jQuery.ajax({url:"/api/ExportApi/ExportObject?exportFormat="+t+"&id="+this.id()+"&templateType="+n,type:"GET"}).done(function(n){i.isLoading(!1);i.showExportResultDialog(!0);i.exportResultContent(n.code);i.exportResultErrors(n.errors)}).fail(function(){i.closeExportResultDialog();i.errorOccured(!0);i.isLoading(!1)})};t.BaseViewModel.prototype.closeExportResultDialog=function(){this.showExportResultDialog(!1);this.exportResultContent("");this.exportResultErrors([])};t.BaseViewModel.prototype.exportDownload=function(n){window.location="/api/ExportApi/ExportObjectDownload?exportFormat="+this.exportResultFormat+"&id="+this.id()+"&templateType="+n};t.BaseViewModel.prototype.copyExportCodeToClipboard=function(){var t=jQuery("#gn-flexFieldObjectExportResultTextarea")[0],n;t.select();document.execCommand("copy");this.exportShowSuccessfullyCopiedTooltip(!0);n=this;setTimeout(function(){n.exportShowSuccessfullyCopiedTooltip(!1)},1e3)};t.BaseViewModel.prototype.openConfirmRegenerateLanguageKeysDialog=function(){this.showConfirmRegenerateLanguageKeysDialog(!0)};t.BaseViewModel.prototype.regenerateLanguageKeys=function(){this.isLoading(!0);this.resetErrorState();var t=this;jQuery.ajax({url:"/api/ExportApi/DeleteLanguageKeysByGroupId?groupId="+this.id(),headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.isLoading(!1);t.closeConfirmRegenerateLanguageKeysDialog()}).fail(function(){t.isLoading(!1);t.errorOccured(!0);t.closeConfirmRegenerateLanguageKeysDialog()})};t.BaseViewModel.prototype.closeConfirmRegenerateLanguageKeysDialog=function(){this.showConfirmRegenerateLanguageKeysDialog(!1)};t.BaseViewModel.prototype.loadAikaQuests=function(){this.loadingReferencedInQuests(!0);this.errorLoadingReferencedInQuests(!1);var n=this;jQuery.ajax({url:"/api/AikaApi/GetQuestsObjectIsReferenced?objectId="+this.id(),type:"GET"}).done(function(t){n.referencedInQuests(t);n.loadingReferencedInQuests(!1)}).fail(function(){n.errorLoadingReferencedInQuests(!0);n.loadingReferencedInQuests(!1)})};t.BaseViewModel.prototype.buildAikaQuestUrl=function(n){return"/Aika/Quest?id="+n.id};t.BaseViewModel.prototype.loadKirjaPages=function(){this.loadingMentionedInKirjaPages(!0);this.errorLoadingMentionedInKirjaPages(!1);var n=this;jQuery.ajax({url:"/api/KirjaApi/"+this.kirjaApiMentionedMethod+this.id(),type:"GET"}).done(function(t){n.mentionedInKirjaPages(t);n.loadingMentionedInKirjaPages(!1)}).fail(function(){n.errorLoadingMentionedInKirjaPages(!0);n.loadingMentionedInKirjaPages(!1)})};t.BaseViewModel.prototype.buildKirjaPageUrl=function(n){return"/Kirja?id="+n.id};t.BaseViewModel.prototype.loadKartaMaps=function(){if(this.kartaApiMarkedMethod){this.loadingMarkedInKartaMaps(!0);this.errorLoadingMarkedInKartaMaps(!1);var n=this;jQuery.ajax({url:"/api/KartaApi/"+this.kartaApiMarkedMethod+this.id(),type:"GET"}).done(function(t){for(var i=0;i<t.length;++i)t[i].tooltip=n.buildKartaMapMarkerCountTooltip(t[i]);n.markedInKartaMaps(t);n.loadingMarkedInKartaMaps(!1)}).fail(function(){n.errorLoadingMarkedInKartaMaps(!0);n.loadingMarkedInKartaMaps(!1)})}};t.BaseViewModel.prototype.buildKartaMapMarkerCountTooltip=function(t){return n.FlexFieldDatabase.ObjectForm.Localization.MarkedInMapNTimes.replace("{0}",t.markerIds.length)};t.BaseViewModel.prototype.buildKartaMapUrl=function(n){var t="/Karta?id="+n.mapId;return n.markerIds.length==1&&(t+="&zoomOnMarkerId="+n.markerIds[0]+"&zoomOnMarkerType="+n.mapMarkerType),t};t.BaseViewModel.prototype.loadTaleDialogs=function(){this.loadingReferencedInTaleDialogs(!0);this.errorLoadingReferencedInTaleDialogs(!1);var t=this;jQuery.ajax({url:"/api/TaleApi/GetDialogsObjectIsReferenced?objectId="+this.id(),type:"GET"}).done(function(i){for(var u=[],r=0;r<i.length;++r)i[r].relatedObjectId!=t.id()&&u.push(i[r].relatedObjectId);if(u.length==0){t.referencedInTaleDialogs([]);t.loadingReferencedInTaleDialogs(!1);return}jQuery.ajax({url:"/api/KortistoApi/ResolveFlexFieldObjectNames",headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(u),type:"POST",contentType:"application/json"}).done(function(n){t.referencedInTaleDialogs(n);t.loadingReferencedInTaleDialogs(!1)}).fail(function(){t.errorLoadingReferencedInTaleDialogs(!0);t.loadingReferencedInTaleDialogs(!1)})}).fail(function(){t.errorLoadingReferencedInTaleDialogs(!0);t.loadingReferencedInTaleDialogs(!1)})};t.BaseViewModel.prototype.buildTaleDialogUrl=function(n){return"/Tale?npcId="+n.id};t.BaseViewModel.prototype.acquireLock=function(){var i=this.lockName,t;this.isTemplateMode()&&(i=this.templateLockName);t=this;n.LockService.acquireLock(i,this.id()).done(function(n,i){n&&(t.isReadonly(!0),t.lockedByUser(i),t.setAdditionalDataToReadonly())}).fail(function(){t.errorOccured(!0);t.isReadonly(!0)})};t.BaseViewModel.prototype.setAdditionalDataToReadonly=function(){};t.BaseViewModel.prototype.callObjectGridRefresh=function(){window.refreshFlexFieldObjectGrid&&window.refreshFlexFieldObjectGrid()}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){n.FlexFieldDatabase.ObjectForm.BaseViewModel.apply(this,["/Kortisto","KortistoApi","KortistoNpc","KortistoTemplate","GetPagesByNpc?npcId=","GetMapsByNpcId?npcId="]);this.showConfirmRemoveDialog=new ko.observable(!1);this.isRemovingItem=new ko.observable(!1);this.objectDialog=new n.ChooseObjectDialog.ViewModel;this.inventoryItems=new ko.observableArray;this.itemToRemove=null;this.isLoadingInventory=new ko.observable(!1);this.loadingInventoryError=new ko.observable(!1);this.learnedSkills=new ko.observableArray;this.skillToRemove=null;this.isLoadingSkills=new ko.observable(!1);this.loadingSkillsError=new ko.observable(!1);this.isPlayerNpc=new ko.observable(!1);this.showMarkAsPlayerDialog=new ko.observable(!1);this.nameGenTemplate=new ko.observable("ss");this.nameGenDialogTemplate=new ko.observable("");this.showNameGenSettingsDialog=new ko.observable(!1);this.nameGenSample=new ko.observable("");this.nameGenTemplateError=new ko.observable(!1);this.nameGenTemplateErrorDescription=new ko.observable("");var t=this;this.nameGenDialogTemplate.subscribe(function(){t.generateSampleNameGenName()});this.dialogExists=new ko.observable(!1);this.dialogImplemented=new ko.observable(!1);this.init();n.FlexFieldDatabase.ObjectForm.hasImplementationStatusTrackerRights&&n.FlexFieldDatabase.ObjectForm.hasTaleRights&&this.id()&&this.loadDialogImplementationState()};t.ViewModel.prototype=jQuery.extend({},n.FlexFieldDatabase.ObjectForm.BaseViewModel.prototype);t.ViewModel.prototype.parseAdditionalData=function(n){this.isTemplateMode()||this.isPlayerNpc(n.isPlayerNpc);this.nameGenTemplate(n.nameGenTemplate?n.nameGenTemplate:"");t.hasStyrRights&&n.inventory&&n.inventory.length>0&&this.loadInventory(n.inventory);t.hasEvneRights&&n.skills&&n.skills.length>0&&this.loadSkills(n.skills)};t.ViewModel.prototype.openCompareDialogForObject=function(){return this.compareDialog.openNpcCompare(this.id(),this.objectName())};t.ViewModel.prototype.loadDialogImplementationState=function(){var n=this;jQuery.ajax({url:"/api/TaleApi/IsDialogImplementedByRelatedObjectId?relatedObjectId="+this.id(),type:"GET"}).done(function(t){n.dialogExists(t.exists);n.dialogImplemented(t.isImplemented)}).fail(function(){n.errorOccured(!0)})};t.ViewModel.prototype.loadInventory=function(t){for(var i,f=[],u={},r=0;r<t.length;++r)f.push(t[r].itemId),u[t[r].itemId]=t[r];this.isLoadingInventory(!0);this.loadingInventoryError(!1);i=this;jQuery.ajax({url:"/api/StyrApi/ResolveFlexFieldObjectNames",headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(f),type:"POST",contentType:"application/json"}).done(function(n){for(var r=[],t=0;t<n.length;++t)r.push({id:n[t].id,name:n[t].name,quantity:new ko.observable(u[n[t].id].quantity),isEquipped:new ko.observable(u[n[t].id].isEquipped)});i.inventoryItems(r);i.isLoadingInventory(!1)}).fail(function(){i.inventoryItems([]);i.isLoadingInventory(!1);i.loadingInventoryError(!0)})};t.ViewModel.prototype.loadSkills=function(t){for(var i,u=[],r=0;r<t.length;++r)u.push(t[r].skillId);this.isLoadingSkills(!0);this.loadingSkillsError(!1);i=this;jQuery.ajax({url:"/api/EvneApi/ResolveFlexFieldObjectNames",headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(u),type:"POST",contentType:"application/json"}).done(function(n){for(var r=[],t=0;t<n.length;++t)r.push({id:n[t].id,name:n[t].name});i.learnedSkills(r);i.isLoadingSkills(!1)}).fail(function(){i.learnedSkills([]);i.isLoadingSkills(!1);i.loadingSkillsError(!0)})};t.ViewModel.prototype.setAdditionalSaveData=function(n){return n.isPlayerNpc=this.isPlayerNpc(),n.nameGenTemplate=this.nameGenTemplate(),n.inventory=this.serializeInventory(),n.skills=this.serializeSkills(),n};t.ViewModel.prototype.serializeInventory=function(){for(var i,u,r=[],t=this.inventoryItems(),n=0;n<t.length;++n)i=parseInt(t[n].quantity()),isNaN(i)&&(i=1),u={itemId:t[n].id,quantity:i,isEquipped:t[n].isEquipped()},r.push(u);return r};t.ViewModel.prototype.serializeSkills=function(){for(var r,t=[],i=this.learnedSkills(),n=0;n<i.length;++n)r={skillId:i[n].id},t.push(r);return t};t.ViewModel.prototype.doesObjectExistInFlexFieldArray=function(n,t){for(var r=n(),i=0;i<r.length;++i)if(r[i].id==t.id)return!0;return!1};t.ViewModel.prototype.addItemToInventory=function(){var n=this;this.objectDialog.openItemSearch(t.Localization.AddItemToInventory).then(function(t){n.doesObjectExistInFlexFieldArray(n.inventoryItems,t)||(n.inventoryItems.push({id:t.id,name:t.name,quantity:new ko.observable(1),isEquipped:new ko.observable(!1)}),n.inventoryItems.sort(function(n,t){return n.name.localeCompare(t.name)}))})};t.ViewModel.prototype.addSkill=function(){var n=this;this.objectDialog.openSkillSearch(t.Localization.AddSkill).then(function(t){n.doesObjectExistInFlexFieldArray(n.learnedSkills,t)||(n.learnedSkills.push({id:t.id,name:t.name}),n.learnedSkills.sort(function(n,t){return n.name.localeCompare(t.name)}))})};t.ViewModel.prototype.buildItemUrl=function(n){return"/Styr/Item?id="+n.id};t.ViewModel.prototype.buildSkillUrl=function(n){return"/Evne/Skill?id="+n.id};t.ViewModel.prototype.openRemoveItemDialog=function(n){this.itemToRemove=n;this.skillToRemove=null;this.isRemovingItem(!0);this.showConfirmRemoveDialog(!0)};t.ViewModel.prototype.openRemoveSkillDialog=function(n){this.skillToRemove=n;this.itemToRemove=null;this.isRemovingItem(!1);this.showConfirmRemoveDialog(!0)};t.ViewModel.prototype.removeObject=function(){this.itemToRemove&&this.inventoryItems.remove(this.itemToRemove);this.skillToRemove&&this.learnedSkills.remove(this.skillToRemove);this.closeConfirmRemoveDialog()};t.ViewModel.prototype.closeConfirmRemoveDialog=function(){this.itemToRemove=null;this.skillToRemove=null;this.showConfirmRemoveDialog(!1)};t.ViewModel.prototype.openTale=function(){this.id()&&(window.location="/Tale?npcId="+this.id())};t.ViewModel.prototype.openMarkAsPlayerDialog=function(){this.showMarkAsPlayerDialog(!0)};t.ViewModel.prototype.closeMarkAsPlayerDialog=function(){this.showMarkAsPlayerDialog(!1)};t.ViewModel.prototype.markAsPlayer=function(){this.isPlayerNpc(!0);this.closeMarkAsPlayerDialog();this.save()};t.ViewModel.prototype.openNameGenSettings=function(){this.showNameGenSettingsDialog(!0);this.nameGenTemplateError(!1);this.nameGenTemplateErrorDescription("");this.nameGenDialogTemplate(this.nameGenTemplate())};t.ViewModel.prototype.saveNameGenSettings=function(){this.nameGenTemplateError()||(this.nameGenTemplate(this.nameGenDialogTemplate()),this.closeNameGenDialog())};t.ViewModel.prototype.generateSampleNameGenName=function(){if(this.nameGenTemplateError(!1),this.nameGenTemplateErrorDescription(""),!this.nameGenDialogTemplate()){this.nameGenSample("");return}try{this.nameGenSample(this.createRandomName(this.nameGenDialogTemplate()))}catch(t){this.nameGenSample("");this.nameGenTemplateError(!0);switch(t.message){case"MISSING_CLOSING_BRACKET":this.nameGenTemplateErrorDescription(n.Kortisto.Npc.Localization.NameGenMissingClosingBracket);break;case"UNBALANCED_BRACKETS":this.nameGenTemplateErrorDescription(n.Kortisto.Npc.Localization.NameGenUnbalancedBrackets);break;case"UNEXPECTED_<_IN_INPUT":this.nameGenTemplateErrorDescription(n.Kortisto.Npc.Localization.NameGenUnexpectedPointyBracketInInput);break;case"UNEXPECTED_)_IN_INPUT":this.nameGenTemplateErrorDescription(n.Kortisto.Npc.Localization.NameGenUnexpectedRoundBracketInInput);break;default:this.nameGenTemplateErrorDescription(n.Kortisto.Npc.Localization.NameGenUnknownError)}}};t.ViewModel.prototype.closeNameGenDialog=function(){this.showNameGenSettingsDialog(!1)};t.ViewModel.prototype.generateName=function(){this.objectName(this.createRandomName(this.nameGenTemplate()))};t.ViewModel.prototype.createRandomName=function(n){var i=NameGen.compile(n),t=i.toString();return t&&t.length>0&&(t=t.charAt(0).toUpperCase()+t.slice(1)),t}})(t.Npc=t.Npc||{})})(n.Kortisto=n.Kortisto||{})}(window.GoNorth=window.GoNorth||{});