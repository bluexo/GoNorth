(function(n){"use strict";(function(n){(function(n){n.createDefaultLink=function(n){var t={attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"},".link-tools .tool-remove circle, .marker-vertex":{r:8}}},i;return n&&(t=jQuery.extend(n,t)),i=new joint.dia.Link(t),i.set("smooth",!0),i}})(n.Connections=n.Connections||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})})(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(){joint.shapes.default=joint.shapes.default||{};joint.shapes.default.Base=joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:"default.Base",size:{width:200,height:64},nodeText:"",attrs:{rect:{stroke:"none","fill-opacity":0},text:{display:"none"}}},joint.shapes.devs.Model.prototype.defaults)});joint.shapes.default.BaseView=joint.shapes.devs.ModelView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<button class="delete" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>',"<\/div>",].join(""),initialize:function(){_.bindAll(this,"updateBox");joint.shapes.devs.ModelView.prototype.initialize.apply(this,arguments);this.$box=jQuery(_.template(this.template)());this.$box.find("input").on("mousedown click",function(n){n.stopPropagation()});this.$box.find(".nodeText").on("change",_.bind(function(n){this.model.set("nodeText",jQuery(n.target).val())},this));this.$box.find(".delete").on("click",_.bind(function(){if(this.model.onDelete){var n=this;this.model.onDelete(this).done(function(){n.model.remove()})}else this.model.remove()},this));if(this.additionalCallbackButtons){var t=this.additionalCallbackButtons,n=this;jQuery.each(t,function(i){n.$box.find("."+i).on("click",_.bind(function(){t[i].apply(n)},n))})}this.model.on("change",this.updateBox,this);this.model.on("remove",this.removeBox,this);this.updateBox()},render:function(){return joint.shapes.devs.ModelView.prototype.render.apply(this,arguments),this.listenTo(this.paper,"scale",this.updateBox),this.listenTo(this.paper,"translate",this.updateBox),this.paper.$el.prepend(this.$box),this.updateBox(),this},updateBox:function(){var n=this.model.getBBox(),i,u,r;this.paper&&(n.x=n.x*this.paper.scale().sx+this.paper.translate().tx,n.y=n.y*this.paper.scale().sy+this.paper.translate().ty,n.width*=this.paper.scale().sx,n.height*=this.paper.scale().sy);i=this.$box.find(".nodeText");i.is(":focus")||i.val(this.model.get("nodeText"));u=this.$box.find(".labelText");r=this.model.get("type");u.text(t.Localization.TypeNames[r]);this.$box.find(".label").attr("class","label "+r.replace(".","_"));this.model.get("icon")?this.$box.find(".nodeIcon").addClass(this.model.get("icon")):this.$box.find(".nodeIcon").remove();this.$box.css({width:n.width,height:n.height,left:n.x,top:n.y,transform:"rotate("+(this.model.get("angle")||0)+"deg)"})},removeBox:function(){this.$box.remove()},validateDelete:function(){return null}})})(t.Shapes=t.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(){joint.shapes.default.Text=joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:"default.Text",inPorts:["input"],outPorts:["output"],attrs:{".outPorts circle":{unlimitedConnections:["default.Choice"]}}},joint.shapes.default.Base.prototype.defaults)});joint.shapes.default.TextView=joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><\/span>','<button class="delete" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<input type="text" class="name" placeholder="'+t.Localization.TextPlaceHolder+'" />',"<\/div>",].join("")})})(t.Shapes=t.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.BaseNodeSerializer=function(n,t,i){this.classType=n;this.type=t;this.serializeArrayName=i};n.BaseNodeSerializer.prototype={serialize:function(){},deserialize:function(){},createNewNode:function(n){return new this.classType(n)}}})(n.Serialize=n.Serialize||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){var i="link",r=function(){this.nodeSerializer={};this.nodeDeserializer={}},u;r.prototype={addNodeSerializer:function(n){this.nodeSerializer[n.type]=n;this.nodeDeserializer[n.serializeArrayName]=n},hasDeserializerForArray:function(n){return n==i?!0:!!this.nodeDeserializer[n]},serializeGraph:function(n){var f=n.toJSON(),t={},r,u,e;for(t[i]=[],r=0;r<f.cells.length;++r)if(u=f.cells[r].type,u==i)t[i].push(this.serializeLink(f.cells[r]));else{if(!this.nodeSerializer[u])throw{error:"Unknown node type: "+u};e=this.nodeSerializer[u].serializeArrayName;t[e]||(t[e]=[]);t[e].push(this.nodeSerializer[u].serialize(f.cells[r]))}return t},deserializeGraph:function(n,t,r){var u,f,e,h,o,s,c;n.clear();for(u in t)if(this.nodeDeserializer[u]&&(f=t[u],f))for(e=0;e<f.length;++e)h=this.nodeDeserializer[u].deserialize(f[e]),n.addCell(h),typeof r=="function"&&r(h);if(o=t[i],o)for(s=0;s<o.length;++s)c=this.deserializeLink(o[s]),n.addCell(c)},serializeLink:function(n){return{sourceNodeId:n.source.id,sourceNodePort:n.source.port,targetNodeId:n.target.id,targetNodePort:n.target.port,vertices:n.vertices}},deserializeLink:function(t){return n.Connections.createDefaultLink({source:{id:t.sourceNodeId,port:t.sourceNodePort},target:{id:t.targetNodeId,port:t.targetNodePort},vertices:t.vertices})},createNewNode:function(n,t){return this.nodeSerializer[n]?this.nodeSerializer[n].createNewNode(t):null}};u=new r;t.getNodeSerializerInstance=function(){return u}})(n.Serialize=n.Serialize||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(){var e,f,t,i;if(typeof ko!="undefined"){e=.1;f=.1;function o(n){var t=n[0].screenX-n[1].screenX,i=n[0].screenY-n[1].screenY;return Math.sqrt(t*t+i*i)}function r(n){return Math.round(n*10)/10}function u(t,i){var f=i.scale().sx,u=n.DefaultNodeShapes.Localization.NodeDisplay.Position+" "+r(-i.translate().tx)+","+r(-i.translate().ty)+" ";u+=n.DefaultNodeShapes.Localization.NodeDisplay.Zoom+" "+r(f);jQuery(t).find(".gn-nodeGraphPositionZoomIndicatorText").text(u)}function s(n){var i="nodeX="+r(n.translate().tx),t;i+="&nodeY="+r(n.translate().ty);i+="&nodeZoom="+r(n.scale().sx);t=window.location.search;t?(t=t.replace(/nodeX=.*?&nodeY=.*?&nodeZoom=.*?(&|$)/i,""),t[t.length-1]!="&"&&(t+="&"),t+=i):t="?"+i;window.history.replaceState(t,null,t)}function h(n,t,i){var c,s,h,u,e,l;if(i&&(c=jQuery(n).children(".gn-nodeGraphMiniMap"),s=jQuery(n).children("svg"),s.length!=0)){var r=t.getContentBBox(),f=t.scale().sx,o=t.translate();r.x/=f;r.y/=f;r.width/=f;r.height/=f;r.x-=o.tx/f;r.y-=o.ty/f;r.right=r.x+r.width;r.bottom=r.y+r.height;h=jQuery(n).parent();u={x:-o.tx/f,y:-o.ty/f,width:h.width()/f,height:h.height()/f};u.x<r.x&&(r.x=u.x);u.x+u.width>r.right&&(r.right=u.x+u.width);u.y<r.y&&(r.y=u.y);u.y+u.height>r.bottom&&(r.bottom=u.y+u.height);r.width=r.right-r.x;r.height=r.bottom-r.y;e=jQuery(s[0].outerHTML);e.attr("viewBox",r.x+" "+r.y+" "+r.width+" "+r.height);e.children(".joint-viewport").removeAttr("transform");e.find("rect").attr("fill-opacity","1");e.find("rect").attr("fill","#666");e.find("path").attr("fill","none");e.find(".tool-options").remove();e.find(".tool-remove").remove();l=r.width/400;e.children(".joint-viewport").append("<rect width='"+u.width+"' height='"+u.height+"' transform='translate("+u.x+","+u.y+")' fill='none' stroke='#fff' style='stroke-width: "+l+"'><\/rect>");c.html(e[0].outerHTML)}}t=n.Util.throttle(h,35);i=n.Util.debounce(s,250);ko.bindingHandlers.nodeGraph={init:function(r,s,h){var nt=!1,v,c,l,k,y,a,p;h.get("nodeGraphAllowMultpleOutbound")&&(nt=h.get("nodeGraphAllowMultpleOutbound"));v=new joint.dia.Graph;c=new joint.dia.Paper({el:r,width:16e3,height:8e3,gridSize:1,model:v,defaultLink:n.DefaultNodeShapes.Connections.createDefaultLink(),snapLinks:{radius:75},markAvailable:!0,linkPinning:!1,validateConnection:function(n,t,i,r){return n===i?!1:r.getAttribute("port-type")==="input"},validateMagnet:function(n,t){var u,r,i;if(nt)return t.getAttribute("magnet")!=="passive";for(u=t.getAttribute("port"),r=v.getConnectedLinks(n.model,{outbound:!0}),i=r.length-1;i>=0;--i)r[i].attributes&&r[i].attributes.source&&r[i].attributes.source.port===u&&r[i].remove();return t.getAttribute("magnet")!=="passive"}});n.BindingHandlers.nodeGraphRefreshPositionZoomUrl=function(){i(c)};l=!1;v.on("change",function(){t(r,c,l)});v.on("add",function(){t(r,c,l)});v.on("remove",function(){t(r,c,l)});jQuery(window).resize(function(){t(r,c,l)});k=s();ko.isObservable(k)&&k(v);y=h.get("nodePaper");y&&ko.isObservable(y)&&y(c);jQuery(r).on("mousewheel DOMMouseScroll",function(n){var s=1,h,o;(n.originalEvent.wheelDelta<0||n.originalEvent.detail>0)&&(s=-1);h=c.scale().sx;o=h+s*e;o>=f&&(c.scale(o,o),u(r,c),i(c),t(r,c,l));n.preventDefault()});a=null;p=!1;c.on("blank:pointerdown",function(n,t,i){jQuery(r).addClass("gn-nodeGraph-dragging");p||(a={x:t*c.scale().sx,y:i*c.scale().sy})});c.on("cell:pointerup blank:pointerup",function(){jQuery(r).removeClass("gn-nodeGraph-dragging");a=null});jQuery(r).on("mousemove",function(n){a&&(c.translate(n.offsetX-a.x,n.offsetY-a.y),u(r,c),i(c),t(r,c,l))});var w=null,b=null,d=null;jQuery(r).find("svg").on("touchstart",function(n){jQuery(n.target).attr("id")==jQuery(r).find("svg").attr("id")&&(n.originalEvent.touches&&n.originalEvent.touches.length==1?(a={x:n.originalEvent.touches[0].screenX,y:n.originalEvent.touches[0].screenY},w={x:c.translate().tx,y:c.translate().ty},p=!0,setTimeout(function(){p=!1},10)):n.originalEvent.touches&&n.originalEvent.touches.length==2&&(b=o(n.originalEvent.touches),d=c.scale().sx))});jQuery(r).on("touchmove",function(n){if(a&&n.originalEvent.touches&&n.originalEvent.touches.length==1)c.translate(n.originalEvent.touches[0].screenX-a.x+w.x,n.originalEvent.touches[0].screenY-a.y+w.y),u(r,c),i(c),t(r,c,l);else if(b&&n.originalEvent.touches&&n.originalEvent.touches.length==2){var s=o(n.originalEvent.touches),e=d*(s/b);e>=f&&(c.scale(e,e),u(r,c),i(c),t(r,c,l))}});jQuery(r).on("touchend touchcancel",function(){a=null;w=null;b=null;d=null});var tt=parseFloat(n.Util.getParameterFromUrl("nodeX")),it=parseFloat(n.Util.getParameterFromUrl("nodeY")),g=parseFloat(n.Util.getParameterFromUrl("nodeZoom"));isNaN(tt)||isNaN(it)||c.translate(tt,it);isNaN(g)||c.scale(g,g);jQuery(r).addClass("gn-nodeGraph");jQuery(r).append("<div class='gn-nodeGraphPositionZoomIndicator'><span class='gn-nodeGraphPositionZoomIndicatorText'><\/span><span><a class='gn-clickable gn-nodeGraphToogleMinimap' title='"+n.DefaultNodeShapes.Localization.NodeDisplay.ToogleMiniMap+"'><i class='glyphicon glyphicon-chevron-down'><\/i><\/a><\/span><\/div>");jQuery(r).append("<div class='gn-nodeGraphMiniMap' style='display: none'><\/div>");jQuery(r).find(".gn-nodeGraphToogleMinimap").click(function(){l=!l;l?(jQuery(r).find(".gn-nodeGraphMiniMap").slideDown(200),jQuery(this).children("i").removeClass("glyphicon-chevron-down"),jQuery(this).children("i").addClass("glyphicon-chevron-up"),t(r,c,l)):(jQuery(r).find(".gn-nodeGraphMiniMap").slideUp(200),jQuery(this).children("i").removeClass("glyphicon-chevron-up"),jQuery(this).children("i").addClass("glyphicon-chevron-down"))});u(r,c);i(c)},update:function(){}}}})(n.BindingHandlers=n.BindingHandlers||{})}(window.GoNorth=window.GoNorth||{});