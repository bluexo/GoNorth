(function(n){"use strict";(function(t){(function(t){var i=50;t.ViewModel=function(){var i=0,r=parseInt(n.Util.getParameterFromUrl("page")),t;isNaN(r)||(i=r);t=n.Util.getParameterFromUrl("searchTerm");t||(t="");this.searchPattern=new ko.observable(t);this.searchPatternToUse=t;this.pages=new ko.observableArray;this.hasMore=new ko.observable(!1);this.currentPage=new ko.observable(i);this.isLoading=new ko.observable(!1);this.prevLoading=new ko.observable(!1);this.nextLoading=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.nextLoading(!0);this.searchPages()};t.ViewModel.prototype={startNewSearch:function(){this.searchPatternToUse=this.searchPattern();this.currentPage(0);this.hasMore(!1);this.searchPages()},searchPages:function(){var r,t;this.errorOccured(!1);this.isLoading(!0);r="page="+this.currentPage();this.searchPatternToUse&&(r+="&searchTerm="+encodeURIComponent(this.searchPatternToUse));n.Util.replaceUrlParameters(r);t=this;jQuery.ajax({url:"/api/KirjaApi/SearchPages?searchPattern="+encodeURIComponent(this.searchPatternToUse)+"&start="+this.currentPage()*i+"&pageSize="+i,type:"GET"}).done(function(n){t.pages(n.pages);t.hasMore(n.hasMore);t.resetLoadingState()}).fail(function(){t.errorOccured(!0);t.resetLoadingState()})},resetLoadingState:function(){this.isLoading(!1);this.prevLoading(!1);this.nextLoading(!1)},prevPage:function(){this.currentPage(this.currentPage()-1);this.prevLoading(!0);this.searchPages()},nextPage:function(){this.currentPage(this.currentPage()+1);this.nextLoading(!0);this.searchPages()},openCreatePage:function(){window.location="/Kirja?newPage=1"},buildPageUrl:function(n){return"/Kirja?id="+n.id}}})(t.AllPages=t.AllPages||{})})(n.Kirja=n.Kirja||{})})(window.GoNorth=window.GoNorth||{});