(function(n){"use strict";(function(t){var i=50;t.ViewModel=function(){var n=this.loadPagingData();this.dayEntries=new ko.observableArray;this.startIndices=new ko.observableArray(n);this.hasMore=new ko.observable(!1);this.isLoading=new ko.observable(!1);this.prevLoading=new ko.observable(!1);this.nextLoading=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.nextPage()};t.ViewModel.prototype={loadPage:function(n,t){var r=this;this.errorOccured(!1);this.isLoading(!0);jQuery.ajax("/api/TimelineApi/Entries?start="+n+"&pageSize="+i).done(function(n){r.dayEntries(r.parseDayEntries(n.entries));r.hasMore(n.hasMore);t&&(r.startIndices.push(n.continueStart),r.savePagingData());r.isLoading(!1);r.prevLoading(!1);r.nextLoading(!1)}).fail(function(){r.errorOccured(!0);r.isLoading(!1)})},firstPage:function(){this.prevLoading(!0);this.startIndices([0]);this.savePagingData();this.loadPage(0,!0)},prevPage:function(){this.prevLoading(!0);this.startIndices.pop();this.savePagingData();this.loadPage(this.startIndices()[this.startIndices().length-2],!1)},nextPage:function(){this.nextLoading(!0);this.loadPage(this.startIndices()[this.startIndices().length-1],!0)},parseDayEntries:function(n){var r=[],t=null,i=null;return jQuery.each(n,function(n,u){var f=new Date(u.timestamp);t&&t.getFullYear()==f.getFullYear()&&t.getMonth()==f.getMonth()&&t.getDate()==f.getDate()||(i={timestamp:moment(f).format("L"),entries:[]},r.push(i),t=f);i.entries.push({timestamp:moment(f).format("LT"),userName:u.userDisplayName,content:u.content})}),r},savePagingData:function(){var t=this.startIndices(),i;t.length>1&&(t=t.slice(0,t.length-1));i="pagingData="+encodeURIComponent(JSON.stringify(t));n.Util.replaceUrlParameters(i)},loadPagingData:function(){var t=[0],i=n.Util.getParameterFromUrl("pagingData");if(i)try{t=JSON.parse(i)}catch(r){}return t}}})(n.Timeline=n.Timeline||{})})(window.GoNorth=window.GoNorth||{});