(function(n){"use strict";(function(n){var t=15;n.ViewModel=function(){this.showDialog=new ko.observable(!1);this.dialogTitle=new ko.observable("");this.showNewButtonInDialog=new ko.observable(!1);this.dialogSearchCallback=null;this.dialogCreateNewCallback=null;this.dialogSearchPattern=new ko.observable("");this.dialogIsLoading=new ko.observable(!1);this.dialogEntries=new ko.observableArray;this.dialogHasMore=new ko.observable(!1);this.dialogCurrentPage=new ko.observable(0);this.errorOccured=new ko.observable(!1);this.idObservable=null;this.choosingDeferred=null};n.ViewModel.prototype={openNpcSearch:function(n,t){return this.openDialog(n,this.searchNpcs,t,null)},openItemSearch:function(n,t){return this.openDialog(n,this.searchItems,t,null)},openSkillSearch:function(n,t){return this.openDialog(n,this.searchSkills,t,null)},openKirjaPageSearch:function(n,t,i){return this.openDialog(n,this.searchPages,t,i)},openQuestSearch:function(n,t){return this.openDialog(n,this.searchQuest,t,null)},openChapterDetailSearch:function(n,t,i){return this.openDialog(n,this.searchChapterDetails,t,i)},openDialog:function(n,t,i,r){return this.choosingDeferred&&(this.choosingDeferred.reject(),this.choosingDeferred=null),this.showDialog(!0),this.dialogTitle(n),this.dialogCreateNewCallback=typeof i=="function"?i:null,this.showNewButtonInDialog(this.dialogCreateNewCallback?!0:!1),this.dialogSearchCallback=t,this.dialogSearchPattern(""),this.dialogIsLoading(!1),this.dialogEntries([]),this.dialogHasMore(!1),this.dialogCurrentPage(0),this.idObservable=r,this.choosingDeferred=new jQuery.Deferred,this.choosingDeferred.promise()},selectObject:function(n){this.choosingDeferred&&(this.choosingDeferred.resolve(n),this.choosingDeferred=null);this.closeDialog()},cancelDialog:function(){this.choosingDeferred&&(this.choosingDeferred.reject(),this.choosingDeferred=null);this.closeDialog()},closeDialog:function(){this.showDialog(!1)},startNewDialogSearch:function(){this.dialogCurrentPage(0);this.dialogHasMore(!1);this.runDialogSearch()},prevDialogPage:function(){this.dialogCurrentPage(this.dialogCurrentPage()-1);this.runDialogSearch()},nextDialogPage:function(){this.dialogCurrentPage(this.dialogCurrentPage()+1);this.runDialogSearch()},runDialogSearch:function(){this.dialogIsLoading(!0);this.errorOccured(!1);var n=this;this.dialogSearchCallback(this.dialogSearchPattern()).done(function(t){n.dialogHasMore(t.hasMore);n.dialogEntries(t.entries);n.dialogIsLoading(!1)}).fail(function(){n.errorOccured(!0);n.dialogIsLoading(!1)})},createDialogObject:function(n,t,i){return{id:n,name:t,openLink:i}},searchPages:function(n){var i=new jQuery.Deferred,r="/api/KirjaApi/SearchPages?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,u;return this.idObservable&&(r+="&excludeId="+this.idObservable()),u=this,jQuery.ajax({url:r,type:"GET"}).done(function(n){for(var r={hasMore:n.hasMore,entries:[]},t=0;t<n.pages.length;++t)r.entries.push(u.createDialogObject(n.pages[t].id,n.pages[t].name,"/Kirja?id="+n.pages[t].id));i.resolve(r)}).fail(function(){i.reject()}),i.promise()},openCreatePage:function(){this.dialogCreateNewCallback()},searchNpcs:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/KortistoApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Kortisto/Npc?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchItems:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/StyrApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Styr/Item?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchSkills:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/EvneApi/SearchFlexFieldObjects?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.flexFieldObjects.length;++t)u.entries.push(r.createDialogObject(n.flexFieldObjects[t].id,n.flexFieldObjects[t].name,"/Evne/Skill?id="+n.flexFieldObjects[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchQuest:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/AikaApi/GetQuests?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.quests.length;++t)u.entries.push(r.createDialogObject(n.quests[t].id,n.quests[t].name,"/Aika/Quest?id="+n.quests[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()},searchChapterDetails:function(n){var i=new jQuery.Deferred,r=this;return jQuery.ajax({url:"/api/AikaApi/GetChapterDetails?searchPattern="+encodeURIComponent(n)+"&start="+this.dialogCurrentPage()*t+"&pageSize="+t,type:"GET"}).done(function(n){for(var u={hasMore:n.hasMore,entries:[]},t=0;t<n.details.length;++t)r.idObservable&&r.idObservable()==n.details[t].id||u.entries.push(r.createDialogObject(n.details[t].id,n.details[t].name,"/Aika/Detail?id="+n.details[t].id));i.resolve(u)}).fail(function(){i.reject()}),i.promise()}}})(n.ChooseObjectDialog=n.ChooseObjectDialog||{})})(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){t.getFilteredFieldsForScript=function(t){var r,i,f,u,e;if(!t)return[];for(r=[],i=0;i<t.length;++i)if(t[i].fieldType!=n.FlexFieldDatabase.ObjectForm.FlexFieldTypeMultiLine&&(!t[i].scriptSettings||!t[i].scriptSettings.dontExportToScript)&&(r.push(t[i]),t[i].scriptSettings&&t[i].scriptSettings.additionalScriptNames))for(f=t[i].scriptSettings.additionalScriptNames.split(n.FlexFieldDatabase.ObjectForm.FlexFieldScriptSettingsAdditionalScriptNameSeperator),u=0;u<f.length;++u)e=jQuery.extend({},t[i]),e.name=f[u],r.push(e);return r}})(n.Util=n.Util||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){this.isOpen=new ko.observable(!1);var n=this;this.isOpen.subscribe(function(t){!t&&n.markAsImplementedPromise&&n.markAsImplementedPromise.reject()});this.objectName=new ko.observable("");this.isLoading=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.markAsImplementedPromise=null;this.flagAsImplementedMethodUrlPostfix=null;this.doesSnapshotExists=new ko.observable(!1);this.difference=new ko.observableArray};t.ViewModel.prototype={openNpcCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagNpcAsImplemented?npcId="+n,this.loadCompareResult("CompareNpc?npcId="+n)},openItemCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagItemAsImplemented?itemId="+n,this.loadCompareResult("CompareItem?itemId="+n)},openSkillCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagSkillAsImplemented?skillId="+n,this.loadCompareResult("CompareSkill?skillId="+n)},openDialogCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagDialogAsImplemented?dialogId="+n,this.loadCompareResult("CompareDialog?dialogId="+n)},openQuestCompare:function(n,t){return this.isOpen(!0),this.objectName(t?t:""),this.flagAsImplementedMethodUrlPostfix="FlagQuestAsImplemented?questId="+n,this.loadCompareResult("CompareQuest?questId="+n)},openMarkerCompare:function(n,t,i){return this.isOpen(!0),this.objectName(""),this.flagAsImplementedMethodUrlPostfix="FlagMarkerAsImplemented?mapId="+n+"&markerId="+t+"&markerType="+i,this.loadCompareResult("CompareMarker?mapId="+n+"&markerId="+t+"&markerType="+i)},loadCompareResult:function(n){this.isLoading(!0);this.errorOccured(!1);this.difference([]);var t=this;return jQuery.ajax({url:"/api/ImplementationStatusApi/"+n,type:"GET"}).done(function(n){t.isLoading(!1);t.addExpandedObservable(n.compareDifference);t.doesSnapshotExists(n.doesSnapshotExist);n.compareDifference&&t.difference(n.compareDifference)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)}),this.markAsImplementedPromise=new jQuery.Deferred,this.markAsImplementedPromise.promise()},addExpandedObservable:function(n){if(n)for(var t=0;t<n.length;++t)n[t].isExpanded=new ko.observable(!0),this.addExpandedObservable(n[t].subDifferences)},toggleCompareResultExpanded:function(n){n.isExpanded(!n.isExpanded())},markAsImplemented:function(){this.isLoading(!0);this.errorOccured(!1);var t=this;jQuery.ajax({url:"/api/ImplementationStatusApi/"+this.flagAsImplementedMethodUrlPostfix,headers:n.Util.generateAntiForgeryHeader(),type:"POST"}).done(function(){window.refreshImplementationStatusList&&window.refreshImplementationStatusList();t.markAsImplementedPromise.resolve();t.markAsImplementedPromise=null;t.isLoading(!1);t.isOpen(!1)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})},closeDialog:function(){this.isOpen(!1)}}})(t.CompareDialog=t.CompareDialog||{})})(n.ImplementationStatus=n.ImplementationStatus||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldScriptSettingsAdditionalScriptNameSeperator=",";n.FlexFieldScriptSettings=function(){this.dontExportToScript=!1;this.additionalScriptNames=""};n.FlexFieldScriptSettings.prototype={serialize:function(){return{dontExportToScript:this.dontExportToScript,additionalScriptNames:this.additionalScriptNames}},deserialize:function(n){this.dontExportToScript=n.dontExportToScript;this.additionalScriptNames=n.additionalScriptNames}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldBase=function(){this.id=new ko.observable("");this.createdFromTemplate=new ko.observable(!1);this.name=new ko.observable;this.scriptSettings=new n.FlexFieldScriptSettings};n.FlexFieldBase.prototype={getType:function(){},getTemplateName:function(){},canExportToScript:function(){},serializeValue:function(){},deserializeValue:function(){},getChildFields:function(){return null},hasAdditionalConfiguration:function(){return!1},getAdditionalConfigurationLabel:function(){return""},allowEditingAdditionalConfigForTemplateFields:function(){return!1},setAdditionalConfiguration:function(){},getAdditionalConfiguration:function(){return""},serializeAdditionalConfiguration:function(){return""},deserializeAdditionalConfiguration:function(){},groupFields:function(){}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeSingleLine=0;n.SingleLineFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable("")};n.SingleLineFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.SingleLineFlexField.prototype.getType=function(){return n.FlexFieldTypeSingleLine};n.SingleLineFlexField.prototype.getTemplateName=function(){return"gn-singleLineField"};n.SingleLineFlexField.prototype.canExportToScript=function(){return!0};n.SingleLineFlexField.prototype.serializeValue=function(){return this.value()};n.SingleLineFlexField.prototype.deserializeValue=function(n){this.value(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeMultiLine=1;n.MultiLineFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable("")};n.MultiLineFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.MultiLineFlexField.prototype.getType=function(){return n.FlexFieldTypeMultiLine};n.MultiLineFlexField.prototype.getTemplateName=function(){return"gn-multiLineField"};n.MultiLineFlexField.prototype.canExportToScript=function(){return!1};n.MultiLineFlexField.prototype.serializeValue=function(){return this.value()};n.MultiLineFlexField.prototype.deserializeValue=function(n){this.value(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldTypeNumber=2;n.NumberFlexField=function(){n.FlexFieldBase.apply(this);this.value=new ko.observable(0)};n.NumberFlexField.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.NumberFlexField.prototype.getType=function(){return n.FlexFieldTypeNumber};n.NumberFlexField.prototype.getTemplateName=function(){return"gn-numberField"};n.NumberFlexField.prototype.canExportToScript=function(){return!0};n.NumberFlexField.prototype.serializeValue=function(){return this.value()?this.value().toString():"0.0"};n.NumberFlexField.prototype.deserializeValue=function(n){var t=parseFloat(n);isNaN(t)?this.value(0):this.value(t)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.FlexFieldTypeOption=3;t.OptionFlexField=function(){t.FlexFieldBase.apply(this);this.value=new ko.observable(null);this.options=new ko.observableArray};t.OptionFlexField.prototype=jQuery.extend(!0,{},t.FlexFieldBase.prototype);t.OptionFlexField.prototype.getType=function(){return t.FlexFieldTypeOption};t.OptionFlexField.prototype.getTemplateName=function(){return"gn-optionField"};t.OptionFlexField.prototype.canExportToScript=function(){return!0};t.OptionFlexField.prototype.serializeValue=function(){return this.value()};t.OptionFlexField.prototype.deserializeValue=function(n){this.value(n)};t.OptionFlexField.prototype.hasAdditionalConfiguration=function(){return!0};t.OptionFlexField.prototype.getAdditionalConfigurationLabel=function(){return n.FlexFieldDatabase.Localization.OptionFieldAdditionalConfigurationLabel};t.OptionFlexField.prototype.allowEditingAdditionalConfigForTemplateFields=function(){return!1};t.OptionFlexField.prototype.setAdditionalConfiguration=function(n){var t=[];n&&(t=n.split("\n"));this.options(t)};t.OptionFlexField.prototype.getAdditionalConfiguration=function(){return this.options().join("\n")};t.OptionFlexField.prototype.serializeAdditionalConfiguration=function(){return JSON.stringify(this.options())};t.OptionFlexField.prototype.deserializeAdditionalConfiguration=function(n){var t=[];n&&(t=JSON.parse(n));this.options(t)}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldGroup=100;n.FieldGroup=function(){n.FlexFieldBase.apply(this);this.fields=new ko.observableArray;this.deserializingFieldIds=null;this.isExpandedByDefault=!0;this.areFieldsExpanded=new ko.observable(!0)};n.FieldGroup.prototype=jQuery.extend(!0,{},n.FlexFieldBase.prototype);n.FieldGroup.prototype.getType=function(){return n.FlexFieldGroup};n.FieldGroup.prototype.getTemplateName=function(){return"gn-fieldGroup"};n.FieldGroup.prototype.canExportToScript=function(){return!1};n.FieldGroup.prototype.serializeValue=function(n){for(var i=[],r=this.fields(),t=0;t<r.length;++t)r[t].id()?i.push(r[t].id()):i.push((n+t+1).toString());return JSON.stringify(i)};n.FieldGroup.prototype.getChildFields=function(){return this.fields()};n.FieldGroup.prototype.deserializeValue=function(n){this.deserializingFieldIds=[];n&&(this.deserializingFieldIds=JSON.parse(n))};n.FieldGroup.prototype.serializeAdditionalConfiguration=function(){return JSON.stringify({isExpandedByDefault:this.isExpandedByDefault})};n.FieldGroup.prototype.deserializeAdditionalConfiguration=function(n){if(n){var t=JSON.parse(n);this.isExpandedByDefault=t.isExpandedByDefault;this.areFieldsExpanded(this.isExpandedByDefault)}};n.FieldGroup.prototype.groupFields=function(n,t){var i,f,r,u;if(this.deserializingFieldIds){for(i=0;i<this.deserializingFieldIds.length;++i){for(f=!1,r=0;r<n.length;++r)if(n[r].id()==this.deserializingFieldIds[i]){t[r]||(this.fields.push(n[r]),t[r]=!0);f=!0;break}!f&&this.deserializingFieldIds[i]&&this.deserializingFieldIds[i].indexOf("-")<0&&(u=parseInt(this.deserializingFieldIds[i]),!isNaN(u)&&u>=0&&u<n.length&&(this.fields.push(n[u]),t[u]=!0))}this.deserializingFieldIds=null}};n.FieldGroup.prototype.toogleFieldVisibility=function(){this.areFieldsExpanded(!this.areFieldsExpanded())};n.FieldGroup.prototype.deleteField=function(n){this.fields.remove(n)}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.FlexFieldManager=function(){this.fields=new ko.observableArray};n.FlexFieldManager.prototype={addSingleLineField:function(t){return this.addField(n.FlexFieldTypeSingleLine,t)},addMultiLineField:function(t){return this.addField(n.FlexFieldTypeMultiLine,t)},addNumberField:function(t){return this.addField(n.FlexFieldTypeNumber,t)},addOptionField:function(t){return this.addField(n.FlexFieldTypeOption,t)},addFieldGroup:function(t){return this.addField(n.FlexFieldGroup,t)},addField:function(n,t){var i=this.resolveFieldByType(n);if(!i)throw"Unknown field type";return i.name(t),this.fields.push(i),i},resolveFieldByType:function(t){switch(t){case n.FlexFieldTypeSingleLine:return new n.SingleLineFlexField;case n.FlexFieldTypeMultiLine:return new n.MultiLineFlexField;case n.FlexFieldTypeNumber:return new n.NumberFlexField;case n.FlexFieldTypeOption:return new n.OptionFlexField;case n.FlexFieldGroup:return new n.FieldGroup}return null},deleteField:function(n){this.fields.remove(n)},deleteFieldGroup:function(n){var r,i,t;if(n.fields)for(r=this.fields.indexOf(n),i=n.fields(),t=0;t<i.length;++t)r<0?this.fields.push(i[t]):this.fields.splice(r+t,0,i[t]);this.fields.remove(n)},serializeFields:function(){for(var i,r,n=[],u=this.fields(),t=0;t<u.length;++t)if(n.push(this.serializeSingleField(u[t],n)),i=u[t].getChildFields(),i)for(r=0;r<i.length;++r)n.push(this.serializeSingleField(i[r],n));return n},serializeSingleField:function(n,t){return{id:n.id(),createdFromTemplate:n.createdFromTemplate(),fieldType:n.getType(),name:n.name(),value:n.serializeValue(t.length),additionalConfiguration:n.serializeAdditionalConfiguration(),scriptSettings:n.scriptSettings.serialize()}},deserializeFields:function(n){for(var i,u,r=[],t=0;t<n.length;++t)i=this.resolveFieldByType(n[t].fieldType),i.id(n[t].id),i.createdFromTemplate(n[t].createdFromTemplate),i.name(n[t].name),i.deserializeValue(n[t].value),i.deserializeAdditionalConfiguration(n[t].additionalConfiguration),i.scriptSettings.deserialize(n[t].scriptSettings),r.push(i);for(u={},t=0;t<r.length;++t)r[t].groupFields(r,u);for(t=r.length-1;t>=0;--t)u[t]&&r.splice(t,1);this.fields(r)},syncFieldIds:function(n){for(var i,r={},t=0;t<n.fields.length;++t)r[n.fields[t].name]=n.fields[t].id;for(i=this.fields(),t=0;t<i.length;++t)i[t].id(r[i[t].name()])},flagFieldsAsCreatedFromTemplate:function(){for(var t,i,r=this.fields(),n=0;n<r.length;++n)if(r[n].createdFromTemplate(!0),t=r[n].getChildFields(),t)for(i=0;i<t.length;++i)t[i].createdFromTemplate(!0)},isFieldNameInUse:function(n,t){var r,i,u,f;for(n=n.toLowerCase(),r=this.fields(),i=0;i<r.length;++i){if(r[i]!=t&&r[i].name()&&r[i].name().toLowerCase()==n)return!0;if(u=r[i].getChildFields(),u)for(f=0;f<u.length;++f)if(u[f]!=t&&u[f].name()&&u[f].name().toLowerCase()==n)return!0}}}})(n.ObjectForm=n.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.FlexFieldHandlingViewModel=function(){this.fieldManager=new n.FlexFieldDatabase.ObjectForm.FlexFieldManager;this.showFieldCreateEditDialog=new ko.observable(!1);this.isEditingField=new ko.observable(!1);this.fieldToEdit=null;this.createEditFieldName=new ko.observable("");this.createEditFieldAdditionalConfigurationDisabled=new ko.observable(!1);this.createEditFieldHasAdditionalConfiguration=new ko.observable(!1);this.createEditFieldAdditionalConfiguration=new ko.observable("");this.createEditFieldAdditionalConfigurationLabel=new ko.observable("");this.createEditFieldDeferred=null;this.showConfirmFieldDeleteDialog=new ko.observable(!1);this.fieldToDelete=null;this.fieldToDeleteParent=null;this.showFieldScriptSettingsDialog=new ko.observable(!1);this.dontExportFieldToScript=new ko.observable;this.additionalFieldScriptNames=new ko.observable;this.scriptSettingsField=null;this.showFieldGroupCreateEditDialog=new ko.observable(!1);this.fieldGroupToEdit=null;this.isEditingFieldGroup=new ko.observable(!1);this.createEditFieldGroupName=new ko.observable("");this.createEditFieldGroupExpandedByDefault=new ko.observable(!1);this.showDuplicateFieldNameError=new ko.observable(!1);var t=this;this.createEditFieldName.subscribe(function(){t.showDuplicateFieldNameError(!1)});this.createEditFieldGroupName.subscribe(function(){t.showDuplicateFieldNameError(!1)});this.showConfirmFieldGroupDeleteDialog=new ko.observable(!1);this.fieldGroupToDelete=null};t.FlexFieldHandlingViewModel.prototype={onFieldAdded:function(){},addSingleLineField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addSingleLineField(t);n.onFieldAdded()})},addMultiLineField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addMultiLineField(t);n.onFieldAdded()})},addNumberField:function(){var n=this;this.openCreateEditFieldDialog(!1,"").done(function(t){n.fieldManager.addNumberField(t);n.onFieldAdded()})},addOptionField:function(){var t=this;this.openCreateEditFieldDialog(!1,"",!0,"",n.FlexFieldDatabase.Localization.OptionFieldAdditionalConfigurationLabel,!1).done(function(n,i){var r=t.fieldManager.addOptionField(n);r.setAdditionalConfiguration(i);t.onFieldAdded()})},editField:function(n){var t=!n.allowEditingAdditionalConfigForTemplateFields()&&n.createdFromTemplate();this.openCreateEditFieldDialog(!0,n,n.hasAdditionalConfiguration(),n.getAdditionalConfiguration(),n.getAdditionalConfigurationLabel(),t).done(function(t,i){n.name(t);n.hasAdditionalConfiguration()&&n.setAdditionalConfiguration(i)})},openCreateEditFieldDialog:function(t,i,r,u,f,e){return this.createEditFieldDeferred=new jQuery.Deferred,this.isEditingField(t),i?(this.createEditFieldName(i.name()),this.fieldToEdit=i):(this.createEditFieldName(""),this.fieldToEdit=null),this.createEditFieldHasAdditionalConfiguration(r?!0:!1),r&&(this.createEditFieldAdditionalConfigurationDisabled(e),this.createEditFieldAdditionalConfigurationLabel(f),this.createEditFieldAdditionalConfiguration(u?u:"")),n.Util.setupValidation("#gn-fieldCreateEditForm"),this.showFieldCreateEditDialog(!0),this.createEditFieldDeferred.promise()},saveField:function(){if(jQuery("#gn-fieldCreateEditForm").valid()){if(this.fieldManager.isFieldNameInUse(this.createEditFieldName(),this.fieldToEdit)){this.showDuplicateFieldNameError(!0);return}if(this.createEditFieldDeferred){var n=null;this.createEditFieldHasAdditionalConfiguration()&&(n=this.createEditFieldAdditionalConfiguration());this.createEditFieldDeferred.resolve(this.createEditFieldName(),n)}this.createEditFieldDeferred=null;this.showFieldCreateEditDialog(!1)}},cancelFieldDialog:function(){this.createEditFieldDeferred&&this.createEditFieldDeferred.reject();this.createEditFieldDeferred=null;this.fieldToEdit=null;this.showFieldCreateEditDialog(!1)},openCreateNewFieldGroupDialog:function(){n.Util.setupValidation("#gn-fieldGroupCreateEditForm");this.showFieldGroupCreateEditDialog(!0);this.fieldGroupToEdit=null;this.isEditingFieldGroup(!1);this.createEditFieldGroupName("");this.createEditFieldGroupExpandedByDefault(!0)},openEditFieldGroupDialog:function(t){n.Util.setupValidation("#gn-fieldGroupCreateEditForm");this.showFieldGroupCreateEditDialog(!0);this.fieldGroupToEdit=t;this.isEditingFieldGroup(!0);this.createEditFieldGroupName(t.name());this.createEditFieldGroupExpandedByDefault(t.isExpandedByDefault)},saveFieldGroup:function(){if(jQuery("#gn-fieldGroupCreateEditForm").valid()){if(this.fieldManager.isFieldNameInUse(this.createEditFieldGroupName(),this.fieldGroupToEdit)){this.showDuplicateFieldNameError(!0);return}if(this.fieldGroupToEdit==null){var n=this.fieldManager.addFieldGroup(this.createEditFieldGroupName());n.isExpandedByDefault=this.createEditFieldGroupExpandedByDefault();n.areFieldsExpanded(n.isExpandedByDefault)}else this.fieldGroupToEdit.name(this.createEditFieldGroupName()),this.fieldGroupToEdit.isExpandedByDefault=this.createEditFieldGroupExpandedByDefault(),this.fieldGroupToEdit.areFieldsExpanded(this.fieldGroupToEdit.isExpandedByDefault);this.closeFieldGroupDialog()}},closeFieldGroupDialog:function(){this.fieldGroupToEdit=null;this.showFieldGroupCreateEditDialog(!1)},openConfirmDeleteFieldGroupDialog:function(n){this.showConfirmFieldGroupDeleteDialog(!0);this.fieldGroupToDelete=n},closeConfirmFieldGroupDeleteDialog:function(){this.showConfirmFieldGroupDeleteDialog(!1);this.fieldGroupToDelete=null},deleteFieldGroup:function(){this.fieldManager.deleteFieldGroup(this.fieldGroupToDelete);this.closeConfirmFieldGroupDeleteDialog()},checkFieldDropAllowed:function(n){n.item.getType()==t.FlexFieldGroup&&n.targetParent!=this.fieldManager.fields&&(n.cancelDrop=!0)},openConfirmDeleteFieldDialog:function(n,t){this.showConfirmFieldDeleteDialog(!0);this.fieldToDelete=n;this.fieldToDeleteParent=t},closeConfirmFieldDeleteDialog:function(){this.showConfirmFieldDeleteDialog(!1);this.fieldToDelete=null;this.fieldToDeleteParent=null},deleteField:function(){this.fieldToDeleteParent!=null&&typeof this.fieldToDeleteParent.getType=="function"&&this.fieldToDeleteParent.getType()==t.FlexFieldGroup?this.fieldToDeleteParent.deleteField(this.fieldToDelete):this.fieldManager.deleteField(this.fieldToDelete);this.closeConfirmFieldDeleteDialog()},openScriptSettings:function(n){this.showFieldScriptSettingsDialog(!0);this.dontExportFieldToScript(n.scriptSettings.dontExportToScript);this.additionalFieldScriptNames(n.scriptSettings.additionalScriptNames);this.scriptSettingsField=n},saveFieldScriptSettings:function(){this.scriptSettingsField.scriptSettings.dontExportToScript=this.dontExportFieldToScript();this.scriptSettingsField.scriptSettings.additionalScriptNames=this.additionalFieldScriptNames();this.closeFieldScriptSettingsDialog()},closeFieldScriptSettingsDialog:function(){this.showFieldScriptSettingsDialog(!1);this.scriptSettingsField=null}}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.BaseViewModel=function(t,i,r,u,f,e){var o,s;n.FlexFieldDatabase.ObjectForm.FlexFieldHandlingViewModel.apply(this);this.rootPage=t;this.apiControllerName=i;this.lockName=r;this.templateLockName=u;this.kirjaApiMentionedMethod=f;this.kartaApiMarkedMethod=e;this.isTemplateMode=new ko.observable(!1);n.Util.getParameterFromUrl("template")&&this.isTemplateMode(!0);this.id=new ko.observable("");o=n.Util.getParameterFromUrl("id");o&&this.id(o);this.objectImageUploadUrl=new ko.computed(function(){return this.isTemplateMode()?"/api/"+this.apiControllerName+"/FlexFieldTemplateImageUpload?id="+this.id():"/api/"+this.apiControllerName+"/FlexFieldImageUpload?id="+this.id()},this);s=n.Util.getParameterFromUrl("templateId");this.templateId=s;this.parentFolderId=n.Util.getParameterFromUrl("folderId");this.isReadonly=new ko.observable(!1);this.lockedByUser=new ko.observable("");this.isLoading=new ko.observable(!1);this.isImplemented=new ko.observable(!1);this.compareDialog=new n.ImplementationStatus.CompareDialog.ViewModel;this.objectName=new ko.observable("");this.imageFilename=new ko.observable("");this.thumbnailImageFilename=new ko.observable("");this.objectTags=new ko.observableArray;this.existingObjectTags=new ko.observableArray;this.objectNameDisplay=new ko.computed(function(){var n=this.objectName();return n?" - "+n:""},this);this.showConfirmObjectDeleteDialog=new ko.observable(!1);this.showCustomizedExportTemplateWarningOnDelete=new ko.observable(!1);this.showConfirmRegenerateLanguageKeysDialog=new ko.observable(!1);this.showExportResultDialog=new ko.observable(!1);this.exportResultContent=new ko.observable("");this.exportResultErrors=new ko.observableArray;this.exportResultFormat="";this.exportShowSuccessfullyCopiedTooltip=new ko.observable(!1);this.referencedInQuests=new ko.observableArray;this.loadingReferencedInQuests=new ko.observable(!1);this.errorLoadingReferencedInQuests=new ko.observable(!1);this.mentionedInKirjaPages=new ko.observableArray;this.loadingMentionedInKirjaPages=new ko.observable(!1);this.errorLoadingMentionedInKirjaPages=new ko.observable(!1);this.markedInKartaMaps=new ko.observableArray;this.loadingMarkedInKartaMaps=new ko.observable(!1);this.errorLoadingMarkedInKartaMaps=new ko.observable(!1);this.referencedInTaleDialogs=new ko.observableArray;this.loadingReferencedInTaleDialogs=new ko.observable(!1);this.errorLoadingReferencedInTaleDialogs=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.additionalErrorDetails=new ko.observable("");this.objectNotFound=new ko.observable(!1);n.Util.setupValidation("#gn-objectFields");this.id()&&this.isTemplateMode()&&this.checkIfCustomizedExportTemplateExists()};t.BaseViewModel.prototype=jQuery.extend({},n.FlexFieldDatabase.ObjectForm.FlexFieldHandlingViewModel.prototype);t.BaseViewModel.prototype.loadAdditionalDependencies=function(){};t.BaseViewModel.prototype.parseAdditionalData=function(){};t.BaseViewModel.prototype.setAdditionalSaveData=function(n){return n};t.BaseViewModel.prototype.init=function(){this.id()?(this.loadObjectData(this.id(),this.isTemplateMode()),n.FlexFieldDatabase.ObjectForm.hasAikaRights&&!this.isTemplateMode()&&this.loadAikaQuests(),n.FlexFieldDatabase.ObjectForm.hasKirjaRights&&!this.isTemplateMode()&&this.loadKirjaPages(),n.FlexFieldDatabase.ObjectForm.hasKartaRights&&!this.isTemplateMode()&&this.loadKartaMaps(),n.FlexFieldDatabase.ObjectForm.hasTaleRights&&!this.isTemplateMode()&&this.loadTaleDialogs(),this.loadAdditionalDependencies(),this.acquireLock()):this.templateId&&this.loadObjectData(this.templateId,!0);this.loadExistingObjectTags()};t.BaseViewModel.prototype.checkIfCustomizedExportTemplateExists=function(){if(this.id()){var n=this;jQuery.ajax({url:"/api/ExportApi/DoesExportTemplateExistForObjectId?id="+this.id(),type:"GET"}).done(function(t){n.showCustomizedExportTemplateWarningOnDelete(t.doesTemplateExist)}).fail(function(){n.errorOccured(!0)})}};t.BaseViewModel.prototype.resetErrorState=function(){this.errorOccured(!1);this.additionalErrorDetails("");this.objectNotFound(!1)};t.BaseViewModel.prototype.loadExistingObjectTags=function(){var n=this;jQuery.ajax({url:"/api/"+this.apiControllerName+"/FlexFieldObjectTags",type:"GET"}).done(function(t){n.existingObjectTags(t)}).fail(function(){n.errorOccured(!0)})};t.BaseViewModel.prototype.loadObjectData=function(n,t){var r="/api/"+this.apiControllerName+"/FlexFieldObject",i;t&&(r="/api/"+this.apiControllerName+"/FlexFieldTemplate");r+="?id="+n;this.isLoading(!0);this.resetErrorState();i=this;jQuery.ajax({url:r,type:"GET"}).done(function(n){if(i.isLoading(!1),!n){i.errorOccured(!0);i.objectNotFound(!0);return}t||(i.templateId=i.isTemplateMode()?"":n.templateId,i.isImplemented(i.isTemplateMode()?!1:n.isImplemented));!t||i.isTemplateMode()?i.objectName(n.name):i.objectName("");i.parseAdditionalData(n);i.thumbnailImageFilename(n.thumbnailImageFile);i.imageFilename(n.imageFile);i.fieldManager.deserializeFields(n.fields);t&&!i.isTemplateMode()&&i.fieldManager.flagFieldsAsCreatedFromTemplate();i.objectTags(n.tags)}).fail(function(){i.isLoading(!1);i.errorOccured(!0)})};t.BaseViewModel.prototype.save=function(){this.sendSaveRequest(!1)};t.BaseViewModel.prototype.saveAndDistributeFields=function(){this.sendSaveRequest(!0)};t.BaseViewModel.prototype.sendSaveRequest=function(t){var f,r,u,i;jQuery("#gn-objectFields").valid()&&(f=this.fieldManager.serializeFields(),r={templateId:this.isTemplateMode()?"":this.templateId,name:this.objectName(),fields:f,tags:this.objectTags()},r=this.setAdditionalSaveData(r),this.isTemplateMode()||this.id()||(r.parentFolderId=this.parentFolderId,this.imageFilename()&&(r.imageFile=this.imageFilename()),this.thumbnailImageFilename()&&(r.thumbnailImageFile=this.thumbnailImageFilename())),u="",u=this.isTemplateMode()?this.id()?"/api/"+this.apiControllerName+"/UpdateFlexFieldTemplate?id="+this.id():"/api/"+this.apiControllerName+"/CreateFlexFieldTemplate":this.id()?"/api/"+this.apiControllerName+"/UpdateFlexFieldObject?id="+this.id():"/api/"+this.apiControllerName+"/CreateFlexFieldObject",this.isLoading(!0),this.resetErrorState(),i=this,jQuery.ajax({url:u,headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(r),type:"POST",contentType:"application/json"}).done(function(r){if(!i.id()){i.id(r.id);var u="id="+r.id;i.isTemplateMode()?n.Util.replaceUrlParameters("template=1&"+u):n.Util.replaceUrlParameters(u);i.acquireLock()}i.isTemplateMode()||(i.fieldManager.syncFieldIds(r),i.isImplemented(r.isImplemented));t?i.distributeFields():i.isLoading(!1);i.runAfterSave(r);i.callObjectGridRefresh()}).fail(function(){i.isLoading(!1);i.errorOccured(!0)}))};t.BaseViewModel.prototype.runAfterSave=function(){};t.BaseViewModel.prototype.distributeFields=function(){var t=this;jQuery.ajax({url:"/api/"+this.apiControllerName+"/DistributeFlexFieldTemplateFields?id="+this.id(),headers:n.Util.generateAntiForgeryHeader(),type:"POST",contentType:"application/json"}).done(function(){t.isLoading(!1)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})};t.BaseViewModel.prototype.openDeleteObjectDialog=function(){this.showConfirmObjectDeleteDialog(!0)};t.BaseViewModel.prototype.closeConfirmObjectDeleteDialog=function(){this.showConfirmObjectDeleteDialog(!1)};t.BaseViewModel.prototype.deleteObject=function(){var i="/api/"+this.apiControllerName+"/DeleteFlexFieldObject",t;this.isTemplateMode()&&(i="/api/"+this.apiControllerName+"/DeleteFlexFieldTemplate");i+="?id="+this.id();this.isLoading(!0);this.resetErrorState();t=this;jQuery.ajax({url:i,headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.callObjectGridRefresh();t.closeConfirmObjectDeleteDialog();window.location=t.rootPage}).fail(function(n){t.isLoading(!1);t.errorOccured(!0);t.closeConfirmObjectDeleteDialog();n.status==400&&n.responseText&&t.additionalErrorDetails(n.responseText)})};t.BaseViewModel.prototype.imageUploaded=function(n){this.imageFilename(n);this.callObjectGridRefresh()};t.BaseViewModel.prototype.imageUploadError=function(n,t){this.errorOccured(!0);t&&t.responseText?this.additionalErrorDetails(t.responseText):this.additionalErrorDetails(n)};t.BaseViewModel.prototype.openCompareDialogForObject=function(){var n=new jQuery.Deferred;return n.reject("Not implemented"),n.promise()};t.BaseViewModel.prototype.openCompareDialog=function(){var n=this;this.openCompareDialogForObject().done(function(){n.isImplemented(!0)})};t.BaseViewModel.prototype.openExportTemplate=function(n){if(this.id()){var t="/Export/ManageTemplate?templateType="+n+"&customizedObjectId="+this.id();this.isTemplateMode()&&(t+="&objectIsTemplate=1");window.location=t}};t.BaseViewModel.prototype.exportObject=function(n,t){this.exportResultFormat=t;this.isLoading(!0);this.errorOccured(!1);var i=this;jQuery.ajax({url:"/api/ExportApi/ExportObject?exportFormat="+t+"&id="+this.id()+"&templateType="+n,type:"GET"}).done(function(n){i.isLoading(!1);i.showExportResultDialog(!0);i.exportResultContent(n.code);i.exportResultErrors(n.errors)}).fail(function(){i.closeExportResultDialog();i.errorOccured(!0);i.isLoading(!1)})};t.BaseViewModel.prototype.closeExportResultDialog=function(){this.showExportResultDialog(!1);this.exportResultContent("");this.exportResultErrors([])};t.BaseViewModel.prototype.exportDownload=function(n){window.location="/api/ExportApi/ExportObjectDownload?exportFormat="+this.exportResultFormat+"&id="+this.id()+"&templateType="+n};t.BaseViewModel.prototype.copyExportCodeToClipboard=function(){var t=jQuery("#gn-flexFieldObjectExportResultTextarea")[0],n;t.select();document.execCommand("copy");this.exportShowSuccessfullyCopiedTooltip(!0);n=this;setTimeout(function(){n.exportShowSuccessfullyCopiedTooltip(!1)},1e3)};t.BaseViewModel.prototype.openConfirmRegenerateLanguageKeysDialog=function(){this.showConfirmRegenerateLanguageKeysDialog(!0)};t.BaseViewModel.prototype.regenerateLanguageKeys=function(){this.isLoading(!0);this.resetErrorState();var t=this;jQuery.ajax({url:"/api/ExportApi/DeleteLanguageKeysByGroupId?groupId="+this.id(),headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.isLoading(!1);t.closeConfirmRegenerateLanguageKeysDialog()}).fail(function(){t.isLoading(!1);t.errorOccured(!0);t.closeConfirmRegenerateLanguageKeysDialog()})};t.BaseViewModel.prototype.closeConfirmRegenerateLanguageKeysDialog=function(){this.showConfirmRegenerateLanguageKeysDialog(!1)};t.BaseViewModel.prototype.loadAikaQuests=function(){this.loadingReferencedInQuests(!0);this.errorLoadingReferencedInQuests(!1);var n=this;jQuery.ajax({url:"/api/AikaApi/GetQuestsObjectIsReferenced?objectId="+this.id(),type:"GET"}).done(function(t){n.referencedInQuests(t);n.loadingReferencedInQuests(!1)}).fail(function(){n.errorLoadingReferencedInQuests(!0);n.loadingReferencedInQuests(!1)})};t.BaseViewModel.prototype.buildAikaQuestUrl=function(n){return"/Aika/Quest?id="+n.id};t.BaseViewModel.prototype.loadKirjaPages=function(){this.loadingMentionedInKirjaPages(!0);this.errorLoadingMentionedInKirjaPages(!1);var n=this;jQuery.ajax({url:"/api/KirjaApi/"+this.kirjaApiMentionedMethod+this.id(),type:"GET"}).done(function(t){n.mentionedInKirjaPages(t);n.loadingMentionedInKirjaPages(!1)}).fail(function(){n.errorLoadingMentionedInKirjaPages(!0);n.loadingMentionedInKirjaPages(!1)})};t.BaseViewModel.prototype.buildKirjaPageUrl=function(n){return"/Kirja?id="+n.id};t.BaseViewModel.prototype.loadKartaMaps=function(){if(this.kartaApiMarkedMethod){this.loadingMarkedInKartaMaps(!0);this.errorLoadingMarkedInKartaMaps(!1);var n=this;jQuery.ajax({url:"/api/KartaApi/"+this.kartaApiMarkedMethod+this.id(),type:"GET"}).done(function(t){for(var i=0;i<t.length;++i)t[i].tooltip=n.buildKartaMapMarkerCountTooltip(t[i]);n.markedInKartaMaps(t);n.loadingMarkedInKartaMaps(!1)}).fail(function(){n.errorLoadingMarkedInKartaMaps(!0);n.loadingMarkedInKartaMaps(!1)})}};t.BaseViewModel.prototype.buildKartaMapMarkerCountTooltip=function(t){return n.FlexFieldDatabase.ObjectForm.Localization.MarkedInMapNTimes.replace("{0}",t.markerIds.length)};t.BaseViewModel.prototype.buildKartaMapUrl=function(n){var t="/Karta?id="+n.mapId;return n.markerIds.length==1&&(t+="&zoomOnMarkerId="+n.markerIds[0]+"&zoomOnMarkerType="+n.mapMarkerType),t};t.BaseViewModel.prototype.loadTaleDialogs=function(){this.loadingReferencedInTaleDialogs(!0);this.errorLoadingReferencedInTaleDialogs(!1);var t=this;jQuery.ajax({url:"/api/TaleApi/GetDialogsObjectIsReferenced?objectId="+this.id(),type:"GET"}).done(function(i){for(var u=[],r=0;r<i.length;++r)i[r].relatedObjectId!=t.id()&&u.push(i[r].relatedObjectId);if(u.length==0){t.referencedInTaleDialogs([]);t.loadingReferencedInTaleDialogs(!1);return}jQuery.ajax({url:"/api/KortistoApi/ResolveFlexFieldObjectNames",headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(u),type:"POST",contentType:"application/json"}).done(function(n){t.referencedInTaleDialogs(n);t.loadingReferencedInTaleDialogs(!1)}).fail(function(){t.errorLoadingReferencedInTaleDialogs(!0);t.loadingReferencedInTaleDialogs(!1)})}).fail(function(){t.errorLoadingReferencedInTaleDialogs(!0);t.loadingReferencedInTaleDialogs(!1)})};t.BaseViewModel.prototype.buildTaleDialogUrl=function(n){return"/Tale?npcId="+n.id};t.BaseViewModel.prototype.acquireLock=function(){var i=this.lockName,t;this.isTemplateMode()&&(i=this.templateLockName);t=this;n.LockService.acquireLock(i,this.id()).done(function(n,i){n&&(t.isReadonly(!0),t.lockedByUser(i),t.setAdditionalDataToReadonly())}).fail(function(){t.errorOccured(!0);t.isReadonly(!0)})};t.BaseViewModel.prototype.setAdditionalDataToReadonly=function(){};t.BaseViewModel.prototype.callObjectGridRefresh=function(){window.refreshFlexFieldObjectGrid&&window.refreshFlexFieldObjectGrid()}})(t.ObjectForm=t.ObjectForm||{})})(n.FlexFieldDatabase=n.FlexFieldDatabase||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){function r(n){return{questState:n,label:i[n]}}var u=0,f=1,e=2,o=3,i={};i[u]=n.Localization.QuestStates.NotStarted;i[f]=n.Localization.QuestStates.InProgress;i[e]=n.Localization.QuestStates.Success;i[o]=n.Localization.QuestStates.Failed;t.getQuestStateLabel=function(n){return i[n]};t.getQuestStates=function(){return[r(u),r(f),r(e),r(o)]}})(n.Shapes=n.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.ObjectResourceNpc=0;n.ObjectResourceItem=1;n.ObjectResourceQuest=2;n.ObjectResourceDialogs=3;n.ObjectResourceMapMarker=4;n.ObjectResourceSkill=5;var t={},i={};n.resetSharedObjectLoading=function(n,r){t[n]&&t[n][r]&&(t[n][r]=null);i[n]&&i[n][r]&&(i[n][r]=null)};n.SharedObjectLoading=function(){};n.SharedObjectLoading.prototype={getObjectId:function(){},getObjectResource:function(){},clearLoadedSharedObject:function(n){var r=this.getObjectId(n);t[this.getObjectResource()]&&(t[this.getObjectResource()][r]=null);i[this.getObjectResource()]&&(i[this.getObjectResource()][r]=null)},loadObjectShared:function(n){var r=this.getObjectId(n),e,o,s,u,f;return t[this.getObjectResource()]&&(e=t[this.getObjectResource()][r],e)?(o=new jQuery.Deferred,o.resolve(e),o.promise()):i[this.getObjectResource()]&&(s=i[this.getObjectResource()][r],s)?s:(u=this.loadObject(r),i[this.getObjectResource()]||(i[this.getObjectResource()]={}),i[this.getObjectResource()][r]=u,f=this,u.then(function(n){t[f.getObjectResource()]||(t[f.getObjectResource()]={});t[f.getObjectResource()][r]=n}),u)},loadObject:function(){}}})(n.Shapes=n.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){t.BaseViewModel=function(){this.nodeGraph=new ko.observable;this.nodePaper=new ko.observable;this.showConfirmNodeDeleteDialog=new ko.observable(!1);this.deleteLoading=new ko.observable(!1);this.deleteErrorOccured=new ko.observable(!1);this.deleteErrorAdditionalInformation=new ko.observable("");this.deleteNodeTarget=null;this.deleteDeferred=null;this.errorOccured=new ko.observable(!1)};t.BaseViewModel.prototype={addNewNode:function(n,t,i){if(this.nodeGraph()&&this.nodePaper()){var r=this.calcNodeInitOptionsPosition(t,i);this.addNodeByType(n.data("nodetype"),r)}},calcNodeInitOptionsPosition:function(n,t){var i=this.nodePaper().scale(),r=this.nodePaper().translate();return{position:{x:(n-r.tx)/i.sx,y:(t-r.ty)/i.sy}}},addNodeByType:function(t,i){var r=n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().createNewNode(t,i);if(r==null){this.errorOccured(!0);return}this.nodeGraph().addCells(r);this.setupNewNode(r)},setupNewNode:function(n){n.attr(".inPorts circle/magnet","passive");var t=this;n.onDelete=function(n){return t.onDelete(n)}},reloadFieldsForNodes:function(t,i){var e,f,r,u;if(n.DefaultNodeShapes.Shapes.resetSharedObjectLoading(t,i),this.nodeGraph())for(e=this.nodePaper(),f=this.nodeGraph().getElements(),r=0;r<f.length;++r)u=e.findViewByModel(f[r]),u&&u.reloadSharedLoadedData&&u.reloadSharedLoadedData(t,i)},onDelete:function(n){return this.deleteLoading(!1),this.deleteErrorOccured(!1),this.deleteErrorAdditionalInformation(""),this.showConfirmNodeDeleteDialog(!0),this.deleteNodeTarget=n,this.deleteDeferred=new jQuery.Deferred,this.deleteDeferred.promise()},deleteNode:function(){var t,n;this.deleteNodeTarget&&this.deleteNodeTarget.validateDelete?(t=this.deleteNodeTarget.validateDelete(),t?(n=this,this.deleteLoading(!0),this.deleteErrorOccured(!1),this.deleteErrorAdditionalInformation(""),t.done(function(){n.deleteLoading(!1);n.resolveDeleteDeferred()}).fail(function(t){n.deleteLoading(!1);n.deleteErrorOccured(!0);n.deleteErrorAdditionalInformation(t)})):this.resolveDeleteDeferred()):this.resolveDeleteDeferred()},resolveDeleteDeferred:function(){this.deleteDeferred&&(this.deleteDeferred.resolve(),this.deleteDeferred=null);this.closeConfirmNodeDeleteDialog()},closeConfirmNodeDeleteDialog:function(){this.deleteDeferred&&(this.deleteDeferred.reject(),this.deleteDeferred=null);this.showConfirmNodeDeleteDialog(!1);this.deleteLoading(!1);this.deleteErrorOccured(!1);this.deleteErrorAdditionalInformation("");this.deleteNodeTarget=null},setGraphToReadonly:function(){jQuery(".gn-nodeGraphContainer").find("input,textarea,select").prop("disabled",!0);jQuery(".gn-nodeGraphContainer").find(".joint-cell").css("pointer-events","none");jQuery(".gn-nodeGraphContainer").find(".gn-nodeDeleteOnReadonly").remove();jQuery(".gn-nodeGraphContainer").find(".gn-nodeNonClickableOnReadonly").css("pointer-events","none")}}})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){var t=function(){this.availableConditionTypes=[]},i;t.prototype={addConditionType:function(n){this.availableConditionTypes.push(n)},getConditionTypes:function(){return this.availableConditionTypes},getSelectableConditionTypes:function(){for(var t=[],n=0;n<this.availableConditionTypes.length;++n)this.availableConditionTypes[n].canBeSelected()&&t.push(this.availableConditionTypes[n]);return t},getConditionTemplate:function(n){var t=this.getConditionType(n);return t?t.getTemplateName():"gn-nodeConditionEmpty"},isConditionTypeSelectable:function(n){var t=this.getConditionType(n);return t?t.canBeSelected():!0},buildConditionData:function(n,t,i){i.errorOccured(!1);var r=this.getConditionType(n);return r?r.buildConditionData(t,i):null},serializeCondition:function(t){return{id:t.id,dependsOnObjects:n.getConditionManager().getConditionElementsDependsOnObject(t.conditionElements),conditionElements:JSON.stringify(t.conditionElements)}},deserializeCondition:function(n){return{id:n.id,conditionElements:JSON.parse(n.conditionElements)}},serializeConditionElement:function(n){var t=this.getConditionType(n.conditionType());return t?{conditionType:n.conditionType(),conditionData:t.serializeConditionData(n.conditionData())}:null},getConditionElementsDependsOnObject:function(t){for(var r,i,f,e={},o=[],u=0;u<t.length;++u)for(r=n.getConditionManager().getConditionElementDependsOnObject(t[u].conditionType,t[u].conditionData),i=0;i<r.length;++i)f=r[i].objectType+"|"+r[i].objectId,e[f]||(o.push(r[i]),e[f]=!0);return o},getConditionElementDependsOnObject:function(n,t){var i=this.getConditionType(n);return i?i.getConditionDependsOnObject(t):[]},getConditionType:function(n){for(var t=0;t<this.availableConditionTypes.length;++t)if(this.availableConditionTypes[t].getType()==n)return this.availableConditionTypes[t];return null},convertElements:function(n){for(var r,i=[],t=0;t<n.length;++t)r=this.convertElement(n[t]),i.push(r);return i},convertElement:function(n){var t={isSelected:new ko.observable(!1),conditionType:new ko.observable(n.conditionType),conditionData:new ko.observable(null),conditionTemplate:new ko.observable("gn-nodeConditionEmpty"),parent:null,errorOccured:new ko.observable(!1)};return t.conditionData(this.buildConditionData(n.conditionType,n.conditionData,t)),t.conditionTemplate(this.getConditionTemplate(n.conditionType)),this.addSharedFunctions(t),t},createEmptyElement:function(){var n={isSelected:new ko.observable(!1),conditionType:new ko.observable(""),conditionData:new ko.observable(null),conditionTemplate:new ko.observable("gn-nodeConditionEmpty"),parent:null,errorOccured:new ko.observable(!1)};return this.addSharedFunctions(n),n},addSharedFunctions:function(n){var t=this;n.conditionType.subscribe(function(){n.conditionTemplate("gn-nodeConditionEmpty");n.conditionData(t.buildConditionData(n.conditionType(),null,n));n.conditionTemplate(t.getConditionTemplate(n.conditionType()))})},getConditionString:function(n,t,i){for(var e,r=new jQuery.Deferred,f=[],u=0;u<n.length;++u)e=this.getConditionType(n[u].conditionType),f.push(e.getConditionString(n[u].conditionData));return jQuery.when.apply(jQuery,f).then(function(){var f,n,u;if(arguments.length==0){r.resolve("");return}for(f=[],n=0;n<arguments.length;++n)f.push(arguments[n]);u=f.join(" "+t+" ");i&&(u="("+u+")");r.resolve(u)},function(n){r.reject(n)}),r.promise()}};i=new t;n.getConditionManager=function(){return i}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.RelatedToObjectNpc="Npc";n.RelatedToObjectItem="Item";n.RelatedToObjectQuest="Quest";n.RelatedToObjectSkill="Skill";n.BaseCondition=function(){this.nodeModel=null};n.BaseCondition.prototype={getType:function(){return-1},getLabel:function(){},canBeSelected:function(){},getTemplateName:function(){},buildConditionData:function(){},serializeConditionData:function(){},getConditionDependsOnObject:function(){},getConditionString:function(){}}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){t.GroupConditionType=1;t.GroupConditionOperatorAnd=0;t.GroupConditionOperatorOr=1;t.GroupCondition=function(){t.BaseCondition.apply(this)};t.GroupCondition.prototype=jQuery.extend({},t.BaseCondition.prototype);t.GroupCondition.prototype.getType=function(){return t.GroupConditionType};t.GroupCondition.prototype.getLabel=function(){return""};t.GroupCondition.prototype.canBeSelected=function(){return!1};t.GroupCondition.prototype.getTemplateName=function(){return"gn-nodeConditionGroup"};t.GroupCondition.prototype.buildConditionData=function(i,r){var u={operator:new ko.observable(i.operator),conditionElements:new ko.observableArray},f,e;if(i.fromDialog)u.conditionElements(i.conditionElements);else{for(f=t.getConditionManager().convertElements(i.conditionElements),e=0;e<f.length;++e)f[e].parent=r;u.conditionElements(f)}return u.operatorText=new ko.computed(function(){return u.operator()==t.GroupConditionOperatorAnd?n.Localization.Conditions.AndOperator:n.Localization.Conditions.OrOperator}),u.toggleOperator=function(){u.operator()==t.GroupConditionOperatorAnd?u.operator(t.GroupConditionOperatorOr):u.operator(t.GroupConditionOperatorAnd)},u};t.GroupCondition.prototype.serializeConditionData=function(n){for(var f,r={operator:n.operator(),conditionElements:[]},u=n.conditionElements(),i=0;i<u.length;++i)f=t.getConditionManager().serializeConditionElement(u[i]),r.conditionElements.push(f);return r};t.GroupCondition.prototype.getConditionDependsOnObject=function(n){return t.getConditionManager().getConditionElementsDependsOnObject(n.conditionElements)};t.GroupCondition.prototype.getConditionString=function(i){return t.getConditionManager().getConditionString(i.conditionElements,i.operator==t.GroupConditionOperatorAnd?n.Localization.Conditions.AndOperatorShort:n.Localization.Conditions.OrOperatorShort,!0)};t.getConditionManager().addConditionType(new t.GroupCondition)})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.CheckValueCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this);this.fieldObjectId=""};i.CheckValueCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckValueCondition.prototype=jQuery.extend(i.CheckValueCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckValueCondition.prototype.getTemplateName=function(){return"gn-nodeConditionValueCheck"};i.CheckValueCondition.prototype.canBeSelected=function(){return!0};i.CheckValueCondition.prototype.processAditionalLoadedObjectConditionData=function(){};i.CheckValueCondition.prototype.getSelectedField=function(n,t){for(var r=null,i=0;i<t.length;++i)if(t[i].id==n.fieldId&&(r=t[i],t[i].name==n.fieldName))break;return r};i.CheckValueCondition.prototype.buildConditionDataNoLoad=function(t){var i={selectedField:new ko.observable,operator:new ko.observable,compareValue:new ko.observable,availableFields:new ko.observable};return t&&i.compareValue(t.compareValue?t.compareValue:null),i.validateInput=function(t,r){if(i.selectedField().fieldType!=n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber)return!0;return n.Util.validateNumberKeyPress(r.target,r)},i.availableOperators=new ko.computed(function(){if(!this.selectedField())return[];var t=["=","!=","contains","startsWith","endsWith"];return this.selectedField().fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber&&(t=["=","!=","<=","<",">=",">"]),t},i),i.selectedField.subscribe(function(){if(i.selectedField().fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber){var t=parseFloat(i.compareValue());isNaN(t)&&i.compareValue("0")}}),i};i.CheckValueCondition.prototype.buildConditionData=function(n,t){var i=this.buildConditionDataNoLoad(n,t);return this.canLoadFieldObject(n)&&this.loadAndParseFields(i,n,t),i};i.CheckValueCondition.prototype.canLoadFieldObject=function(){return!0};i.CheckValueCondition.prototype.loadAndParseFields=function(i,r,u){var f=this;this.loadObjectShared(r).then(function(u){var e,o,s,h;if(u){for(f.fieldObjectId=u.id,e=n.Util.getFilteredFieldsForScript(u.fields),o=0;o<e.length;++o)s=e[o].name+" (",s+=e[o].fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber?t.Localization.Conditions.NumberField:t.Localization.Conditions.TextField,s+=")",e[o].displayName=s;i.availableFields(e);r&&(h=f.getSelectedField(r,e),h&&i.selectedField(h),i.operator(r.operator?r.operator:null));f.processAditionalLoadedObjectConditionData(i,u)}},function(){u.errorOccured(!0)})};i.CheckValueCondition.prototype.serializeConditionData=function(n){return{fieldId:n.selectedField()?n.selectedField().id:null,fieldName:n.selectedField()?n.selectedField().name:null,operator:n.operator(),compareValue:n.compareValue()?n.compareValue():null}};i.CheckValueCondition.prototype.getDependsOnObjectId=function(){return this.fieldObjectId};i.CheckValueCondition.prototype.getConditionDependsOnObject=function(n){var t=this.getDependsOnObjectId(n);return[{objectType:this.getObjectTypeName(),objectId:t}]};i.CheckValueCondition.prototype.getObjectTypeName=function(){};i.CheckValueCondition.prototype.getObjectTitle=function(){};i.CheckValueCondition.prototype.getConditionString=function(i){var r=new jQuery.Deferred,u;return!this.canLoadFieldObject(i)||i.fieldId==null?(r.resolve(t.Localization.Conditions.MissingInformations),r.promise()):(u=this,this.loadObjectShared(i).then(function(f){var s,e;if(u.fieldObjectId=f.id,s=n.Util.getFilteredFieldsForScript(f.fields),e=u.getSelectedField(i,s),!e){r.reject(t.Localization.Conditions.FieldWasDeleted);return}var o=u.getObjectTitle(f)+'("'+e.name+'") '+i.operator+" ",h=e.fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber,c="0";h||(o+='"',c="");o+=i.compareValue?i.compareValue:c;h||(o+='"');r.resolve(o)},function(){r.reject()}),r.promise())}})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){t.CheckChooseObjectValueCondition=function(){n.Conditions.CheckValueCondition.apply(this)};t.CheckChooseObjectValueCondition.prototype=jQuery.extend({},n.Conditions.CheckValueCondition.prototype);t.CheckChooseObjectValueCondition.prototype.openObjectSearchDialog=function(){};t.CheckChooseObjectValueCondition.prototype.getChooseObjectLabel=function(){};t.CheckChooseObjectValueCondition.prototype.getTemplateName=function(){return"gn-nodeConditionChooseObjectValueCheck"};t.CheckChooseObjectValueCondition.prototype.canLoadFieldObject=function(n){return n&&n.selectedObjectId};t.CheckChooseObjectValueCondition.prototype.processAditionalLoadedObjectConditionData=function(n,t){n.selectedObjectName(t.name)};t.CheckChooseObjectValueCondition.prototype.getDependsOnObjectId=function(n){return this.getObjectId(n)};t.CheckChooseObjectValueCondition.prototype.getObjectId=function(n){return n.selectedObjectId};t.CheckChooseObjectValueCondition.prototype.buildConditionData=function(n,i){var r=t.CheckValueCondition.prototype.buildConditionDataNoLoad.apply(this,[n,i]),u;return r.selectedObjectId=new ko.observable(""),r.selectedObjectName=new ko.observable(this.getChooseObjectLabel()),n&&r.selectedObjectId(n.selectedObjectId),u=this,r.chooseObject=function(){u.openObjectSearchDialog().then(function(n){r.selectedObjectId(n.id);r.selectedObjectName(n.name);var t=u.serializeConditionData(r);u.loadAndParseFields(r,t,i)})},this.canLoadFieldObject(n)&&this.loadAndParseFields(r,n,i),r};t.CheckChooseObjectValueCondition.prototype.serializeConditionData=function(n){var i=t.CheckValueCondition.prototype.serializeConditionData.apply(this,[n]);return i.selectedObjectId=n.selectedObjectId(),i}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=11;i.CheckSkillValueCondition=function(){n.DefaultNodeShapes.Conditions.CheckValueCondition.apply(this)};i.CheckSkillValueCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.CheckValueCondition.prototype);i.CheckSkillValueCondition.prototype.getType=function(){return r};i.CheckSkillValueCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckSkillValueLabel};i.CheckSkillValueCondition.prototype.getObjectTitle=function(){return t.Localization.Conditions.SkillLabel};i.CheckSkillValueCondition.prototype.getObjectTypeName=function(){return"Skill"};i.CheckSkillValueCondition.prototype.getObjectId=function(){return t.getCurrentSkillId()};i.CheckSkillValueCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceSkill};i.CheckSkillValueCondition.prototype.loadObject=function(){var n=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/EvneApi/FlexFieldObject?id="+t.getCurrentSkillId(),type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckSkillValueCondition)})(t.Conditions=t.Conditions||{})})(n.Evne=n.Evne||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=2;i.CheckPlayerValueCondition=function(){n.DefaultNodeShapes.Conditions.CheckValueCondition.apply(this)};i.CheckPlayerValueCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.CheckValueCondition.prototype);i.CheckPlayerValueCondition.prototype.getType=function(){return r};i.CheckPlayerValueCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckPlayerValueLabel};i.CheckPlayerValueCondition.prototype.getObjectTitle=function(){return t.Localization.Conditions.PlayerLabel};i.CheckPlayerValueCondition.prototype.getObjectTypeName=function(){return"Npc"};i.CheckPlayerValueCondition.prototype.getObjectId=function(){return"PlayerNpc"};i.CheckPlayerValueCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceNpc};i.CheckPlayerValueCondition.prototype.loadObject=function(){var n=new jQuery.Deferred,t=this;return jQuery.ajax({url:"/api/KortistoApi/PlayerNpc",type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckPlayerValueCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=7;i.CheckChooseQuestValueCondition=function(){t.Conditions.CheckChooseObjectValueCondition.apply(this)};i.CheckChooseQuestValueCondition.prototype=jQuery.extend({},t.Conditions.CheckChooseObjectValueCondition.prototype);i.CheckChooseQuestValueCondition.prototype.getType=function(){return r};i.CheckChooseQuestValueCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckChooseQuestValueLabel};i.CheckChooseQuestValueCondition.prototype.getObjectTitle=function(n){return n.name};i.CheckChooseQuestValueCondition.prototype.openObjectSearchDialog=function(){return n.DefaultNodeShapes.openQuestSearchDialog()};i.CheckChooseQuestValueCondition.prototype.getChooseObjectLabel=function(){return t.Localization.Conditions.ChooseQuestLabel};i.CheckChooseQuestValueCondition.prototype.getObjectTypeName=function(){return i.RelatedToObjectQuest};i.CheckChooseQuestValueCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.CheckChooseQuestValueCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise()};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckChooseQuestValueCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=8;i.CheckQuestStateCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.CheckQuestStateCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckQuestStateCondition.prototype=jQuery.extend(i.CheckQuestStateCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckQuestStateCondition.prototype.getTemplateName=function(){return"gn-nodeQuestStateCheck"};i.CheckQuestStateCondition.prototype.canBeSelected=function(){return!0};i.CheckQuestStateCondition.prototype.getType=function(){return r};i.CheckQuestStateCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckQuestStateLabel};i.CheckQuestStateCondition.prototype.getConditionDependsOnObject=function(n){return n.questId?[{objectType:i.RelatedToObjectQuest,objectId:n.questId}]:[]};i.CheckQuestStateCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceQuest};i.CheckQuestStateCondition.prototype.getObjectId=function(n){return n.questId};i.CheckQuestStateCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/AikaApi/GetQuest?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t};i.CheckQuestStateCondition.prototype.buildConditionData=function(i,r){var u={selectedQuestId:new ko.observable,selectedQuestName:new ko.observable(t.Localization.Conditions.ChooseQuestLabel),selectedQuestState:new ko.observable,questStates:t.Shapes.getQuestStates()};return u.chooseQuest=function(){n.DefaultNodeShapes.openQuestSearchDialog().then(function(n){u.selectedQuestId(n.id);u.selectedQuestName(n.name)})},i&&(u.selectedQuestId(i.questId),u.selectedQuestState(i.state),i.questId&&this.loadObjectShared(i).then(function(n){u.selectedQuestName(n.name)},function(){r.errorOccured(!0)})),u};i.CheckQuestStateCondition.prototype.serializeConditionData=function(n){return{questId:n.selectedQuestId(),state:n.selectedQuestState()}};i.CheckQuestStateCondition.prototype.getConditionString=function(n){var i=new jQuery.Deferred,r;return n.questId?(r=this,this.loadObjectShared(n).then(function(r){var u=t.Localization.Conditions.StateLabel+"("+r.name+") = "+t.Shapes.getQuestStateLabel(n.state);i.resolve(u)},function(){i.reject()}),i.promise()):(i.resolve(t.Localization.Conditions.MissingInformations),i.promise())};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckQuestStateCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var e=9,u=0,f=1,r={};r[u]=t.Localization.Conditions.NpcAliveStateAlive;r[f]=t.Localization.Conditions.NpcAliveStateDead;i.CheckNpcAliveStateCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this)};i.CheckNpcAliveStateCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckNpcAliveStateCondition.prototype=jQuery.extend(i.CheckNpcAliveStateCondition.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.CheckNpcAliveStateCondition.prototype.getTemplateName=function(){return"gn-nodeNpcAliveStateCheck"};i.CheckNpcAliveStateCondition.prototype.canBeSelected=function(){return!0};i.CheckNpcAliveStateCondition.prototype.getType=function(){return e};i.CheckNpcAliveStateCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckNpcAliveStateLabel};i.CheckNpcAliveStateCondition.prototype.getConditionDependsOnObject=function(n){return n.npcId?[{objectType:i.RelatedToObjectNpc,objectId:n.npcId}]:[]};i.CheckNpcAliveStateCondition.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceNpc};i.CheckNpcAliveStateCondition.prototype.getObjectId=function(n){return n.npcId};i.CheckNpcAliveStateCondition.prototype.loadObject=function(n){var t=new jQuery.Deferred;return jQuery.ajax({url:"/api/KortistoApi/FlexFieldObject?id="+n,type:"GET"}).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t};i.CheckNpcAliveStateCondition.prototype.createState=function(n){return{npcState:n,label:r[n]}};i.CheckNpcAliveStateCondition.prototype.buildConditionData=function(i,r){var e={selectedNpcId:new ko.observable,selectedNpcName:new ko.observable(t.Localization.Conditions.ChooseNpcLabel),selectedNpcState:new ko.observable,npcStates:[this.createState(u),this.createState(f)]};return e.chooseNpc=function(){n.DefaultNodeShapes.openNpcSearchDialog().then(function(n){e.selectedNpcId(n.id);e.selectedNpcName(n.name)})},i&&(e.selectedNpcId(i.npcId),e.selectedNpcState(i.state),i.npcId&&this.loadObjectShared(i).then(function(n){e.selectedNpcName(n.name)},function(){r.errorOccured(!0)})),e};i.CheckNpcAliveStateCondition.prototype.serializeConditionData=function(n){return{npcId:n.selectedNpcId(),state:n.selectedNpcState()}};i.CheckNpcAliveStateCondition.prototype.getConditionString=function(n){var i=new jQuery.Deferred,u;return n.npcId?(u=this,this.loadObjectShared(n).then(function(u){var f=t.Localization.Conditions.StateLabel+"("+u.name+") = "+r[n.state];i.resolve(f)},function(){i.reject()}),i.promise()):(i.resolve(t.Localization.Conditions.MissingInformations),i.promise())};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckNpcAliveStateCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var e=12,u=0,f=1,r={};r[u]=t.Localization.Conditions.GameTimeOperatorBefore;r[f]=t.Localization.Conditions.GameTimeOperatorAfter;i.CheckGameTimeCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this)};i.CheckGameTimeCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);i.CheckGameTimeCondition.prototype.getTemplateName=function(){return"gn-nodeGameTimeCheck"};i.CheckGameTimeCondition.prototype.canBeSelected=function(){return!0};i.CheckGameTimeCondition.prototype.getType=function(){return e};i.CheckGameTimeCondition.prototype.getLabel=function(){return t.Localization.Conditions.CheckGameTimeLabel};i.CheckGameTimeCondition.prototype.getConditionDependsOnObject=function(){return[]};i.CheckGameTimeCondition.prototype.createTimeOperator=function(n){return{operator:n,label:r[n]}};i.CheckGameTimeCondition.prototype.buildConditionData=function(n){for(var i,r,t,o=[],e=0;e<24;++e)o.push(e);for(i=[],r=0;r<60;r+=5)i.push(r);return i.push(59),t={selectedGameTimeOperator:new ko.observable,selectedGameTimeHour:new ko.observable,selectedGameTimeMinutes:new ko.observable,gameTimeOperators:[this.createTimeOperator(u),this.createTimeOperator(f)],gameTimeHours:o,gameTimeMinutes:i},n&&(t.selectedGameTimeOperator(n.operator),t.selectedGameTimeHour(n.hour),t.selectedGameTimeMinutes(n.minutes)),t};i.CheckGameTimeCondition.prototype.serializeConditionData=function(n){return{operator:n.selectedGameTimeOperator(),hour:n.selectedGameTimeHour(),minutes:n.selectedGameTimeMinutes()}};i.CheckGameTimeCondition.prototype.getConditionString=function(n){var u=new jQuery.Deferred,i=t.Localization.Conditions.GameTime;return i+=" "+r[n.operator],i+=" "+this.formatTwoDigits(n.hour)+":"+this.formatTwoDigits(n.minutes),u.resolve(i),u.promise()};i.CheckGameTimeCondition.prototype.formatTwoDigits=function(n){if(!n)return"00";var t=n.toString();return t.length<2&&(t="0"+t),t};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new i.CheckGameTimeCondition)})(t.Conditions=t.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){function c(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:r,icon:"glyphicon-question-sign",size:{width:u,height:f},inPorts:["input"],outPorts:[],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"},".outPorts circle":{magnet:"true"}},conditions:[],currentConditionId:0},joint.shapes.default.Base.prototype.defaults)})}function l(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<span class="gn-nodeLoading" style="display: none"><i class="glyphicon glyphicon-refresh spinning"><\/i><\/span>','<span class="gn-nodeError text-danger" style="display: none" title="'+n.DefaultNodeShapes.Localization.ErrorOccured+'"><i class="glyphicon glyphicon-warning-sign"><\/i><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<button class="gn-nodeAddCondition gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.Conditions.AddCondition+'">+<\/button>',"<\/div>",].join(""),additionalCallbackButtons:{"gn-nodeAddCondition":function(){this.addCondition()}},initialize:function(){_.bindAll(this,"addCondition");joint.shapes.default.BaseView.prototype.initialize.apply(this,arguments);this.model.on("change:conditions",this.syncConditions,this);this.model.get("conditions").length==0?this.addCondition():this.syncConditions()},addCondition:function(n){var t=n,i;t||(t={id:this.model.get("currentConditionId"),conditionElements:[]},this.model.set("currentConditionId",this.model.get("currentConditionId")+1));i=(this.model.get("conditions")||{}).slice();i.push(t);this.model.set("conditions",i)},moveCondition:function(n,t){for(var u,f,i=(this.model.get("conditions")||{}).slice(),r=0;r<i.length;++r)if(i[r].id==n){u=r+t;u>=0&&u<i.length&&(f=i[r],i[r]=i[u],i[u]=f,this.model.set("conditions",i));return}},deleteCondition:function(n){for(var t=(this.model.get("conditions")||{}).slice(),i=0;i<t.length;++i)if(t[i].id==n){t.splice(i,1);this.model.set("conditions",t);return}},openConditionDialog:function(n){for(var u,r=(this.model.get("conditions")||{}).slice(),i=0;i<r.length;++i)if(r[i].id==n){u=this;t.openConditionDialog(r[i]).then(function(){u.syncConditions()});return}},syncConditions:function(){for(var s,i,n,o=[],c=this.model.get("conditions"),r=0;r<c.length;++r)o.push("condition"+c[r].id);for(o.push("else"),this.model.set("outPorts",o),s=[],i=this,this.model.set("size",{width:u,height:f+o.length*e}),n="<table class='gn-nodeConditionTable'>",jQuery.each(c,function(r,u){var f=i.buildConditionString(u,s);f=jQuery("<div><\/div>").text(f).html();n+="<tr>";n+="<td class='gn-nodeConditionTableConditionCell'><a class='gn-clickable gn-nodeNonClickableOnReadonly' data-conditionid='"+u.id+"'>"+f+"<\/a><\/td>";n+="<td class='gn-nodeDeleteOnReadonly'><i class='glyphicon glyphicon-arrow-up gn-nodeMoveConditionUp gn-nodeConditionIcon' data-conditionid='"+u.id+"' title='"+t.Localization.Conditions.MoveConditionUp+"'><\/i><\/td>";n+="<td class='gn-nodeDeleteOnReadonly'><i class='glyphicon glyphicon-arrow-down gn-nodeMoveConditionDown gn-nodeConditionIcon' data-conditionid='"+u.id+"' title='"+t.Localization.Conditions.MoveConditionDown+"'><\/i><\/td>";n+="<td class='gn-nodeDeleteOnReadonly'><i class='glyphicon glyphicon-trash gn-nodeDeleteCondition gn-nodeConditionIcon' data-conditionid='"+u.id+"' title='"+t.Localization.Conditions.DeleteCondition+"'><\/i><\/td>";n+="<\/tr>"}),n+="<tr>",n+="<td class='gn-nodeConditionTableConditionCell'>"+t.Localization.Conditions.Else+"<\/td>",n+="<\/tr>",n+="<\/table>",this.$box.find(".gn-nodeConditionTable").length>0?this.$box.find(".gn-nodeConditionTable").replaceWith(n):this.$box.append(n),this.hideError(),s.length>0&&(this.showLoading(),jQuery.when.apply(jQuery,s).then(function(){i.hideLoading()},function(){i.hideLoading();i.showError()})),r=0;r<o.length;++r)this.model.attr(".outPorts>.port"+r,{"ref-y":h+e*r+"px",ref:".body"});this.$box.find(".gn-nodeMoveConditionUp").on("click",function(){i.moveCondition(jQuery(this).data("conditionid"),-1)});this.$box.find(".gn-nodeMoveConditionDown").on("click",function(){i.moveCondition(jQuery(this).data("conditionid"),1)});this.$box.find(".gn-nodeDeleteCondition").on("click",function(){i.deleteCondition(jQuery(this).data("conditionid"))});this.$box.find(".gn-nodeConditionTableConditionCell a").on("click",function(){i.openConditionDialog(jQuery(this).data("conditionid"))})},buildConditionString:function(i,r){var u="",e=this,f,o;return i.conditionElements&&i.conditionElements.length>0?(u=t.Localization.Conditions.LoadingConditionText,f=".gn-nodeConditionTableConditionCell>a[data-conditionid='"+i.id+"']",o=n.DefaultNodeShapes.Conditions.getConditionManager().getConditionString(i.conditionElements,n.DefaultNodeShapes.Localization.Conditions.AndOperatorShort,!1),o.then(function(n){n?e.$box.find(f).attr("title",n):n=t.Localization.Conditions.EditCondition;e.$box.find(f).text(n);u=n},function(n){var i=t.Localization.Conditions.ErrorLoadingConditionText;n&&(i+=": "+n);e.$box.find(f).text(i);e.$box.find(f).attr("title",i);u=i}),r.push(o)):u=t.Localization.Conditions.EditCondition,u},reloadSharedLoadedData:function(t,i){for(var s,u,f,e=this.model.get("conditions"),o=[],r=0;r<e.length;++r)for(s=n.DefaultNodeShapes.Conditions.getConditionManager().getConditionElementsDependsOnObject(e[r].conditionElements),u=0;u<s.length;++u)s[u].objectId==i&&this.buildConditionString(e[r],o);this.hideError();o.length>0&&(this.showLoading(),f=this,jQuery.when.apply(jQuery,o).then(function(){f.hideLoading()},function(){f.hideLoading();f.showError()}))},showLoading:function(){this.$box.find(".gn-nodeLoading").show()},hideLoading:function(){this.$box.find(".gn-nodeLoading").hide()},showError:function(){this.$box.find(".gn-nodeError").show()},hideError:function(){this.$box.find(".gn-nodeError").hide()}})}var o;t.openConditionDialog||(t.openConditionDialog=function(){var n=new jQuery.Deferred;return n.reject("Not implemented"),n.promise()});var r="default.Condition",s="condition",u=350,f=50,e=66,h=76;joint.shapes.default=joint.shapes.default||{};joint.shapes.default.Condition=c();joint.shapes.default.ConditionView=l();i.ConditionSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.default.Condition,r,s])};i.ConditionSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);i.ConditionSerializer.prototype.serialize=function(t){for(var u,r=[],i=0;i<t.conditions.length;++i)u=n.DefaultNodeShapes.Conditions.getConditionManager().serializeCondition(t.conditions[i]),r.push(u);return{id:t.id,x:t.position.x,y:t.position.y,conditions:r,currentConditionId:t.currentConditionId}};i.ConditionSerializer.prototype.deserialize=function(t){for(var u,f,t,r=[],i=0;i<t.conditions.length;++i)u=n.DefaultNodeShapes.Conditions.getConditionManager().deserializeCondition(t.conditions[i]),r.push(u);return f={id:t.id,position:{x:t.x,y:t.y},conditions:r,currentConditionId:t.currentConditionId},t=new this.classType(f),t};o=new i.ConditionSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(o)})(t.Shapes=t.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.ConditionDialog=function(){this.isOpen=new ko.observable(!1);this.condition=null;this.closingDeferred=null;this.conditionElements=new ko.observableArray;this.showGroupWarning=new ko.observable(!1);this.showDragParentToChildWarning=new ko.observable(!1);this.warningHideTimeout=null;this.selectableConditionTypes=n.getConditionManager().getSelectableConditionTypes()};n.ConditionDialog.prototype={openDialog:function(t,i){this.condition=t;this.closingDeferred=i;this.conditionElements(n.getConditionManager().convertElements(t.conditionElements));this.conditionElements().length==0&&this.addNewConditionElement();this.isOpen(!0)},addNewConditionElement:function(){var t=n.getConditionManager().createEmptyElement();this.conditionElements.push(t)},andGroupElements:function(){this.groupElements(n.GroupConditionOperatorAnd)},orGroupElements:function(){this.groupElements(n.GroupConditionOperatorOr)},groupElements:function(t){var i,o,f,u,e,r;if(this.showGroupWarning(!1),i=[],this.collectSelectedElements(i,this.conditionElements()),!(i.length<2)){for(r=1;r<i.length;++r)if(i[0].parent!=i[r].parent){this.displayWarning(this.showGroupWarning);return}for(o={conditionType:n.GroupConditionType,conditionData:{fromDialog:!0,operator:t,conditionElements:i}},f=n.getConditionManager().convertElement(o),f.parent=i[0].parent,u=this.conditionElements,i[0].parent&&(u=i[0].parent.conditionData().conditionElements),e=u.indexOf(i[0]),u.removeAll(i),e<u().length?u.splice(e,0,f):u.push(f),r=0;r<i.length;++r)i[r].parent=f,i[r].isSelected(!1)}},collectSelectedElements:function(n,t){for(var i=0;i<t.length;++i)t[i].isSelected()&&n.push(t[i]),t[i].conditionData().conditionElements&&this.collectSelectedElements(n,t[i].conditionData().conditionElements())},moveConditionElementUp:function(n){this.moveSingleConditionElement(n,-1)},moveConditionElementDown:function(n){this.moveSingleConditionElement(n,1)},moveSingleConditionElement:function(n,t){var r=null,e;r=n.parent?n.parent.conditionData().conditionElements:this.conditionElements;var f=r.indexOf(n),u=f+t,i=r();u>=0&&u<i.length&&(e=i[f],i[f]=i[u],i[u]=e,r.valueHasMutated())},dropConditionToGroup:function(n,t){if(t.parent!=n){for(var i=n?n.parent:null;i!=null;){if(i==t){this.displayWarning(this.showDragParentToChildWarning);return}i=i.parent}t.parent?(t.parent.conditionData().conditionElements.remove(t),t.parent.conditionData().conditionElements().length<2&&this.deleteConditionElement(t.parent)):this.conditionElements.remove(t);n?n.conditionData().conditionElements.push(t):this.conditionElements.push(t);t.parent=n}},displayWarning:function(n){this.warningHideTimeout&&(clearTimeout(this.warningHideTimeout),this.showGroupWarning(!1),this.showDragParentToChildWarning(!1));n(!0);this.warningHideTimeout=setTimeout(function(){n(!1)},5e3)},deleteConditionElement:function(n){if(n.conditionData().conditionElements){var t=n.conditionData().conditionElements();n.parent&&n.parent.conditionData().conditionElements?this.moveConditionElements(t,n.parent.conditionData().conditionElements,n.parent,n):this.moveConditionElements(t,this.conditionElements,null,n)}n.parent&&n.parent.conditionData().conditionElements?(n.parent.conditionData().conditionElements.remove(n),n.parent.conditionData().conditionElements().length<2&&this.deleteConditionElement(n.parent)):this.conditionElements.remove(n)},moveConditionElements:function(n,t,i,r){for(var f=t.indexOf(r),u=0;u<n.length;++u)n[u].parent=i,f<t().length?t.splice(f+u,0,n[u]):t.push(n[u])},getConditionTemplate:function(t){return t?n.getConditionManager().getConditionTemplate(t.conditionType()):"gn-nodeConditionEmpty"},isConditionTypeSelectable:function(t){return t?n.getConditionManager().isConditionTypeSelectable(t.conditionType()):!0},saveCondition:function(){for(var i=[],r=this.conditionElements(),t=0;t<r.length;++t)i.push(n.getConditionManager().serializeConditionElement(r[t]));this.condition.conditionElements=i;this.closingDeferred&&this.closingDeferred.resolve();this.closeDialog()},closeDialog:function(){this.condition=null;this.closingDeferred=null;this.isOpen(!1)}}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){function e(n){var t=new jQuery.Deferred;return jQuery.ajax("/api/TaleApi/GetNodeConfigByKey?configKey="+encodeURIComponent(n)).done(function(i){var u,f,r;if(!i){t.resolve();return}try{for(u=JSON.parse(i),f=jQuery("<datalist id='gn-"+n+"'><\/datalist>"),r=0;r<u.length;++r)f.append(jQuery("<option><\/option>").text(u[r]));jQuery("body").append(f);t.resolve()}catch(e){self.errorOccured(!0);t.reject()}}).fail(function(){t.reject()}),t.promise()}function o(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:r,icon:"glyphicon-cog",size:{width:250,height:200},inPorts:["input"],outPorts:["output"],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"},".outPorts circle":{magnet:"true"}},actionType:null,actionRelatedToObjectType:null,actionRelatedToObjectId:null,actionData:null},joint.shapes.default.Base.prototype.defaults)})}function s(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<span class="gn-nodeLoading" style="display: none"><i class="glyphicon glyphicon-refresh spinning"><\/i><\/span>','<span class="gn-nodeError text-danger" style="display: none" title="'+n.DefaultNodeShapes.Localization.ErrorOccured+'"><i class="glyphicon glyphicon-warning-sign"><\/i><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<select class="gn-actionNodeSelectActionType"><\/select>','<div class="gn-actionNodeActionContent"><\/div>',"<\/div>",].join(""),initialize:function(){var t,r;joint.shapes.default.BaseView.prototype.initialize.apply(this,arguments);t=this.$box.find(".gn-actionNodeSelectActionType");n.Util.fillSelectFromArray(t,i,function(n){return n.getType()},function(n){return n.getLabel()});r=this;t.on("change",function(){r.resetActionData();r.syncActionData()});t.find("option[value='"+this.model.get("actionType")+"']").prop("selected",!0);this.syncActionData()},getCurrentAction:function(){for(var t=this.$box.find(".gn-actionNodeSelectActionType").val(),n=0;n<i.length;++n)if(i[n].getType()==t)return i[n];return null},resetActionData:function(){this.model.set("actionRelatedToObjectType",null);this.model.set("actionRelatedToObjectId",null);this.model.set("actionData",null)},syncActionData:function(){var i=this.getCurrentAction(),n,t;if(i){n=i.buildAction();n.setNodeModel(this.model);this.model.set("actionType",n.getType());t=this.$box.find(".gn-actionNodeActionContent");t.html(n.getContent());n.onInitialized(t,this)}},reloadSharedLoadedData:function(n,t){this.model.get("actionRelatedToObjectId")==t&&this.syncActionData()},showLoading:function(){this.$box.find(".gn-nodeLoading").show()},hideLoading:function(){this.$box.find(".gn-nodeLoading").hide()},showError:function(){this.$box.find(".gn-nodeError").show()},hideError:function(){this.$box.find(".gn-nodeError").hide()}})}var r="default.Action",f="action",i=[],u;t.addAvailableAction=function(n){i.push(n)};t.loadConfigLists=function(){for(var n,r={},u=[],t=0;t<i.length;++t)n=i[t].getConfigKey(),n&&!r[n]&&(r[n]=!0,u.push(e(n)));return jQuery.when.apply(jQuery,u)};joint.shapes.default=joint.shapes.default||{};joint.shapes.default.Action=o();joint.shapes.default.ActionView=s();t.ActionSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.default.Action,r,f])};t.ActionSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);t.ActionSerializer.prototype.serialize=function(n){return{id:n.id,x:n.position.x,y:n.position.y,actionType:n.actionType,actionRelatedToObjectType:n.actionRelatedToObjectType,actionRelatedToObjectId:n.actionRelatedToObjectId,actionData:n.actionData}};t.ActionSerializer.prototype.deserialize=function(n){var t={id:n.id,position:{x:n.x,y:n.y},actionType:n.actionType,actionRelatedToObjectType:n.actionRelatedToObjectType,actionRelatedToObjectId:n.actionRelatedToObjectId,actionData:n.actionData},n=new this.classType(t);return n};u=new t.ActionSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(u)})(t.Shapes=t.Shapes||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.RelatedToObjectNpc="Npc";n.RelatedToObjectQuest="Quest";n.RelatedToObjectSkill="Skill";n.RelatedToObjectItem="Item";n.BaseAction=function(){this.nodeModel=null};n.BaseAction.prototype={buildAction:function(){},setNodeModel:function(n){this.nodeModel=n},getType:function(){return-1},getLabel:function(){},getContent:function(){},getConfigKey:function(){return null},onInitialized:function(){},serialize:function(){},deserialize:function(){}}})(n.Actions=n.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.ChangeValueAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this);n.DefaultNodeShapes.Shapes.SharedObjectLoading.apply(this);this.contentElement=null;this.filteredFields=[];this.isNumberValueSelected=!1};i.ChangeValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.ChangeValueAction.prototype=jQuery.extend(i.ChangeValueAction.prototype,n.DefaultNodeShapes.Shapes.SharedObjectLoading.prototype);i.ChangeValueAction.prototype.getObjectTypeName=function(){};i.ChangeValueAction.prototype.getContent=function(){return"<select class='gn-actionNodeAttributeSelect'><\/select><select class='gn-actionNodeAttributeOperator'><\/select><input type='text' class='gn-actionNodeAttributeChange'/>"};i.ChangeValueAction.prototype.isUsingIndividualObjectId=function(){return!1};i.ChangeValueAction.prototype.getObjectId=function(){return null};i.ChangeValueAction.prototype.canLoadObject=function(){return!0};i.ChangeValueAction.prototype.onInitializeAdditional=function(){};i.ChangeValueAction.prototype.onInitialized=function(t,i){var r,u;this.contentElement=t;this.deserializePreLoadData();this.canLoadObject()&&this.loadFields(t,i);r=this;t.find(".gn-actionNodeAttributeSelect").on("change",function(){r.syncOperators();r.saveData()});t.find(".gn-actionNodeAttributeOperator").on("change",function(){r.saveData()});u=t.find(".gn-actionNodeAttributeChange");u.keydown(function(t){r.isNumberValueSelected&&n.Util.validateNumberKeyPress(u,t)});u.change(function(){r.isNumberValueSelected&&r.ensureNumberValue();r.saveData()});this.onInitializeAdditional(t,i)};i.ChangeValueAction.prototype.parseAdditionalData=function(){};i.ChangeValueAction.prototype.loadFields=function(i,r){r.showLoading();r.hideError();var u=this;this.loadObjectShared().then(function(f){var e,o;if(!f){r.hideLoading();return}u.nodeModel.set("actionRelatedToObjectType",u.getObjectTypeName());u.nodeModel.set("actionRelatedToObjectId",f.id);e=i.find(".gn-actionNodeAttributeSelect");u.filteredFields=n.Util.getFilteredFieldsForScript(f.fields);n.Util.fillSelectFromArray(e,u.filteredFields,function(n,t){return t},function(i){var r=i.name+" (";return r+=i.fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber?t.Localization.Actions.NumberField:t.Localization.Actions.TextField,r+")"});u.parseAdditionalData(i,r,f);o=u.deserializeData();o||(u.syncOperators(),u.saveData());r.hideLoading()},function(){r.hideLoading();r.showError()})};i.ChangeValueAction.prototype.syncOperators=function(){var u=this.contentElement.find(".gn-actionNodeAttributeSelect").val(),i=this.contentElement.find(".gn-actionNodeAttributeOperator"),r=this.filteredFields[u],t;if(!r){n.Util.fillSelectFromArray(i,[],function(n){return n},function(n){return n});return}t=[];r.fieldType==n.FlexFieldDatabase.ObjectForm.FlexFieldTypeNumber?(t=["=","+=","-=","*=","/="],this.isNumberValueSelected=!0,this.ensureNumberValue()):(t=["="],this.isNumberValueSelected=!1);n.Util.fillSelectFromArray(i,t,function(n){return n},function(n){return n})};i.ChangeValueAction.prototype.ensureNumberValue=function(){var n=parseFloat(this.contentElement.find(".gn-actionNodeAttributeChange").val());isNaN(n)&&this.contentElement.find(".gn-actionNodeAttributeChange").val("0")};i.ChangeValueAction.prototype.deserializePreLoadData=function(){};i.ChangeValueAction.prototype.deserializeData=function(){var r=this.nodeModel.get("actionData"),t,i,n;if(!r)return!1;for(t=JSON.parse(r),i=0,n=0;n<this.filteredFields.length;++n)if(this.filteredFields[n].id==t.fieldId&&(i=n,this.filteredFields[n].name==t.fieldName))break;return this.contentElement.find(".gn-actionNodeAttributeSelect").find("option[value='"+i+"']").prop("selected",!0),this.syncOperators(),this.contentElement.find(".gn-actionNodeAttributeOperator").find("option[value='"+t.operator+"']").prop("selected",!0),this.contentElement.find(".gn-actionNodeAttributeChange").val(t.valueChange),!0};i.ChangeValueAction.prototype.serializeAdditionalData=function(){};i.ChangeValueAction.prototype.saveData=function(){var i=this.contentElement.find(".gn-actionNodeAttributeSelect").val(),n=this.filteredFields[i],r=this.contentElement.find(".gn-actionNodeAttributeOperator").val(),u=this.contentElement.find(".gn-actionNodeAttributeChange").val(),t={fieldId:n?n.id:null,fieldName:n?n.name:null,operator:r,valueChange:u};this.serializeAdditionalData(t);this.nodeModel.set("actionData",JSON.stringify(t))}})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ChangeValueChooseObjectAction=function(){n.DefaultNodeShapes.Actions.ChangeValueAction.apply(this)};t.ChangeValueChooseObjectAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeValueAction.prototype);t.ChangeValueChooseObjectAction.prototype.getContent=function(){return"<div class='gn-actionNodeObjectSelectContainer'><a class='gn-actionNodeObjectSelect gn-clickable'>"+this.getChooseLabel()+"<\/a><\/div><select class='gn-actionNodeAttributeSelect'><\/select><select class='gn-actionNodeAttributeOperator'><\/select><input type='text' class='gn-actionNodeAttributeChange'/>"};t.ChangeValueChooseObjectAction.prototype.getChooseLabel=function(){return"NOT IMPLEMENTED"};t.ChangeValueChooseObjectAction.prototype.isUsingIndividualObjectId=function(){return!0};t.ChangeValueChooseObjectAction.prototype.getObjectId=function(){return this.nodeModel.get("objectId")};t.ChangeValueChooseObjectAction.prototype.canLoadObject=function(){return!!this.nodeModel.get("objectId")};t.ChangeValueChooseObjectAction.prototype.openSearchDialog=function(){};t.ChangeValueChooseObjectAction.prototype.parseAdditionalData=function(n,t,i){n.find(".gn-actionNodeObjectSelect").text(i.name)};t.ChangeValueChooseObjectAction.prototype.onInitializeAdditional=function(n,t){var i=this;n.find(".gn-actionNodeObjectSelect").on("click",function(){i.openSearchDialog().then(function(r){i.nodeModel.set("objectId",r.id);i.loadFields(n,t);n.find(".gn-actionNodeObjectSelect").text(r.name)})})};t.ChangeValueChooseObjectAction.prototype.serializeAdditionalData=function(n){n.objectId=this.nodeModel.get("objectId")?this.nodeModel.get("objectId"):null};t.ChangeValueChooseObjectAction.prototype.deserializePreLoadData=function(){var n=this.nodeModel.get("actionData"),t;n&&(t=JSON.parse(n),this.nodeModel.set("objectId",t.objectId))}})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=13;i.ChangeCurrentSkillValueAction=function(){n.DefaultNodeShapes.Actions.ChangeValueAction.apply(this)};i.ChangeCurrentSkillValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeValueAction.prototype);i.ChangeCurrentSkillValueAction.prototype.buildAction=function(){return new i.ChangeCurrentSkillValueAction};i.ChangeCurrentSkillValueAction.prototype.getType=function(){return r};i.ChangeCurrentSkillValueAction.prototype.getLabel=function(){return t.Localization.Actions.ChangeCurrentSkillValueLabel};i.ChangeCurrentSkillValueAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectSkill};i.ChangeCurrentSkillValueAction.prototype.getObjectId=function(){return t.getCurrentSkillId()};i.ChangeCurrentSkillValueAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceSkill};i.ChangeCurrentSkillValueAction.prototype.loadObject=function(){var n=new jQuery.Deferred,i=this;return jQuery.ajax({url:"/api/EvneApi/FlexFieldObject?id="+t.getCurrentSkillId(),type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.ChangeCurrentSkillValueAction)})(t.Actions=t.Actions||{})})(n.Evne=n.Evne||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=1;i.ChangePlayerValueAction=function(){n.DefaultNodeShapes.Actions.ChangeValueAction.apply(this)};i.ChangePlayerValueAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.ChangeValueAction.prototype);i.ChangePlayerValueAction.prototype.buildAction=function(){return new i.ChangePlayerValueAction};i.ChangePlayerValueAction.prototype.getType=function(){return r};i.ChangePlayerValueAction.prototype.getLabel=function(){return t.Localization.Actions.ChangePlayerValueLabel};i.ChangePlayerValueAction.prototype.getObjectTypeName=function(){return i.RelatedToObjectNpc};i.ChangePlayerValueAction.prototype.getObjectId=function(){return"PlayerNpc"};i.ChangePlayerValueAction.prototype.getObjectResource=function(){return n.DefaultNodeShapes.Shapes.ObjectResourceNpc};i.ChangePlayerValueAction.prototype.loadObject=function(){var n=new jQuery.Deferred,t=this;return jQuery.ajax({url:"/api/KortistoApi/PlayerNpc",type:"GET"}).done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise()};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.ChangePlayerValueAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.SetObjectStateAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this)};i.SetObjectStateAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.SetObjectStateAction.prototype.getContent=function(){return"<input type='text' class='gn-nodeActionObjectState' placeholder='"+t.Localization.Actions.StatePlaceholder+"' list='gn-SetNpcStateAction'/>"};i.SetObjectStateAction.prototype.onInitialized=function(n){this.contentElement=n;this.deserializeData();var t=this,i=n.find(".gn-nodeActionObjectState");i.change(function(){t.saveData()})};i.SetObjectStateAction.prototype.deserializeData=function(){var n=this.nodeModel.get("actionData"),t;if(!n)return"";t=JSON.parse(n);this.contentElement.find(".gn-nodeActionObjectState").val(t.objectState)};i.SetObjectStateAction.prototype.saveData=function(){var n=this.contentElement.find(".gn-nodeActionObjectState").val(),t={objectState:n};this.nodeModel.set("actionData",JSON.stringify(t))};i.SetObjectStateAction.prototype.buildAction=function(){return new i.SetObjectStateAction};i.SetObjectStateAction.prototype.getType=function(){return-1};i.SetObjectStateAction.prototype.getLabel=function(){return""};i.SetObjectStateAction.prototype.getConfigKey=function(){return"SetNpcStateAction"}})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=15;i.SetPlayerStateAction=function(){n.DefaultNodeShapes.Actions.SetObjectStateAction.apply(this)};i.SetPlayerStateAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.SetObjectStateAction.prototype);i.SetPlayerStateAction.prototype.buildAction=function(){return new i.SetPlayerStateAction};i.SetPlayerStateAction.prototype.getType=function(){return r};i.SetPlayerStateAction.prototype.getLabel=function(){return t.Localization.Actions.SetPlayerStateLabel};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.SetPlayerStateAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var r=16;i.SetTargetNpcStateAction=function(){n.DefaultNodeShapes.Actions.SetObjectStateAction.apply(this)};i.SetTargetNpcStateAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.SetObjectStateAction.prototype);i.SetTargetNpcStateAction.prototype.buildAction=function(){return new i.SetTargetNpcStateAction};i.SetTargetNpcStateAction.prototype.getType=function(){return r};i.SetTargetNpcStateAction.prototype.getLabel=function(){return t.Localization.Actions.SetTargetNpcStateLabel};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.SetTargetNpcStateAction)})(t.Actions=t.Actions||{})})(n.Evne=n.Evne||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){var f=14,e=0,r=1,o=0,s=1,u=2,h=3,c=4;i.WaitAction=function(){n.DefaultNodeShapes.Actions.BaseAction.apply(this)};i.WaitAction.prototype=jQuery.extend({},n.DefaultNodeShapes.Actions.BaseAction.prototype);i.WaitAction.prototype.getContent=function(){return"<input type='text' class='gn-actionNodeWaitAmount'/><select class='gn-actionNodeWaitType'><\/select><select class='gn-actionNodeWaitUnit'><\/select>"};i.WaitAction.prototype.onInitialized=function(i){var s,o,u,f;this.contentElement=i;this.contentElement.find(".gn-actionNodeWaitAmount").val("0");s=[{label:t.Localization.Actions.WaitTypeRealTime,value:e},{label:t.Localization.Actions.WaitTypeGameTime,value:r}];o=i.find(".gn-actionNodeWaitType");n.Util.fillSelectFromArray(o,s,function(n){return n.value},function(n){return n.label});u=this;o.on("change",function(){u.syncTimeUnits();u.serialize()});this.syncTimeUnits();i.find(".gn-actionNodeWaitUnit").on("change",function(){u.serialize()});f=i.find(".gn-actionNodeWaitAmount");f.keydown(function(t){n.Util.validateNumberKeyPress(f,t)});f.change(function(){u.isNumberValueSelected&&u.ensureNumberValue();u.serialize()});this.deserialize()};i.WaitAction.prototype.syncTimeUnits=function(){var i=[{label:t.Localization.Actions.WaitUnitMilliseconds,value:o},{label:t.Localization.Actions.WaitUnitSeconds,value:s},{label:t.Localization.Actions.WaitUnitMinutes,value:u}];this.contentElement.find(".gn-actionNodeWaitType").val()==r&&(i=[{label:t.Localization.Actions.WaitUnitMinutes,value:u},{label:t.Localization.Actions.WaitUnitHours,value:h},{label:t.Localization.Actions.WaitUnitDays,value:c}]);n.Util.fillSelectFromArray(this.contentElement.find(".gn-actionNodeWaitUnit"),i,function(n){return n.value},function(n){return n.label})};i.WaitAction.prototype.ensureNumberValue=function(){var n=parseFloat(this.contentElement.find(".gn-actionNodeWaitAmount").val());isNaN(n)&&this.contentElement.find(".gn-actionNodeWaitAmount").val("0")};i.WaitAction.prototype.deserialize=function(){var t=this.nodeModel.get("actionData"),n;if(!t)return"";n=JSON.parse(t);this.contentElement.find(".gn-actionNodeWaitAmount").val(n.waitAmount);this.contentElement.find(".gn-actionNodeWaitType").find("option[value='"+n.waitType+"']").prop("selected",!0);this.syncTimeUnits();this.contentElement.find(".gn-actionNodeWaitUnit").find("option[value='"+n.waitUnit+"']").prop("selected",!0)};i.WaitAction.prototype.serialize=function(){var n=parseFloat(this.contentElement.find(".gn-actionNodeWaitAmount").val());isNaN(n)&&(n=0);var t=this.contentElement.find(".gn-actionNodeWaitType").val(),i=this.contentElement.find(".gn-actionNodeWaitUnit").val(),r={waitAmount:n,waitType:t,waitUnit:i};this.nodeModel.set("actionData",JSON.stringify(r))};i.WaitAction.prototype.buildAction=function(){return new i.WaitAction};i.WaitAction.prototype.getType=function(){return f};i.WaitAction.prototype.getLabel=function(){return t.Localization.Actions.WaitLabel};n.DefaultNodeShapes.Shapes.addAvailableAction(new i.WaitAction)})(t.Actions=t.Actions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){function e(){return joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:r,icon:"glyphicon-text-background",size:{width:250,height:150},inPorts:["input"],outPorts:["output"],attrs:{".inPorts circle":{magnet:"passive","port-type":"input"},".outPorts circle":{magnet:"true"}},text:""},joint.shapes.default.Base.prototype.defaults)})}function o(){return joint.shapes.default.BaseView.extend({template:['<div class="node">','<span class="label"><i class="nodeIcon glyphicon"><\/i><span class="labelText"><\/span><\/span>','<button class="delete gn-nodeDeleteOnReadonly cornerButton" title="'+n.DefaultNodeShapes.Localization.DeleteNode+'">x<\/button>','<textarea class="nodeText" placeholder="'+t.Localization.TextNode.Text+'" />',"<\/div>",].join("")})}var r="evne.Text",f="text",u;joint.shapes.evne=joint.shapes.evne||{};joint.shapes.evne.Text=e();joint.shapes.evne.TextView=o();i.TextSerializer=function(){n.DefaultNodeShapes.Serialize.BaseNodeSerializer.apply(this,[joint.shapes.evne.Text,r,f])};i.TextSerializer.prototype=jQuery.extend({},n.DefaultNodeShapes.Serialize.BaseNodeSerializer.prototype);i.TextSerializer.prototype.serialize=function(n){return{id:n.id,x:n.position.x,y:n.position.y,text:n.nodeText}};i.TextSerializer.prototype.deserialize=function(n){var t={id:n.id,position:{x:n.x,y:n.y},nodeText:n.text},n=new this.classType(t);return n};u=new i.TextSerializer;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().addNodeSerializer(u)})(t.Skill=t.Skill||{})})(n.Evne=n.Evne||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(i){i.ViewModel=function(){n.DefaultNodeShapes.BaseViewModel.apply(this);n.FlexFieldDatabase.ObjectForm.BaseViewModel.apply(this,["/Evne","EvneApi","EvneSkill","EvneTemplate","GetPagesBySkill?skillId=",null]);this.conditionDialog=new n.DefaultNodeShapes.Conditions.ConditionDialog;this.chooseObjectDialog=new n.ChooseObjectDialog.ViewModel;this.isSkillFlowExpanded=new ko.observable(!1);this.loadedGraph=null;this.learnedByNpcs=new ko.observableArray;this.loadingLearnedByNpcs=new ko.observable(!1);this.errorLoadingLearnedByNpcs=new ko.observable(!1);this.init();var i=this;t.getCurrentSkillId=function(){return i.id()};n.DefaultNodeShapes.openConditionDialog=function(n){var t,r;return i.isReadonly()?(t=new jQuery.Deferred,t.reject(),t.promise()):(r=new jQuery.Deferred,i.conditionDialog.openDialog(n,r),r)};n.DefaultNodeShapes.openQuestSearchDialog=function(){if(i.isReadonly()){var n=new jQuery.Deferred;return n.reject(),n.promise()}return i.chooseObjectDialog.openQuestSearch(t.Localization.SkillViewModel.ChooseQuest)};n.DefaultNodeShapes.openNpcSearchDialog=function(){if(i.isReadonly()){var n=new jQuery.Deferred;return n.reject(),n.promise()}return i.chooseObjectDialog.openNpcSearch(t.Localization.SkillViewModel.ChooseNpc)};n.DefaultNodeShapes.Shapes.loadConfigLists().fail(function(){i.errorOccured(!0)})};i.ViewModel.prototype=jQuery.extend({},n.DefaultNodeShapes.BaseViewModel.prototype);i.ViewModel.prototype=jQuery.extend(i.ViewModel.prototype,n.FlexFieldDatabase.ObjectForm.BaseViewModel.prototype);i.ViewModel.prototype.toogleSkillFlowVisibility=function(){this.isSkillFlowExpanded(!this.isSkillFlowExpanded());this.isSkillFlowExpanded()&&this.loadedGraph&&(this.parseGraph(this.loadedGraph),this.loadedGraph=null)};i.ViewModel.prototype.parseAdditionalData=function(n){this.isSkillFlowExpanded()?this.parseGraph(n):this.loadedGraph=n};i.ViewModel.prototype.parseGraph=function(t){var i=this;n.DefaultNodeShapes.Serialize.getNodeSerializerInstance().deserializeGraph(this.nodeGraph(),t,function(n){i.setupNewNode(n)});this.isReadonly()&&this.setGraphToReadonly()};i.ViewModel.prototype.setAdditionalSaveData=function(t){var f=n.DefaultNodeShapes.Serialize.getNodeSerializerInstance(),i=f.serializeGraph(this.nodeGraph()),r,u;if(this.loadedGraph){i={};for(r in this.loadedGraph)f.hasDeserializerForArray(r)&&(i[r]=this.loadedGraph[r])}for(u in i)i.hasOwnProperty(u)&&(t[u]=i[u]);return t};i.ViewModel.prototype.runAfterSave=function(){this.reloadFieldsForNodes(n.DefaultNodeShapes.Shapes.ObjectResourceSkill,this.id());n.BindingHandlers.nodeGraphRefreshPositionZoomUrl()};i.ViewModel.prototype.loadAdditionalDependencies=function(){n.FlexFieldDatabase.ObjectForm.hasKortistoRights&&!this.isTemplateMode()&&this.loadNpcsByLearnedSkill()};i.ViewModel.prototype.openCompareDialogForObject=function(){return this.compareDialog.openSkillCompare(this.id(),this.objectName())};i.ViewModel.prototype.setAdditionalDataToReadonly=function(){this.setGraphToReadonly()};i.ViewModel.prototype.loadNpcsByLearnedSkill=function(){this.loadingLearnedByNpcs(!0);this.errorLoadingLearnedByNpcs(!1);var n=this;jQuery.ajax({url:"/api/KortistoApi/GetNpcsByLearnedSkill?skillId="+this.id(),type:"GET"}).done(function(t){n.learnedByNpcs(t);n.loadingLearnedByNpcs(!1)}).fail(function(){n.errorLoadingLearnedByNpcs(!0);n.loadingLearnedByNpcs(!1)})};i.ViewModel.prototype.buildNpcSkillUrl=function(n){return"/Kortisto/Npc?id="+n.id}})(t.Skill=t.Skill||{})})(n.Evne=n.Evne||{})}(window.GoNorth=window.GoNorth||{});