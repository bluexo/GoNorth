(function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){this.maps=new ko.observableArray;this.errorOccured=new ko.observable(!1);this.showMapCreateEditDialog=new ko.observable(!1);this.hasMapImageInQueue=new ko.observable(!1);this.createEditName=new ko.observable("");this.createEditDialogError=new ko.observable;this.mapImageIsMissing=new ko.observable(!1);this.dialogLoading=new ko.observable(!1);this.editMapId=new ko.observable("");this.clearMapFiles=null;this.processMapQueue=null;this.createEditUrl=new ko.computed(function(){var n=this.editMapId(),t=this.createEditName();return n?"/api/KartaApi/UpdateMap?id="+n+"&name="+encodeURIComponent(t):"/api/KartaApi/CreateMap?name="+encodeURIComponent(t)},this);this.showConfirmDeleteDialog=new ko.observable(!1);this.deleteError=new ko.observable("");this.deleteMapId="";this.loadMaps()};t.ViewModel.prototype={loadMaps:function(){this.errorOccured(!1);var n=this;jQuery.ajax({url:"/api/KartaApi/Maps"}).done(function(t){n.maps(t)}).fail(function(){n.errorOccured(!0)})},receiveDropzoneTriggers:function(n,t){this.clearMapFiles=n;this.processMapQueue=t},mapImageAdded:function(){this.hasMapImageInQueue(!0);this.mapImageIsMissing(!1)},openCreateMapDialog:function(){this.showMapCreateEditDialog(!0);this.editMapId("");this.createEditName("");this.resetSharedMapDialogValues()},openEditMapDialog:function(n){this.showMapCreateEditDialog(!0);this.editMapId(n.id);this.createEditName(n.name);this.resetSharedMapDialogValues()},resetSharedMapDialogValues:function(){this.createEditDialogError("");this.clearMapFiles();this.hasMapImageInQueue(!1);this.mapImageIsMissing(!1);n.Util.setupValidation("#gn-mapCreateEditForm")},closeCreateEditMapDialog:function(){this.showMapCreateEditDialog(!1)},saveMap:function(){var n=!1;(this.hasMapImageInQueue()||this.editMapId()||(this.mapImageIsMissing(!0),n=!0),jQuery("#gn-mapCreateEditForm").valid()&&!n)&&(this.dialogLoading(!0),!this.editMapId()||this.hasMapImageInQueue()?this.processMapQueue():this.renameMap())},mapSaveSuccess:function(){this.loadMaps();this.dialogLoading(!1);this.closeCreateEditMapDialog()},mapSaveError:function(n,t){this.dialogLoading(!1);t&&t.responseText?this.createEditDialogError(t.responseText):this.createEditDialogError(n)},renameMap:function(){this.dialogLoading(!0);var t=this;jQuery.ajax({url:"/api/KartaApi/RenameMap?id="+this.editMapId()+"&name="+encodeURIComponent(this.createEditName()),headers:n.Util.generateAntiForgeryHeader(),type:"POST"}).done(function(){t.closeCreateEditMapDialog();t.dialogLoading(!1);t.loadMaps()}).fail(function(n){t.dialogLoading(!1);t.deleteError(n.responseText)})},buildMapUrl:function(n){return"/Karta?id="+n.id},openDeleteMapDialog:function(n){this.showConfirmDeleteDialog(!0);this.deleteError("");this.deleteMapId=n.id},deleteMap:function(){var t=this;this.dialogLoading(!0);jQuery.ajax({url:"/api/KartaApi/DeleteMap?id="+this.deleteMapId,headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.closeConfirmDeleteDialog();t.dialogLoading(!1);t.loadMaps()}).fail(function(n){t.dialogLoading(!1);t.deleteError(n.responseText)})},closeConfirmDeleteDialog:function(){this.showConfirmDeleteDialog(!1)}}})(t.ManageMaps=t.ManageMaps||{})})(n.Karta=n.Karta||{})})(window.GoNorth=window.GoNorth||{});