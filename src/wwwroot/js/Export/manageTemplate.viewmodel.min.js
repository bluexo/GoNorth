(function(n){"use strict";(function(){typeof ko!="undefined"&&(ko.bindingHandlers.codeEditor={init:function(n,t,i){var r,u,f;if(ace.require("ace/ext/language_tools"),r=t(),u=null,i.get("codeEditorTheme")&&(u=ko.unwrap(i.get("codeEditorTheme"))),u||(u="ace/theme/monokai"),f=null,i.get("codeEditorMode")&&(f=ko.unwrap(i.get("codeEditorMode"))),f||(f="ace/mode/lua"),r._editor=ace.edit(n),r._editor.setTheme(u),r._editor.session.setMode(f),r._editor.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),ko.isObservable(r))r._editor.session.on("change",function(){r._blockUpdate=!0;try{r(r._editor.getValue());r._blockUpdate=!1}catch(n){r._blockUpdate=!1}})},update:function(n,t,i){var u=t(),e=u._blockUpdate,f=u,r;ko.isObservable(f)&&(f=f());r=i.get("codeEditorReadonly");r&&(r=ko.unwrap(r),u._editor.setReadOnly(r));e||u._editor.session.setValue(f)}})})(n.BindingHandlers=n.BindingHandlers||{})})(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){var i,t;this.templateType=parseInt(n.Util.getParameterFromUrl("templateType"));this.customizedObjectId=new ko.observable("");i=n.Util.getParameterFromUrl("customizedObjectId");i&&this.customizedObjectId(i);this.customizedObjectIsTemplate=new ko.observable(!1);n.Util.getParameterFromUrl("objectIsTemplate")&&this.customizedObjectIsTemplate(!0);this.templateLabel=new ko.observable("");this.templateCode=new ko.observable("");this.arePlaceholdersExpanded=new ko.observable(!1);this.templatePlaceholders=new ko.observableArray;this.customizedObjectTemplateIsDefault=new ko.observable(!1);this.parentTemplateId=new ko.observable("");this.parentTemplateUrl=new ko.computed(function(){var n="/Export/ManageTemplate?templateType="+this.templateType;return this.parentTemplateId()&&(n+="&customizedObjectId="+this.parentTemplateId()+"&objectIsTemplate=1"),n},this);this.customizedChildTemplates=new ko.observableArray;this.showConfirmTemplateDeleteDialog=new ko.observable(!1);this.isLoading=new ko.observable(!1);this.isLoadingPlaceholders=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.isReadonly=new ko.observable(!1);this.lockedByUser=new ko.observable("");isNaN(this.templateType)?this.errorOccured(!0):(this.loadTemplatePlaceholders(),this.initTemplateData());t=this;n.Util.onUrlParameterChanged(function(){var i=n.Util.getParameterFromUrl("customizedObjectId");i?t.customizedObjectId(i):t.customizedObjectId("");n.Util.getParameterFromUrl("objectIsTemplate")?t.customizedObjectIsTemplate(!0):t.customizedObjectIsTemplate(!1);n.LockService.releaseCurrentLock();t.initTemplateData()})};t.ViewModel.prototype={initTemplateData:function(){this.acquireLock();this.loadDefaultTemplateData()},loadDefaultTemplateData:function(){var t="/api/ExportApi/GetDefaultTemplateByType?templateType="+this.templateType,n;this.customizedObjectId()&&(t="/api/ExportApi/GetExportTemplateByObjectId?id="+this.customizedObjectId()+"&templateType="+this.templateType);this.isLoading(!0);this.errorOccured(!1);n=this;jQuery.ajax({url:t,type:"GET"}).done(function(t){n.isLoading(!1);n.customizedObjectId()?(n.customizedObjectTemplateIsDefault(t.isDefaultCode),n.parentTemplateId(t.exportTemplate.template.customizedObjectId),t=t.exportTemplate,t.isDefaultCode||n.loadChildCustomizedTemplates()):(n.customizedObjectTemplateIsDefault(!1),n.loadChildCustomizedTemplates());n.templateLabel(t.label);n.templateCode(t.template.code)}).fail(function(){n.isLoading(!1);n.errorOccured(!0)})},loadTemplatePlaceholders:function(){this.isLoadingPlaceholders(!0);var n=this;jQuery.ajax({url:"/api/ExportApi/GetTemplatePlaceholders?templateType="+this.templateType,type:"GET"}).done(function(t){n.templatePlaceholders(t);n.isLoadingPlaceholders(!1)}).fail(function(){n.isLoadingPlaceholders(!1);n.errorOccured(!0)})},save:function(){var i="/api/ExportApi/SaveDefaultExportTemplate?templateType="+this.templateType,t;this.customizedObjectId()&&(i="/api/ExportApi/SaveExportTemplateByObjectId?id="+this.customizedObjectId()+"&templateType="+this.templateType);this.isLoading(!0);this.errorOccured(!1);t=this;jQuery.ajax({headers:n.Util.generateAntiForgeryHeader(),url:i,type:"POST",data:JSON.stringify(this.templateCode()),contentType:"application/json"}).done(function(){t.customizedObjectTemplateIsDefault(!1);t.isLoading(!1)}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})},tooglePlaceholderVisibility:function(){this.arePlaceholdersExpanded(!this.arePlaceholdersExpanded())},openDeleteTemplateDialog:function(){this.showConfirmTemplateDeleteDialog(!0)},closeDeleteTemplateDialog:function(){this.showConfirmTemplateDeleteDialog(!1)},deleteTemplate:function(){if(this.customizedObjectId()){this.isLoading(!0);this.errorOccured(!1);var t=this;jQuery.ajax({url:"/api/ExportApi/DeleteExportTemplateByObjectId?id="+this.customizedObjectId(),headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.closeDeleteTemplateDialog();t.redirectToObjectPage()}).fail(function(){t.isLoading(!1);t.errorOccured(!0);t.closeDeleteTemplateDialog()})}},redirectToObjectPage:function(){n.Export.ManageTemplate.templateTypeMapping[this.templateType]||(window.location="/Export");var t=n.Export.ManageTemplate.templateTypeMapping[this.templateType].replace("{0}",this.customizedObjectId());this.customizedObjectIsTemplate()&&(t+="&template=1");window.location=t},loadChildCustomizedTemplates:function(){var t="/api/ExportApi/GetCustomizedTemplatesByType?templateType="+this.templateType,n;this.customizedObjectId()&&(t="/api/ExportApi/GetCustomizedTemplatesByParentObject?customizedObjectId="+this.customizedObjectId()+"&templateType="+this.templateType);this.isLoading(!0);this.errorOccured(!1);n=this;jQuery.ajax({url:t,type:"GET"}).done(function(t){n.customizedChildTemplates(t);n.isLoading(!1)}).fail(function(){n.isLoading(!1);n.errorOccured(!0)})},buildChildTemplateUrl:function(t){if(!n.Export.ManageTemplate.templateTypeMapping[this.templateType])return"";var i=n.Export.ManageTemplate.templateTypeMapping[this.templateType].replace("{0}",t.objectId);return t.isObjectTemplate&&(i+="&template=1"),i},acquireLock:function(){var t=this;n.LockService.acquireLock("ExportTemplate",this.templateType).done(function(n,i){n&&(t.isReadonly(!0),t.lockedByUser(i))}).fail(function(){t.errorOccured(!0);t.isReadonly(!0)})}}})(t.ManageTemplate=t.ManageTemplate||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{});