(function(n){"use strict";(function(n){(function(n){var t=function(){this.availableConditionTypes=[]},i;t.prototype={addConditionType:function(n){this.availableConditionTypes.push(n)},getConditionTypes:function(){return this.availableConditionTypes},getSelectableConditionTypes:function(){for(var t=[],n=0;n<this.availableConditionTypes.length;++n)this.availableConditionTypes[n].canBeSelected()&&t.push(this.availableConditionTypes[n]);return t},getConditionTemplate:function(n){var t=this.getConditionType(n);return t?t.getTemplateName():"gn-nodeConditionEmpty"},isConditionTypeSelectable:function(n){var t=this.getConditionType(n);return t?t.canBeSelected():!0},buildConditionData:function(n,t,i){i.errorOccured(!1);var r=this.getConditionType(n);return r?r.buildConditionData(t,i):null},serializeCondition:function(t){return{id:t.id,dependsOnObjects:n.getConditionManager().getConditionElementsDependsOnObject(t.conditionElements),conditionElements:JSON.stringify(t.conditionElements)}},deserializeCondition:function(n){return{id:n.id,conditionElements:JSON.parse(n.conditionElements)}},serializeConditionElement:function(n){var t=this.getConditionType(n.conditionType());return t?{conditionType:n.conditionType(),conditionData:t.serializeConditionData(n.conditionData())}:null},getConditionElementsDependsOnObject:function(t){for(var r,i,f,e={},o=[],u=0;u<t.length;++u)for(r=n.getConditionManager().getConditionElementDependsOnObject(t[u].conditionType,t[u].conditionData),i=0;i<r.length;++i)f=r[i].objectType+"|"+r[i].objectId,e[f]||(o.push(r[i]),e[f]=!0);return o},getConditionElementDependsOnObject:function(n,t){var i=this.getConditionType(n);return i?i.getConditionDependsOnObject(t):[]},getConditionType:function(n){for(var t=0;t<this.availableConditionTypes.length;++t)if(this.availableConditionTypes[t].getType()==n)return this.availableConditionTypes[t];return null},convertElements:function(n){for(var r,i=[],t=0;t<n.length;++t)r=this.convertElement(n[t]),i.push(r);return i},convertElement:function(n){var t={isSelected:new ko.observable(!1),conditionType:new ko.observable(n.conditionType),conditionData:new ko.observable(null),conditionTemplate:new ko.observable("gn-nodeConditionEmpty"),parent:null,errorOccured:new ko.observable(!1)};return t.conditionData(this.buildConditionData(n.conditionType,n.conditionData,t)),t.conditionTemplate(this.getConditionTemplate(n.conditionType)),this.addSharedFunctions(t),t},createEmptyElement:function(){var n={isSelected:new ko.observable(!1),conditionType:new ko.observable(""),conditionData:new ko.observable(null),conditionTemplate:new ko.observable("gn-nodeConditionEmpty"),parent:null,errorOccured:new ko.observable(!1)};return this.addSharedFunctions(n),n},addSharedFunctions:function(n){var t=this;n.conditionType.subscribe(function(){n.conditionTemplate("gn-nodeConditionEmpty");n.conditionData(t.buildConditionData(n.conditionType(),null,n));n.conditionTemplate(t.getConditionTemplate(n.conditionType()))})},getConditionString:function(n,t,i){for(var e,r=new jQuery.Deferred,f=[],u=0;u<n.length;++u)e=this.getConditionType(n[u].conditionType),f.push(e.getConditionString(n[u].conditionData));return jQuery.when.apply(jQuery,f).then(function(){var f,n,u;if(arguments.length==0){r.resolve("");return}for(f=[],n=0;n<arguments.length;++n)f.push(arguments[n]);u=f.join(" "+t+" ");i&&(u="("+u+")");r.resolve(u)},function(n){r.reject(n)}),r.promise()}};i=new t;n.getConditionManager=function(){return i}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})})(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.RelatedToObjectNpc="Npc";n.RelatedToObjectItem="Item";n.RelatedToObjectQuest="Quest";n.RelatedToObjectSkill="Skill";n.BaseCondition=function(){this.nodeModel=null};n.BaseCondition.prototype={getType:function(){return-1},getLabel:function(){},canBeSelected:function(){},getTemplateName:function(){},buildConditionData:function(){},serializeConditionData:function(){},getConditionDependsOnObject:function(){},getConditionString:function(){}}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(t){t.GroupConditionType=1;t.GroupConditionOperatorAnd=0;t.GroupConditionOperatorOr=1;t.GroupCondition=function(){t.BaseCondition.apply(this)};t.GroupCondition.prototype=jQuery.extend({},t.BaseCondition.prototype);t.GroupCondition.prototype.getType=function(){return t.GroupConditionType};t.GroupCondition.prototype.getLabel=function(){return""};t.GroupCondition.prototype.canBeSelected=function(){return!1};t.GroupCondition.prototype.getTemplateName=function(){return"gn-nodeConditionGroup"};t.GroupCondition.prototype.buildConditionData=function(i,r){var u={operator:new ko.observable(i.operator),conditionElements:new ko.observableArray},f,e;if(i.fromDialog)u.conditionElements(i.conditionElements);else{for(f=t.getConditionManager().convertElements(i.conditionElements),e=0;e<f.length;++e)f[e].parent=r;u.conditionElements(f)}return u.operatorText=new ko.computed(function(){return u.operator()==t.GroupConditionOperatorAnd?n.Localization.Conditions.AndOperator:n.Localization.Conditions.OrOperator}),u.toggleOperator=function(){u.operator()==t.GroupConditionOperatorAnd?u.operator(t.GroupConditionOperatorOr):u.operator(t.GroupConditionOperatorAnd)},u};t.GroupCondition.prototype.serializeConditionData=function(n){for(var f,r={operator:n.operator(),conditionElements:[]},u=n.conditionElements(),i=0;i<u.length;++i)f=t.getConditionManager().serializeConditionElement(u[i]),r.conditionElements.push(f);return r};t.GroupCondition.prototype.getConditionDependsOnObject=function(n){return t.getConditionManager().getConditionElementsDependsOnObject(n.conditionElements)};t.GroupCondition.prototype.getConditionString=function(i){return t.getConditionManager().getConditionString(i.conditionElements,i.operator==t.GroupConditionOperatorAnd?n.Localization.Conditions.AndOperatorShort:n.Localization.Conditions.OrOperatorShort,!0)};t.getConditionManager().addConditionType(new t.GroupCondition)})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.convertConditionElementsFromDialog=function(t){for(var u,f,r,e=[],i=0;i<t.length;++i){if((u=n.DefaultNodeShapes.Conditions.getConditionManager().getConditionType(t[i].conditionType),f=n.Export.FunctionGenerationCondition.conditionTypesByName[u.getExportApiType()],typeof f=="undefined")||(r=u.convertDataForExportApi(t[i].conditionData),r==null))return null;r.conditionType=f;e.push(r)}return e};t.convertConditionElementsToDialog=function(t){for(var h,e,r,f,o,c,s={},u=n.DefaultNodeShapes.Conditions.getConditionManager().getConditionTypes(),i=0;i<u.length;++i)u[i].getExportApiType&&(h=n.Export.FunctionGenerationCondition.conditionTypesByName[u[i].getExportApiType()],s[h]=u[i]);for(e=[],r=0;r<t.length;++r){if((f=s[t[r].conditionType],!f)||(o=f.convertDataForDialog(t[r]),!o))return null;c={conditionType:f.getType(),conditionData:o};e.push(c)}return e}})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){n.DefaultNodeShapes.Conditions.GroupCondition.prototype.getExportApiType=function(){return"Group"};n.DefaultNodeShapes.Conditions.GroupCondition.prototype.convertDataForExportApi=function(n){var i=t.convertConditionElementsFromDialog(n.conditionElements);return i?{groupOperator:n.operator,conditionElements:i}:null};n.DefaultNodeShapes.Conditions.GroupCondition.prototype.convertDataForDialog=function(n){var i=t.convertConditionElementsToDialog(n.conditionElements);return i?{operator:n.groupOperator,conditionElements:i}:null}})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){var i=2;t.MultipleParentsCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this)};t.MultipleParentsCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);t.MultipleParentsCondition.prototype.getTemplateName=function(){return"gn-functionGenerationCondition-multipleParents"};t.MultipleParentsCondition.prototype.canBeSelected=function(){return!0};t.MultipleParentsCondition.prototype.getType=function(){return i};t.MultipleParentsCondition.prototype.getLabel=function(){return n.Export.FunctionGenerationCondition.Localization.ConditionMultipleParents};t.MultipleParentsCondition.prototype.getConditionDependsOnObject=function(){return[]};t.MultipleParentsCondition.prototype.buildConditionData=function(){return{}};t.MultipleParentsCondition.prototype.serializeConditionData=function(){return{}};t.MultipleParentsCondition.prototype.getConditionString=function(){var t=new jQuery.Deferred;return t.resolve(n.Export.FunctionGenerationCondition.Localization.ConditionMultipleParents),t.promise()};t.MultipleParentsCondition.prototype.getExportApiType=function(){return"MultipleParents"};t.MultipleParentsCondition.prototype.convertDataForExportApi=function(){return{}};t.MultipleParentsCondition.prototype.convertDataForDialog=function(){return{}};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new t.MultipleParentsCondition)})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.CheckNodeTypeCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this)};t.CheckNodeTypeCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);t.CheckNodeTypeCondition.prototype.getTemplateName=function(){return"gn-functionGenerationCondition-nodeType"};t.CheckNodeTypeCondition.prototype.canBeSelected=function(){return!0};t.CheckNodeTypeCondition.prototype.getConditionDependsOnObject=function(){return[]};t.CheckNodeTypeCondition.prototype.buildConditionData=function(t){var i={selectedNodeType:new ko.observable,nodeTypes:n.Export.FunctionGenerationCondition.nodeTypes},u,r;if(t){for(u=null,r=0;r<i.nodeTypes.length;++r)i.nodeTypes[r].nodeType==t.nodeType&&(u=i.nodeTypes[r]);i.selectedNodeType(u)}return i};t.CheckNodeTypeCondition.prototype.serializeConditionData=function(n){return{nodeType:n.selectedNodeType().nodeType}};t.CheckNodeTypeCondition.prototype.getConditionString=function(t){var i=new jQuery.Deferred;return i.resolve(this.getLabel()+"("+n.Export.FunctionGenerationCondition.localizedNodeTypes[t.nodeType]+")"),i.promise()};t.CheckNodeTypeCondition.prototype.getExportApiType=function(){return""};t.CheckNodeTypeCondition.prototype.convertDataForExportApi=function(n){return{nodeType:n.nodeType}};t.CheckNodeTypeCondition.prototype.convertDataForDialog=function(n){return{nodeType:n.nodeType}}})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){var i=3;t.ParentNodeTypeCondition=function(){t.CheckNodeTypeCondition.apply(this)};t.ParentNodeTypeCondition.prototype=jQuery.extend({},t.CheckNodeTypeCondition.prototype);t.ParentNodeTypeCondition.prototype.getType=function(){return i};t.ParentNodeTypeCondition.prototype.getLabel=function(){return n.Export.FunctionGenerationCondition.Localization.ConditionParentNodeType};t.ParentNodeTypeCondition.prototype.getExportApiType=function(){return"ParentNodeType"};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new t.ParentNodeTypeCondition)})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){var i=4;t.CurrentNodeTypeCondition=function(){t.CheckNodeTypeCondition.apply(this)};t.CurrentNodeTypeCondition.prototype=jQuery.extend({},t.CheckNodeTypeCondition.prototype);t.CurrentNodeTypeCondition.prototype.getType=function(){return i};t.CurrentNodeTypeCondition.prototype.getLabel=function(){return n.Export.FunctionGenerationCondition.Localization.ConditionCurrentNodeType};t.CurrentNodeTypeCondition.prototype.getExportApiType=function(){return"CurrentNodeType"};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new t.CurrentNodeTypeCondition)})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){var i=5;t.ChildNodeTypeCondition=function(){t.CheckNodeTypeCondition.apply(this)};t.ChildNodeTypeCondition.prototype=jQuery.extend({},t.CheckNodeTypeCondition.prototype);t.ChildNodeTypeCondition.prototype.getType=function(){return i};t.ChildNodeTypeCondition.prototype.getLabel=function(){return n.Export.FunctionGenerationCondition.Localization.ConditionChildNodeType};t.ChildNodeTypeCondition.prototype.getExportApiType=function(){return"ChildNodeType"};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new t.ChildNodeTypeCondition)})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.CheckActionTypeCondition=function(){n.DefaultNodeShapes.Conditions.BaseCondition.apply(this)};t.CheckActionTypeCondition.prototype=jQuery.extend({},n.DefaultNodeShapes.Conditions.BaseCondition.prototype);t.CheckActionTypeCondition.prototype.getTemplateName=function(){return"gn-functionGenerationCondition-actionType"};t.CheckActionTypeCondition.prototype.canBeSelected=function(){return!0};t.CheckActionTypeCondition.prototype.getConditionDependsOnObject=function(){return[]};t.CheckActionTypeCondition.prototype.buildConditionData=function(t){var i={selectedActionType:new ko.observable,actionTypes:n.Export.FunctionGenerationCondition.actionTypes},u,r;if(t){for(u=null,r=0;r<i.actionTypes.length;++r)i.actionTypes[r].actionType==t.actionType&&(u=i.actionTypes[r]);i.selectedActionType(u)}return i};t.CheckActionTypeCondition.prototype.serializeConditionData=function(n){return{actionType:n.selectedActionType().actionType}};t.CheckActionTypeCondition.prototype.getConditionString=function(t){var i=new jQuery.Deferred;return i.resolve(this.getLabel()+"("+n.Export.FunctionGenerationCondition.localizedActionTypes[t.actionType]+")"),i.promise()};t.CheckActionTypeCondition.prototype.getExportApiType=function(){return""};t.CheckActionTypeCondition.prototype.convertDataForExportApi=function(n){return{actionType:n.actionType}};t.CheckActionTypeCondition.prototype.convertDataForDialog=function(n){return{actionType:n.actionType}}})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){var i=6;t.ParentActionTypeCondition=function(){t.CheckActionTypeCondition.apply(this)};t.ParentActionTypeCondition.prototype=jQuery.extend({},t.CheckActionTypeCondition.prototype);t.ParentActionTypeCondition.prototype.getType=function(){return i};t.ParentActionTypeCondition.prototype.getLabel=function(){return n.Export.FunctionGenerationCondition.Localization.ConditionParentActionType};t.ParentActionTypeCondition.prototype.getExportApiType=function(){return"ParentActionType"};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new t.ParentActionTypeCondition)})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){var i=7;t.CurrentActionTypeCondition=function(){t.CheckActionTypeCondition.apply(this)};t.CurrentActionTypeCondition.prototype=jQuery.extend({},t.CheckActionTypeCondition.prototype);t.CurrentActionTypeCondition.prototype.getType=function(){return i};t.CurrentActionTypeCondition.prototype.getLabel=function(){return n.Export.FunctionGenerationCondition.Localization.ConditionCurrentActionType};t.CurrentActionTypeCondition.prototype.getExportApiType=function(){return"CurrentActionType"};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new t.CurrentActionTypeCondition)})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){var i=8;t.ChildActionTypeCondition=function(){t.CheckActionTypeCondition.apply(this)};t.ChildActionTypeCondition.prototype=jQuery.extend({},t.CheckActionTypeCondition.prototype);t.ChildActionTypeCondition.prototype.getType=function(){return i};t.ChildActionTypeCondition.prototype.getLabel=function(){return n.Export.FunctionGenerationCondition.Localization.ConditionChildActionType};t.ChildActionTypeCondition.prototype.getExportApiType=function(){return"ChildActionType"};n.DefaultNodeShapes.Conditions.getConditionManager().addConditionType(new t.ChildActionTypeCondition)})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(n){(function(n){n.ConditionDialog=function(){this.isOpen=new ko.observable(!1);this.condition=null;this.closingDeferred=null;this.conditionElements=new ko.observableArray;this.showGroupWarning=new ko.observable(!1);this.showDragParentToChildWarning=new ko.observable(!1);this.warningHideTimeout=null;this.selectableConditionTypes=n.getConditionManager().getSelectableConditionTypes()};n.ConditionDialog.prototype={openDialog:function(t,i){this.condition=t;this.closingDeferred=i;this.conditionElements(n.getConditionManager().convertElements(t.conditionElements));this.conditionElements().length==0&&this.addNewConditionElement();this.isOpen(!0)},addNewConditionElement:function(){var t=n.getConditionManager().createEmptyElement();this.conditionElements.push(t)},andGroupElements:function(){this.groupElements(n.GroupConditionOperatorAnd)},orGroupElements:function(){this.groupElements(n.GroupConditionOperatorOr)},groupElements:function(t){var i,o,f,u,e,r;if(this.showGroupWarning(!1),i=[],this.collectSelectedElements(i,this.conditionElements()),!(i.length<2)){for(r=1;r<i.length;++r)if(i[0].parent!=i[r].parent){this.displayWarning(this.showGroupWarning);return}for(o={conditionType:n.GroupConditionType,conditionData:{fromDialog:!0,operator:t,conditionElements:i}},f=n.getConditionManager().convertElement(o),f.parent=i[0].parent,u=this.conditionElements,i[0].parent&&(u=i[0].parent.conditionData().conditionElements),e=u.indexOf(i[0]),u.removeAll(i),e<u().length?u.splice(e,0,f):u.push(f),r=0;r<i.length;++r)i[r].parent=f,i[r].isSelected(!1)}},collectSelectedElements:function(n,t){for(var i=0;i<t.length;++i)t[i].isSelected()&&n.push(t[i]),t[i].conditionData().conditionElements&&this.collectSelectedElements(n,t[i].conditionData().conditionElements())},moveConditionElementUp:function(n){this.moveSingleConditionElement(n,-1)},moveConditionElementDown:function(n){this.moveSingleConditionElement(n,1)},moveSingleConditionElement:function(n,t){var r=null,e;r=n.parent?n.parent.conditionData().conditionElements:this.conditionElements;var f=r.indexOf(n),u=f+t,i=r();u>=0&&u<i.length&&(e=i[f],i[f]=i[u],i[u]=e,r.valueHasMutated())},dropConditionToGroup:function(n,t){if(t.parent!=n){for(var i=n?n.parent:null;i!=null;){if(i==t){this.displayWarning(this.showDragParentToChildWarning);return}i=i.parent}t.parent?(t.parent.conditionData().conditionElements.remove(t),t.parent.conditionData().conditionElements().length<2&&this.deleteConditionElement(t.parent)):this.conditionElements.remove(t);n?n.conditionData().conditionElements.push(t):this.conditionElements.push(t);t.parent=n}},displayWarning:function(n){this.warningHideTimeout&&(clearTimeout(this.warningHideTimeout),this.showGroupWarning(!1),this.showDragParentToChildWarning(!1));n(!0);this.warningHideTimeout=setTimeout(function(){n(!1)},5e3)},deleteConditionElement:function(n){if(n.conditionData().conditionElements){var t=n.conditionData().conditionElements();n.parent&&n.parent.conditionData().conditionElements?this.moveConditionElements(t,n.parent.conditionData().conditionElements,n.parent,n):this.moveConditionElements(t,this.conditionElements,null,n)}n.parent&&n.parent.conditionData().conditionElements?(n.parent.conditionData().conditionElements.remove(n),n.parent.conditionData().conditionElements().length<2&&this.deleteConditionElement(n.parent)):this.conditionElements.remove(n)},moveConditionElements:function(n,t,i,r){for(var f=t.indexOf(r),u=0;u<n.length;++u)n[u].parent=i,f<t().length?t.splice(f+u,0,n[u]):t.push(n[u])},getConditionTemplate:function(t){return t?n.getConditionManager().getConditionTemplate(t.conditionType()):"gn-nodeConditionEmpty"},isConditionTypeSelectable:function(t){return t?n.getConditionManager().isConditionTypeSelectable(t.conditionType()):!0},saveCondition:function(){for(var i=[],r=this.conditionElements(),t=0;t<r.length;++t)i.push(n.getConditionManager().serializeConditionElement(r[t]));this.condition.conditionElements=i;this.closingDeferred&&this.closingDeferred.resolve();this.closeDialog()},closeDialog:function(){this.condition=null;this.closingDeferred=null;this.isOpen(!1)}}})(n.Conditions=n.Conditions||{})})(n.DefaultNodeShapes=n.DefaultNodeShapes||{})}(window.GoNorth=window.GoNorth||{}),function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){this.conditionDialog=new n.DefaultNodeShapes.Conditions.ConditionDialog;this.generateRules=new ko.observableArray;this.preventGenerationRules=new ko.observableArray;this.showConfirmDeleteDialog=new ko.observable(!1);this.targetDeleteArray=null;this.targetDeleteRule=null;this.isLoading=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.hasUnknownConditionType=new ko.observable(!1);this.isReadonly=new ko.observable(!1);this.lockedByUser=new ko.observable("");this.acquireLock();this.loadFunctionGenerationConditions()};t.ViewModel.prototype={loadFunctionGenerationConditions:function(){this.isLoading(!0);this.errorOccured(!1);this.hasUnknownConditionType(!1);var n=this;jQuery.ajax({url:"/api/ExportApi/GetDialogFunctionGenerationConditions",type:"GET"}).done(function(t){var i=n.generateDisplayNameForRules(t.generateRules),r=n.generateDisplayNameForRules(t.preventGenerationRules);jQuery.when(i,r).then(function(t,i){n.generateRules(t);n.preventGenerationRules(i);n.isLoading(!1)},function(){n.isLoading(!1);n.errorOccured(!0)})}).fail(function(){n.isLoading(!1);n.errorOccured(!0)})},generateDisplayNameForRules:function(n){var i=[],r=this,t;return jQuery.each(n,function(n,t){var u=r.generateDisplayNameForRule(t);i.push(u)}),t=new jQuery.Deferred,jQuery.when.apply(jQuery,i).then(function(){t.resolve(n)},function(){t.reject()}),t.promise()},generateDisplayNameForRule:function(t){var i=new jQuery.Deferred,r=this.convertConditionToDialog(t);return r?(n.DefaultNodeShapes.Conditions.getConditionManager().getConditionString(r.conditionElements,n.DefaultNodeShapes.Localization.Conditions.AndOperatorShort,!1).then(function(n){t.name=n;i.resolve(t)},function(){i.reject()}),i.promise()):(i.reject(),i.promise())},createNewRule:function(n){var t=this;this.showConditionDialog([]).done(function(i){n.push(i);t.saveConditions()})},openEditRuleDialog:function(n,t){if(!this.isReadonly()){var r=t(),i=n(),u=this,f=this.convertConditionToDialog(i[r]);this.showConditionDialog(f.conditionElements).done(function(t){i[r]=t;n(i);u.saveConditions()})}},showConditionDialog:function(n){var r={conditionElements:n},i=new jQuery.Deferred,u=new jQuery.Deferred,t;return this.conditionDialog.openDialog(r,u),t=this,u.done(function(){var n=t.convertConditionFromDialog(r);n&&t.generateDisplayNameForRule(n).then(function(){i.resolve(n)},function(){t.errorOccured(!0);i.reject()})}),i.promise()},convertConditionFromDialog:function(n){var i=t.convertConditionElementsFromDialog(n.conditionElements);return this.checkAndFinalizeConvertedElements(i)},convertConditionToDialog:function(n){var i=t.convertConditionElementsToDialog(n.conditionElements);return this.checkAndFinalizeConvertedElements(i)},checkAndFinalizeConvertedElements:function(n){return n?{conditionElements:n}:(this.hasUnknownConditionType(!0),this.errorOccured(!0),null)},openDeleteRuleDialog:function(n,t){this.isLoading()||(this.showConfirmDeleteDialog(!0),this.targetDeleteArray=n,this.targetDeleteRule=t)},deleteRule:function(){this.targetDeleteArray&&(this.targetDeleteArray.remove(this.targetDeleteRule),this.saveConditions(),this.closeConfirmDeleteDialog())},closeConfirmDeleteDialog:function(){this.showConfirmDeleteDialog(!1);this.targetDeleteArray=null;this.targetDeleteRule=null},saveConditions:function(){var i={generateRules:this.generateRules(),preventGenerationRules:this.preventGenerationRules()},t;this.isLoading(!0);this.errorOccured(!1);this.hasUnknownConditionType(!1);t=this;jQuery.ajax({headers:n.Util.generateAntiForgeryHeader(),url:"/api/ExportApi/SaveDialogFunctionGenerationConditions",type:"POST",data:JSON.stringify(i),contentType:"application/json"}).done(function(){t.loadFunctionGenerationConditions()}).fail(function(){t.isLoading(!1);t.errorOccured(!0)})},acquireLock:function(){var t=this;n.LockService.acquireLock("ExportDialogFunctionGenerationCondition",n.Export.FunctionGenerationCondition.lockId).done(function(n,i){n&&(t.isReadonly(!0),t.lockedByUser(i))}).fail(function(){t.errorOccured(!0);t.isReadonly(!0)})}}})(t.FunctionGenerationCondition=t.FunctionGenerationCondition||{})})(n.Export=n.Export||{})}(window.GoNorth=window.GoNorth||{});