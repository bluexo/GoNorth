(function(n){"use strict";(function(t){(function(t){t.ViewModel=function(){var t,i;this.templateCategories=new ko.observableArray;this.selectedCategoryLabel=new ko.observable("");this.selectedCategory=new ko.observable(-1);t=parseInt(n.Util.getParameterFromUrl("category"));isNaN(t)||this.selectedCategory(t);this.templates=new ko.observableArray;this.dialogLoading=new ko.observable(!1);this.dialogErrorOccured=new ko.observable(!1);this.isSettingsDialogOpen=new ko.observable(!1);this.selectedCodeEditorMode=new ko.observable(null);this.codeEditorModes=ace.require("ace/ext/modelist").modes;this.escapeCharacter=new ko.observable("");this.charactersNeedingEscaping=new ko.observable("");this.newlineCharacter=new ko.observable("");this.languageSelectedCodeEditorMode=new ko.observable(null);this.languageEscapeCharacter=new ko.observable("");this.languageCharactersNeedingEscaping=new ko.observable("");this.languageNewlineCharacter=new ko.observable("");this.isLoading=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.loadTemplateCategories();this.loadSettings();i=this;n.Util.onUrlParameterChanged(function(){var t=parseInt(n.Util.getParameterFromUrl("category"));isNaN(t)||t==i.selectedCategory()||i.selectTemplateCategoryFromUrl(t)})};t.ViewModel.prototype={loadTemplateCategories:function(){this.isLoading(!0);this.errorOccured(!1);var n=this;jQuery.ajax({url:"/api/ExportApi/GetTemplateCategories",method:"GET"}).done(function(t){n.templateCategories(t);n.isLoading(!1);n.selectedCategory()<0&&t.length>0?n.selectTemplateCategory(t[0]):n.selectTemplateCategoryFromUrl(n.selectedCategory())}).fail(function(){n.isLoading(!1);n.errorOccured(!0)})},selectTemplateCategoryFromUrl:function(n){for(var r="",i=this.templateCategories(),t=0;t<i.length;++t)if(i[t].category==n){r=i[t].label;break}this.selectedCategory(n);this.selectedCategoryLabel(r);this.loadTemplatesForSelectedCategory()},selectTemplateCategory:function(t){var i="category="+t.category;window.location.search?n.Util.setUrlParameters(i):n.Util.replaceUrlParameters(i)},loadTemplatesForSelectedCategory:function(){this.isLoading(!0);this.errorOccured(!1);var n=this;jQuery.ajax({url:"/api/ExportApi/GetDefaultTemplatesByCategory?category="+n.selectedCategory(),type:"GET"}).done(function(t){n.isLoading(!1);n.templates(t)}).fail(function(){n.isLoading(!1);n.errorOccured(!0)})},buildTemplateUrl:function(n){return"/Export/ManageTemplate?templateType="+n.template.templateType},loadSettings:function(){this.dialogLoading(!0);this.dialogErrorOccured(!1);var n=this;jQuery.ajax({url:"/api/ExportApi/GetExportSettings",type:"GET"}).done(function(t){n.selectedCodeEditorMode(n.searchCodeEditorMode(t.scriptLanguage));n.escapeCharacter(t.escapeCharacter);n.charactersNeedingEscaping(t.charactersNeedingEscaping);n.newlineCharacter(t.newlineCharacter);n.languageSelectedCodeEditorMode(n.searchCodeEditorMode(t.languageFileLanguage));n.languageEscapeCharacter(t.languageEscapeCharacter);n.languageCharactersNeedingEscaping(t.languageCharactersNeedingEscaping);n.languageNewlineCharacter(t.languageNewlineCharacter);n.dialogLoading(!1)}).fail(function(){n.dialogLoading(!1);n.dialogErrorOccured(!0)})},searchCodeEditorMode:function(n){for(var t=0;t<this.codeEditorModes.length;++t)if(this.codeEditorModes[t].mode==n)return this.codeEditorModes[t];return null},openSettingsDialog:function(){this.dialogLoading(!1);this.dialogErrorOccured(!1);this.isSettingsDialogOpen(!0)},saveSettings:function(){var i,t;if(!this.selectedCodeEditorMode()||!this.languageSelectedCodeEditorMode()){this.dialogErrorOccured(!0);return}i={scriptLanguage:this.selectedCodeEditorMode().mode,scriptExtension:this.selectedCodeEditorMode().extensions.split("|")[0],escapeCharacter:this.escapeCharacter(),charactersNeedingEscaping:this.charactersNeedingEscaping(),newlineCharacter:this.newlineCharacter(),languageFileLanguage:this.languageSelectedCodeEditorMode().mode,languageFileExtension:this.languageSelectedCodeEditorMode().extensions.split("|")[0],languageEscapeCharacter:this.languageEscapeCharacter(),languageCharactersNeedingEscaping:this.languageCharactersNeedingEscaping(),languageNewlineCharacter:this.languageNewlineCharacter()};this.dialogLoading(!0);this.dialogErrorOccured(!1);t=this;jQuery.ajax({headers:n.Util.generateAntiForgeryHeader(),url:"/api/ExportApi/SaveExportSettings",type:"POST",data:JSON.stringify(i),contentType:"application/json"}).done(function(){t.dialogLoading(!1);t.closeSettingsDialog()}).fail(function(){t.dialogLoading(!1);t.dialogErrorOccured(!0)})},closeSettingsDialog:function(){this.isSettingsDialogOpen(!1)},openFunctionGenerationConditions:function(){window.location="/Export/FunctionGenerationCondition"}}})(t.TemplateOverview=t.TemplateOverview||{})})(n.Export=n.Export||{})})(window.GoNorth=window.GoNorth||{});