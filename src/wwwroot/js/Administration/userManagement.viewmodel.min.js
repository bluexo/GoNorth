(function(n){"use strict";(function(t){(function(t){var i=50;t.ViewModel=function(){this.availableRoles=new ko.observableArray;this.currentPage=new ko.observable(0);this.users=new ko.observableArray;this.hasMore=new ko.observable(!1);this.isLoading=new ko.observable(!1);this.prevLoading=new ko.observable(!1);this.nextLoading=new ko.observable(!1);this.dialogLoading=new ko.observable(!1);this.showUserCreateDialog=new ko.observable(!1);this.createName=new ko.observable;this.createEmail=new ko.observable;this.createPassword=new ko.observable;this.createPasswordRepeat=new ko.observable;this.createError=new ko.observable;this.showUpdateSecurityStampDialog=new ko.observable(!1);this.userToUpdateSecurityStamp=null;this.updateSecurityStampErrorOccured=new ko.observable(!1);this.showConfirmDeleteDialog=new ko.observable(!1);this.userToDelete=null;this.deleteErrorOccured=new ko.observable(!1);this.deleteErrorAdditionalDetails=new ko.observable("");this.showUserRolesDialog=new ko.observable(!1);this.userToEdit=null;this.availableUserRoles=new ko.observableArray;this.selectedAvailableUserRoles=new ko.observableArray;this.assignedUserRoles=new ko.observableArray;this.selectedAssignedUserRoles=new ko.observableArray;this.roleError=new ko.observable;this.showConfirmEmailDialog=new ko.observable(!1);this.userToConfirmEmail=null;this.confirmEmailErrorOccured=new ko.observable(!1);this.errorOccured=new ko.observable(!1);this.nextLoading(!0);this.loadPage();this.loadAvailableRoles()};t.ViewModel.prototype={loadAvailableRoles:function(){var n=this;jQuery.ajax("/api/RoleApi/AvailableRoles").done(function(t){n.availableRoles(t)}).fail(function(){n.errorOccured(!0)})},loadPage:function(){var n=this;this.errorOccured(!1);this.isLoading(!0);jQuery.ajax("/api/UserApi/Entries?start="+this.currentPage()*i+"&pageSize="+i).done(function(t){n.users(t.users);n.hasMore(t.hasMore);n.isLoading(!1);n.prevLoading(!1);n.nextLoading(!1)}).fail(function(){n.errorOccured(!0);n.isLoading(!1);n.prevLoading(!1);n.nextLoading(!1)})},prevPage:function(){this.currentPage(this.currentPage()-1);this.prevLoading(!0);this.loadPage()},nextPage:function(){this.currentPage(this.currentPage()+1);this.nextLoading(!0);this.loadPage()},openCreateUserDialog:function(){this.createName("");this.createEmail("");this.createPassword("");this.createPasswordRepeat("");this.createError("");n.Util.setupValidation("#gn-userForm");this.showUserCreateDialog(!0)},closeCreateUserDialog:function(){this.showUserCreateDialog(!1);this.dialogLoading(!1)},createUser:function(){if(jQuery("#gn-userForm").valid()){var i={DisplayName:this.createName(),Email:this.createEmail(),Password:this.createPassword()},t=this;this.dialogLoading(!0);jQuery.ajax({url:"/api/UserApi/CreateUser",headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(i),type:"POST",contentType:"application/json"}).done(function(){t.closeCreateUserDialog();t.loadPage()}).fail(function(i){t.dialogLoading(!1);t.createError(i.responseJSON&&i.responseJSON.length>0?i.responseJSON.join(", "):n.Administration.UserManagement.Localization.ErrorOccured)})}},openUpdateSecurityStampDialog:function(n){this.showUpdateSecurityStampDialog(!0);this.updateSecurityStampErrorOccured(!1);this.userToUpdateSecurityStamp=n},closeUpdateSecurityStampDialog:function(){this.showUpdateSecurityStampDialog(!1);this.dialogLoading(!1);this.userToUpdateSecurityStamp=null},updateSecurityStampForUser:function(){if(this.userToUpdateSecurityStamp){var t=this;this.dialogLoading(!0);this.updateSecurityStampErrorOccured(!1);jQuery.ajax({url:"/api/UserApi/UpdateSecurityStampForUser?id="+this.userToUpdateSecurityStamp.id,headers:n.Util.generateAntiForgeryHeader(),type:"POST"}).done(function(){t.closeUpdateSecurityStampDialog();t.loadPage()}).fail(function(){t.dialogLoading(!1);t.updateSecurityStampErrorOccured(!0)})}},openDeleteUserDialog:function(n){this.showConfirmDeleteDialog(!0);this.deleteErrorOccured(!1);this.deleteErrorAdditionalDetails("");this.userToDelete=n},closeConfirmDeleteDialog:function(){this.showConfirmDeleteDialog(!1);this.dialogLoading(!1);this.userToDelete=null},deleteUser:function(){if(this.userToDelete){var t=this;this.dialogLoading(!0);this.deleteErrorOccured(!1);this.deleteErrorAdditionalDetails("");jQuery.ajax({url:"/api/UserApi/DeleteUser?id="+this.userToDelete.id,headers:n.Util.generateAntiForgeryHeader(),type:"DELETE"}).done(function(){t.closeConfirmDeleteDialog();t.users().length<=1&&t.currentPage()>0&&t.currentPage(t.currentPage()-1);t.loadPage()}).fail(function(n){t.dialogLoading(!1);t.deleteErrorOccured(!0);n.status==400&&n.responseText&&t.deleteErrorAdditionalDetails(n.responseText)})}},openUserRoleDialog:function(n){var i,t;for(this.showUserRolesDialog(!0),this.userToEdit=n,this.availableUserRoles.removeAll(),i=this.availableRoles(),t=0;t<i.length;++t)this.availableUserRoles.push(i[t]);for(n.roles.length>0&&this.availableUserRoles.removeAll(n.roles),this.assignedUserRoles.removeAll(),t=0;t<n.roles.length;++t)this.assignedUserRoles.push(n.roles[t])},addSelectedUserRoles:function(){var t=this.selectedAvailableUserRoles(),n;for(this.availableUserRoles.removeAll(t),n=0;n<t.length;++n)this.assignedUserRoles.push(t[n])},removeSelectedUserRoles:function(){var t=this.selectedAssignedUserRoles(),n;for(this.assignedUserRoles.removeAll(t),n=0;n<t.length;++n)this.availableRoles.indexOf(t[n])>-1&&this.availableUserRoles.push(t[n])},closeUserRolesDialog:function(){this.showUserRolesDialog(!1);this.dialogLoading(!1);this.userToEdit=null},saveUserRoles:function(){if(this.userToEdit){var i=this.assignedUserRoles(),t=this;this.dialogLoading(!0);jQuery.ajax({url:"/api/UserApi/SetUserRoles?id="+this.userToEdit.id,headers:n.Util.generateAntiForgeryHeader(),data:JSON.stringify(i),type:"POST",contentType:"application/json"}).done(function(){t.closeUserRolesDialog();t.loadPage()}).fail(function(n){t.dialogLoading(!1);t.roleError(n.responseJSON.join(", "))})}},openConfirmEmailDialog:function(n){this.showConfirmEmailDialog(!0);this.confirmEmailErrorOccured(!1);this.userToConfirmEmail=n},closeConfirmEmailDialog:function(){this.showConfirmEmailDialog(!1);this.dialogLoading(!1);this.userToConfirmEmail=null},confirmEmailForUser:function(){if(this.userToConfirmEmail){var t=this;this.confirmEmailErrorOccured(!1);this.dialogLoading(!0);jQuery.ajax({url:"/api/UserApi/ConfirmEmailForUser?id="+this.userToConfirmEmail.id,headers:n.Util.generateAntiForgeryHeader(),type:"POST"}).done(function(){t.closeConfirmEmailDialog();t.loadPage()}).fail(function(){t.dialogLoading(!1);t.confirmEmailErrorOccured(!0)})}}}})(t.UserManagement=t.UserManagement||{})})(n.Administration=n.Administration||{})})(window.GoNorth=window.GoNorth||{});